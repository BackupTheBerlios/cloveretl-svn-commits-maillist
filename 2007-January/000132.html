<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Cloveretl-svn-commits] CloverETL repos r2420 - in branches/cloveretl.engine.rel-2-1-0: cloveretl.component/src/org/jetel/component cloveretl.connection cloveretl.connection/src/org/jetel/connection cloveretl.engine/data/in/bad cloveretl.engine/docs cloveretl.engine/examples cloveretl.engine/examples/data cloveretl.engine/examples/metadata cloveretl.engine/src/org/jetel/component cloveretl.engine/src/org/jetel/data cloveretl.engine/src/org/jetel/data/formatter cloveretl.engine/src/org/jetel/data/lookup cloveretl.engine/src/org/jetel/data/parser cloveretl.engine/src/org/jetel/data/sequence cloveretl.engine/src/org/jetel/database cloveretl.engine/src/org/jetel/graph cloveretl.engine/src/org/jetel/graph/runtime cloveretl.engine/src/org/jetel/interpreter cloveretl.engine/src/org/jetel/main cloveretl.engine/src/org/jetel/metadata cloveretl.engine/src/org/jetel/plugin cloveretl.engine/src/org/jetel/util cloveretl.engine/test/org/jetel/data cloveretl.engine/test/org/jetel/data/primitive cloveretl! .engine/test/org/jetel/exception cloveretl.engine/test/org/jetel/graph cloveretl.engine/test/org/jetel/interpreter cloveretl.engine/test/org/jetel/metadata cloveretl.engine/test/org/jetel/util cloveretl.sequence/src/org/jetel/sequence
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/cloveretl-svn-commits/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:cloveretl-svn-commits%40lists.berlios.de?Subject=Re%3A%20%5BCloveretl-svn-commits%5D%20CloverETL%20repos%20r2420%20-%20in%0A%20branches/cloveretl.engine.rel-2-1-0%3A%0A%20cloveretl.component/src/org/jetel/component%20cloveretl.connection%0A%20cloveretl.connection/src/org/jetel/connection%20cloveretl.engine/data/in/bad%0A%20cloveretl.engine/docs%20cloveretl.engine/examples%0A%20cloveretl.engine/examples/data%20cloveretl.engine/examples/metadata%0A%20cloveretl.engine/src/org/jetel/component%0A%20cloveretl.engine/src/org/jetel/data%0A%20cloveretl.engine/src/org/jetel/data/formatter%0A%20cloveretl.engine/src/org/jetel/data/lookup%0A%20cloveretl.engine/src/org/jetel/data/parser%0A%20cloveretl.engine/src/org/jetel/data/sequence%0A%20cloveretl.engine/src/org/jetel/database%0A%20cloveretl.engine/src/org/jetel/graph%0A%20cloveretl.engine/src/org/jetel/graph/runtime%0A%20cloveretl.engine/src/org/jetel/interpreter%0A%20cloveretl.engine/src/org/jetel/main%20cloveretl.engine/src/org/jetel/metadata%0A%20cloveretl.engine/src/org/jetel/plugin%20cloveretl.engine/src/org/jetel/util%0A%20cloveretl.engine/test/org/jetel/data%0A%20cloveretl.engine/test/org/jetel/data/primitive%20cloveretl%21%0A%20.engine/test/org/jetel/exception%20cloveretl.engine/test/org/jetel/graph%0A%20cloveretl.engine/test/org/jetel/interpreter%0A%20cloveretl.engine/test/org/jetel/metadata%0A%20cloveretl.engine/test/org/jetel/util%0A%20cloveretl.sequence/src/org/jetel/sequence&In-Reply-To=%3C200701311429.l0VETwk5025551%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000057.html">
   <LINK REL="Next"  HREF="000058.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Cloveretl-svn-commits] CloverETL repos r2420 - in branches/cloveretl.engine.rel-2-1-0: cloveretl.component/src/org/jetel/component cloveretl.connection cloveretl.connection/src/org/jetel/connection cloveretl.engine/data/in/bad cloveretl.engine/docs cloveretl.engine/examples cloveretl.engine/examples/data cloveretl.engine/examples/metadata cloveretl.engine/src/org/jetel/component cloveretl.engine/src/org/jetel/data cloveretl.engine/src/org/jetel/data/formatter cloveretl.engine/src/org/jetel/data/lookup cloveretl.engine/src/org/jetel/data/parser cloveretl.engine/src/org/jetel/data/sequence cloveretl.engine/src/org/jetel/database cloveretl.engine/src/org/jetel/graph cloveretl.engine/src/org/jetel/graph/runtime cloveretl.engine/src/org/jetel/interpreter cloveretl.engine/src/org/jetel/main cloveretl.engine/src/org/jetel/metadata cloveretl.engine/src/org/jetel/plugin cloveretl.engine/src/org/jetel/util cloveretl.engine/test/org/jetel/data cloveretl.engine/test/org/jetel/data/primitive cloveretl! .engine/test/org/jetel/exception cloveretl.engine/test/org/jetel/graph cloveretl.engine/test/org/jetel/interpreter cloveretl.engine/test/org/jetel/metadata cloveretl.engine/test/org/jetel/util cloveretl.sequence/src/org/jetel/sequence</H1>
    <B>cloveretl-svn-commits at lists.berlios.de</B> 
    <A HREF="mailto:cloveretl-svn-commits%40lists.berlios.de?Subject=Re%3A%20%5BCloveretl-svn-commits%5D%20CloverETL%20repos%20r2420%20-%20in%0A%20branches/cloveretl.engine.rel-2-1-0%3A%0A%20cloveretl.component/src/org/jetel/component%20cloveretl.connection%0A%20cloveretl.connection/src/org/jetel/connection%20cloveretl.engine/data/in/bad%0A%20cloveretl.engine/docs%20cloveretl.engine/examples%0A%20cloveretl.engine/examples/data%20cloveretl.engine/examples/metadata%0A%20cloveretl.engine/src/org/jetel/component%0A%20cloveretl.engine/src/org/jetel/data%0A%20cloveretl.engine/src/org/jetel/data/formatter%0A%20cloveretl.engine/src/org/jetel/data/lookup%0A%20cloveretl.engine/src/org/jetel/data/parser%0A%20cloveretl.engine/src/org/jetel/data/sequence%0A%20cloveretl.engine/src/org/jetel/database%0A%20cloveretl.engine/src/org/jetel/graph%0A%20cloveretl.engine/src/org/jetel/graph/runtime%0A%20cloveretl.engine/src/org/jetel/interpreter%0A%20cloveretl.engine/src/org/jetel/main%20cloveretl.engine/src/org/jetel/metadata%0A%20cloveretl.engine/src/org/jetel/plugin%20cloveretl.engine/src/org/jetel/util%0A%20cloveretl.engine/test/org/jetel/data%0A%20cloveretl.engine/test/org/jetel/data/primitive%20cloveretl%21%0A%20.engine/test/org/jetel/exception%20cloveretl.engine/test/org/jetel/graph%0A%20cloveretl.engine/test/org/jetel/interpreter%0A%20cloveretl.engine/test/org/jetel/metadata%0A%20cloveretl.engine/test/org/jetel/util%0A%20cloveretl.sequence/src/org/jetel/sequence&In-Reply-To=%3C200701311429.l0VETwk5025551%40sheep.berlios.de%3E"
       TITLE="[Cloveretl-svn-commits] CloverETL repos r2420 - in branches/cloveretl.engine.rel-2-1-0: cloveretl.component/src/org/jetel/component cloveretl.connection cloveretl.connection/src/org/jetel/connection cloveretl.engine/data/in/bad cloveretl.engine/docs cloveretl.engine/examples cloveretl.engine/examples/data cloveretl.engine/examples/metadata cloveretl.engine/src/org/jetel/component cloveretl.engine/src/org/jetel/data cloveretl.engine/src/org/jetel/data/formatter cloveretl.engine/src/org/jetel/data/lookup cloveretl.engine/src/org/jetel/data/parser cloveretl.engine/src/org/jetel/data/sequence cloveretl.engine/src/org/jetel/database cloveretl.engine/src/org/jetel/graph cloveretl.engine/src/org/jetel/graph/runtime cloveretl.engine/src/org/jetel/interpreter cloveretl.engine/src/org/jetel/main cloveretl.engine/src/org/jetel/metadata cloveretl.engine/src/org/jetel/plugin cloveretl.engine/src/org/jetel/util cloveretl.engine/test/org/jetel/data cloveretl.engine/test/org/jetel/data/primitive cloveretl! .engine/test/org/jetel/exception cloveretl.engine/test/org/jetel/graph cloveretl.engine/test/org/jetel/interpreter cloveretl.engine/test/org/jetel/metadata cloveretl.engine/test/org/jetel/util cloveretl.sequence/src/org/jetel/sequence">cloveretl-svn-commits at lists.berlios.de
       </A><BR>
    <I>Wed Jan 31 15:31:21 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000057.html">[Cloveretl-svn-commits] CloverETL repos r2419 -	trunk/cloveretl.engine/src/org/jetel/data/parser
</A></li>
        <LI>Next message: <A HREF="000058.html">[Cloveretl-svn-commits] CloverETL repos r2421 -	trunk/cloveretl.engine/src/org/jetel/data/parser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#132">[ date ]</a>
              <a href="thread.html#132">[ thread ]</a>
              <a href="subject.html#132">[ subject ]</a>
              <a href="author.html#132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: otasanek
Date: 2007-01-31 15:29:53 +0100 (Wed, 31 Jan 2007)
New Revision: 2420

Added:
   branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/test/
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/customizedTransformExample.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/data/orders2.dat
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/data/orders2.xls
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMX.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMXMBean.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/graph/EdgeTest.java
Removed:
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/OneRecordPerLinePolicyTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/SQLDataParserTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_SQLDataParser_Test.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/graph/DirectEdgeTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/ClassBuilderTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CodeParserTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CreateJavaObjectTest.java
Modified:
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/AproxMergeJoin.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/CloverDataWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBExecute.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBInputTable.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBJoin.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBOutputTable.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataGenerator.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataIntersection.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataReader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataReader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Denormalizer.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataReader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/HashJoin.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsReader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/LookupJoin.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MergeJoin.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MultiLevelReader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Normalizer.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Partition.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Reformat.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/SequenceChecker.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/StructureWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Trash.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSReader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/DBConnection.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/JmsConnection.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/data/in/bad/FL28_NL_nulls.txt
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/BUGS.txt
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/HISTORY.txt
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphAproximativeJoin.grf
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphCloverData.grf
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphDBLoad5.grf
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphExtFilter.grf
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphIntersectData.grf
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphJoinMergeInline.grf
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/metadata/employees.fmt
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/CustomizedRecordTransform.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/RecordTransformFactory.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/ByteDataField.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DataRecord.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DateDataField.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/IntegerDataField.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/NumericDataField.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/CloverDataFormatter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/JExcelXLSDataFormatter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSDataFormatter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSFormatter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/lookup/LookupTable.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/CloverDataParser.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/DelimitedDataParser.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/JExcelXLSDataParser.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSDataParser.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSParser.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/sequence/Sequence.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/database/IConnection.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/DirectEdge.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Node.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Phase.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraph.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraphXMLReaderWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/NodeTrackingDetail.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/TrackingDetail.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/WatchDog.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangExecutor.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangParser.jjt
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/main/runGraph.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataFieldMetadata.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadata.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadataXMLReaderWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/MetadataFactory.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginClassLoader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginDescriptor.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/BitArray.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/ByteBufferUtils.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/Compiler.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/DynamicJavaCode.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/FileUtils.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileReader.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileWriter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/StringUtils.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DataTestSuite.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DateDataFieldTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/IntegerDataFieldTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/NumericDataFieldTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/primitive/DecimalNumericTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_DelimitedDataParserNIO_Test.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_FixLenDataParser2_Test.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/ExceptionTestSuite.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/interpreter/TestInterpreter.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataXMLReaderWriterTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CompileTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/FifoTest.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/UtilTestSuite.java
   branches/cloveretl.engine.rel-2-1-0/cloveretl.sequence/src/org/jetel/sequence/SimpleSequence.java
Log:
SVN: merge for 2.1.0.

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/AproxMergeJoin.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/AproxMergeJoin.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/AproxMergeJoin.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -573,7 +573,7 @@
 		} else {
 			transformation = RecordTransformFactory.createTransform(
 					transformSource, transformClassName, this, inMetadata,
-					outMetadata, transformationParameters);
+					outMetadata, transformationParameters, this.getClass().getClassLoader());
 		}
 		outMetadata = new DataRecordMetadata[] { getOutputPort(SUSPICIOUS_OUT).getMetadata() };
 		if (transformationForSuspicious != null) {
@@ -582,7 +582,7 @@
 		} else {
 			transformationForSuspicious = RecordTransformFactory.createTransform(
 					transformSourceForSuspicious, transformClassNameForSuspicious, 
-					this, inMetadata, outMetadata, transformationParametersForSuspicious);
+					this, inMetadata, outMetadata, transformationParametersForSuspicious, this.getClass().getClassLoader());
 		}
 		// initializing join parameters
 		joinKeys = new String[joinParameters.length];

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/CloverDataWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/CloverDataWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/CloverDataWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -191,6 +191,16 @@
         return runIt ? Result.FINISHED_OK : Result.ABORTED;
 	}
 	
+	@Override
+	public synchronized void free() {
+		super.free();
+		formatter.close();
+		try {
+			out.close();
+		} catch (IOException e) {
+			e.printStackTrace();
+		}
+	}
 	/* (non-Javadoc)
 	 * @see org.jetel.graph.GraphElement#checkConfig()
 	 */

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBExecute.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBExecute.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBExecute.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -190,9 +190,11 @@
                 throw new ComponentNotReadyException(&quot;Connection with ID: &quot; + dbConnectionName + &quot; isn't instance of the DBConnection class.&quot;);
             }
             dbConnection = (DBConnection) conn;
-            dbConnection.init();
 	    }
-        if (dbSQL==null){
+		if (!dbConnection.isInitialized()) {
+			dbConnection.init();
+		}        
+		if (dbSQL==null){
             String delimiter = sqlStatementDelimiter !=null ? sqlStatementDelimiter : DEFAULT_SQL_STATEMENT_DELIMITER;
             dbSQL=sqlQuery.split(delimiter);
         }
@@ -347,7 +349,7 @@
                 query = xattribs.getString(XML_DBSQL_ATTRIBUTE);
             } else if (xattribs.exists(XML_URL_ATTRIBUTE)) {
                 query = xattribs
-                        .resolveReferences(FileUtils.getStringFromURL(xattribs
+                        .resolveReferences(FileUtils.getStringFromURL(graph.getProjectURL(), xattribs
                                 .getString(XML_URL_ATTRIBUTE)));
             } else if (xattribs.exists(XML_SQLCODE_ELEMENT)) {
                 query = xattribs.getString(XML_SQLCODE_ELEMENT);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBInputTable.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBInputTable.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBInputTable.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -101,7 +101,7 @@
  * @see         org.jetel.database.AnalyzeDB
  */
 public class DBInputTable extends Node {
-	private static final String XML_DATAPOLICY_ATTRIBUTE = &quot;DataPolicy&quot;;
+	private static final String XML_DATAPOLICY_ATTRIBUTE = &quot;dataPolicy&quot;;
 	private static final String XML_DBCONNECTION_ATTRIBUTE = &quot;dbConnection&quot;;
 	private static final String XML_SQLQUERY_ATTRIBUTE = &quot;sqlQuery&quot;;
 	private static final String XML_URL_ATTRIBUTE = &quot;url&quot;;
@@ -230,7 +230,7 @@
                 String query = null;
                 if (xattribs.exists(XML_URL_ATTRIBUTE))
                 {
-                   query=xattribs.resolveReferences(FileUtils.getStringFromURL(xattribs.getString(XML_URL_ATTRIBUTE)));
+                   query=xattribs.resolveReferences(FileUtils.getStringFromURL(graph.getProjectURL(), xattribs.getString(XML_URL_ATTRIBUTE)));
                 }else if (xattribs.exists(XML_SQLQUERY_ATTRIBUTE)){
                     query = xattribs.getString(XML_SQLQUERY_ATTRIBUTE);
                 }else if (xattribs.exists(XML_SQLCODE_ELEMENT)){

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBJoin.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBJoin.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBJoin.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -306,7 +306,7 @@
 			if (transformSource != null || transformClassName != null) {
 				transformation = RecordTransformFactory.createTransform(
 						transformSource, transformClassName, this, inMetadata,
-						outMetadata, transformationParameters);
+						outMetadata, transformationParameters, this.getClass().getClassLoader());
 			}			
 		} catch (Exception e) {
 			throw new ComponentNotReadyException(this, e);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBOutputTable.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBOutputTable.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DBOutputTable.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -609,7 +609,7 @@
 			}else if(xattribs.exists(XML_URL_ATTRIBUTE)){
 				outputTable = new DBOutputTable(xattribs.getString(XML_ID_ATTRIBUTE),
 						xattribs.getString(XML_DBCONNECTION_ATTRIBUTE),
-						xattribs.resolveReferences(FileUtils.getStringFromURL(xattribs.getString(XML_URL_ATTRIBUTE))),	
+						xattribs.resolveReferences(FileUtils.getStringFromURL(graph.getProjectURL(), xattribs.getString(XML_URL_ATTRIBUTE))),	
 						null);
 			    
 			}else if(xattribs.exists(XML_DBTABLE_ATTRIBUTE)){

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataGenerator.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataGenerator.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataGenerator.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -149,7 +149,7 @@
 	private final int MOVE = 3;
 
 	private String pattern;
-	private DataRecord patternRecord;
+	private DataRecord patternRecord = null;
 	private Parser parser;
 	private DataRecordMetadata metadata;
 	private DataRecord record;
@@ -300,8 +300,12 @@
         		sequenceIndex = StringUtils.findString(metadata.getField(i).getName(), 
         				sequenceFields);
         		if (sequenceIndex &gt; -1){//field found among sequence fields
-            		cutMetadata.delField(metadata.getField(i).getName());
-            		if (sequenceIDs[sequenceIndex] == null){//not given sequence id
+					if (cutMetadata.getNumFields() &gt; 1) {
+						cutMetadata.delField(metadata.getField(i).getName());
+					}else{
+						cutMetadata = null;
+					}
+					if (sequenceIDs[sequenceIndex] == null){//not given sequence id
             			//find any sequence in graph
             			specialValue[i][0]  = getGraph().getSequences().hasNext() ? (String)getGraph().getSequences().next() : null;
 						if (specialValue[i][0] == null) {
@@ -320,30 +324,34 @@
 		}else{
 			random = new Random();
 		}
-		//prepare approperiate data parser
-        switch (metadata.getRecType()) {
-		case DataRecordMetadata.DELIMITED_RECORD:
-			parser = new DelimitedDataParser(Defaults.DataParser.DEFAULT_CHARSET_DECODER);
-			break;
-		case DataRecordMetadata.FIXEDLEN_RECORD:
-			parser = new FixLenCharDataParser(Defaults.DataParser.DEFAULT_CHARSET_DECODER);
-			break;
-		default:
-			parser = new DataParser(Defaults.DataParser.DEFAULT_CHARSET_DECODER);
-			break;
-		}
-		parser.init(cutMetadata);
-		try {
-			parser.setDataSource(new ByteArrayInputStream(pattern.getBytes(
-					Defaults.DataParser.DEFAULT_CHARSET_DECODER)));
-		} catch (UnsupportedEncodingException e1) {
-		}
-		try {
-			patternRecord = parser.getNext();
-		} catch (JetelException e) {
-			throw new ComponentNotReadyException(this,e);
-		}
-		parser.close();
+		if (cutMetadata != null) {
+			//prepare approperiate data parser
+			switch (metadata.getRecType()) {
+			case DataRecordMetadata.DELIMITED_RECORD:
+				parser = new DelimitedDataParser(
+						Defaults.DataParser.DEFAULT_CHARSET_DECODER);
+				break;
+			case DataRecordMetadata.FIXEDLEN_RECORD:
+				parser = new FixLenCharDataParser(
+						Defaults.DataParser.DEFAULT_CHARSET_DECODER);
+				break;
+			default:
+				parser = new DataParser(
+						Defaults.DataParser.DEFAULT_CHARSET_DECODER);
+				break;
+			}
+			parser.init(cutMetadata);
+			try {
+				parser.setDataSource(new ByteArrayInputStream(pattern.getBytes(Defaults.DataParser.DEFAULT_CHARSET_DECODER)));
+			} catch (UnsupportedEncodingException e1) {
+			}
+			try {
+				patternRecord = parser.getNext();
+			} catch (JetelException e) {
+				throw new ComponentNotReadyException(this, e);
+			}
+			parser.close();
+		}		
 	}
 	
 
@@ -495,7 +503,7 @@
 
 		try {
 			dataGenerator = new DataGenerator(xattribs.getString(XML_ID_ATTRIBUTE), 
-					xattribs.getString(XML_PATTERN_ATTRIBUTE), 
+					xattribs.getString(XML_PATTERN_ATTRIBUTE,&quot;&quot;), 
 					xattribs.getInteger(XML_RECORDS_NUMBER_ATTRIBUTE));
 			if (xattribs.exists(XML_RANDOM_FIELDS_ATTRIBUTE)){
 				dataGenerator.setRandomFields(xattribs.getString(XML_RANDOM_FIELDS_ATTRIBUTE));

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataIntersection.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataIntersection.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataIntersection.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -384,7 +384,7 @@
         	transformation.init(transformationParameters, inMetadata, outMetadata);
         }else{
             transformation = RecordTransformFactory.createTransform(
-            		transformSource, transformClassName, this, inMetadata, outMetadata, transformationParameters);
+            		transformSource, transformClassName, this, inMetadata, outMetadata, transformationParameters, this.getClass().getClassLoader());
         }
 	}
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataReader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataReader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataReader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -239,7 +239,7 @@
         super.init();
         
 		// initialize multifile reader based on prepared parser
-        reader = new MultiFileReader(parser, fileURL);
+        reader = new MultiFileReader(parser, getGraph().getProjectURL(), fileURL);
         reader.setLogger(logger);
         reader.setFileSkip(skipFirstLine ? 1 : 0);
         reader.setSkip(skipRows);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DataWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -149,7 +149,7 @@
 		super.init();
 
         // initialize multifile writer based on prepared formatter
-        writer = new MultiFileWriter(formatter, fileURL);
+        writer = new MultiFileWriter(formatter, getGraph().getProjectURL(), fileURL);
         writer.setLogger(logger);
         writer.setBytesPerFile(bytesPerFile);
         writer.setRecordsPerFile(recordsPerFile);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataReader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataReader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataReader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -174,7 +174,7 @@
 		super.init();
 
         // initialize multifile reader based on prepared parser
-        reader = new MultiFileReader(parser, fileURL);
+        reader = new MultiFileReader(parser, getGraph().getProjectURL(), fileURL);
         reader.setLogger(logger);
         reader.setFileSkip(skipFirstLine ? 1 : 0);
         reader.setSkip(skipRows);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/DelimitedDataWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -163,7 +163,7 @@
 		}
         
         // initialize multifile writer based on prepared formatter
-        writer = new MultiFileWriter(formatter, fileURL);
+        writer = new MultiFileWriter(formatter, getGraph().getProjectURL(), fileURL);
         writer.setLogger(logger);
         writer.setBytesPerFile(bytesPerFile);
         writer.setRecordsPerFile(recordsPerFile);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Denormalizer.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Denormalizer.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Denormalizer.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -30,6 +30,7 @@
 import org.jetel.component.denormalize.RecordDenormalize;
 import org.jetel.component.denormalize.RecordDenormalizeTL;
 import org.jetel.data.DataRecord;
+import org.jetel.data.Defaults;
 import org.jetel.data.RecordKey;
 import org.jetel.exception.ComponentNotReadyException;
 import org.jetel.exception.ConfigurationStatus;
@@ -75,7 +76,7 @@
  *  &lt;tr&gt;&lt;td&gt;&lt;b&gt;id&lt;/b&gt;&lt;/td&gt;&lt;td&gt;component identification&lt;/td&gt;
  *  &lt;tr&gt;&lt;td&gt;&lt;b&gt;denormalizeClass&lt;/b&gt;&lt;/td&gt;&lt;td&gt;name of the class to be used for normalizing data.&lt;/td&gt;&lt;/tr&gt;
  *  &lt;tr&gt;&lt;td&gt;&lt;b&gt;denormalize&lt;/b&gt;&lt;/td&gt;&lt;td&gt;contains definition of transformation in Java or TransformLang.&lt;/td&gt;&lt;/tr&gt;
- *  &lt;tr&gt;&lt;td&gt;&lt;b&gt;key&lt;/b&gt;&lt;/td&gt;&lt;td&gt;comma-separated list of key fields used to identify input record groups.
+ *  &lt;tr&gt;&lt;td&gt;&lt;b&gt;key&lt;/b&gt;&lt;/td&gt;&lt;td&gt;list of key fields used to identify input record groups.
  *  Each group is &lt; sequence of input records with identical key field values.&lt;/td&gt;&lt;/tr&gt;
  *  &lt;/tr&gt;
  *  &lt;tr&gt;&lt;td&gt;&lt;b&gt;order&lt;/b&gt;&lt;/td&gt;&lt;td&gt;Describe expected order of input records. &quot;asc&quot; for ascending, &quot;desc&quot; for descending,
@@ -178,7 +179,7 @@
 	 * @throws ComponentNotReadyException
 	 */
 	private RecordDenormalize createDenormalizerDynamic(String denormCode) throws ComponentNotReadyException {
-		DynamicJavaCode dynCode = new DynamicJavaCode(denormCode);
+		DynamicJavaCode dynCode = new DynamicJavaCode(denormCode, this.getClass().getClassLoader());
         dynCode.setCaptureCompilerOutput(true);
         logger.info(&quot; (compiling dynamic source) &quot;);
         // use DynamicJavaCode to instantiate transformation class
@@ -352,7 +353,7 @@
 	}
 
 	private static String[] parseKeyList(String keyList) {
-		return keyList == null ? new String[]{} : keyList.split(&quot;,&quot;);
+		return keyList == null ? new String[]{} : keyList.split(Defaults.Component.KEY_FIELDS_DELIMITER_REGEX);
 	}
 	
 	/**

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataReader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataReader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataReader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -210,7 +210,7 @@
 		super.init();
         
         // initialize multifile reader based on prepared parser
-        reader = new MultiFileReader(parser, fileURL);
+        reader = new MultiFileReader(parser, getGraph().getProjectURL(), fileURL);
         reader.setLogger(logger);
         reader.setFileSkip(skipFirstLine ? 1 : 0);
         reader.setSkip(skipRows);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/FixLenDataWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -157,7 +157,7 @@
 	public void init() throws ComponentNotReadyException {
 		super.init();
         // initialize multifile writer based on prepared formatter
-        writer = new MultiFileWriter(formatter, fileURL);
+        writer = new MultiFileWriter(formatter, getGraph().getProjectURL(), fileURL);
         writer.setLogger(logger);
         writer.setBytesPerFile(bytesPerFile);
         writer.setRecordsPerFile(recordsPerFile);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/HashJoin.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/HashJoin.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/HashJoin.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -159,8 +159,8 @@
  * @since       March 09, 2004
  * @revision    $Revision$
  * @created     09. March 2004
- */
-/**
+ *
+ *
  * @author Jan Hadrava, Javlin Consulting (www.javlinconsulting.cz)
  *
  */
@@ -344,7 +344,7 @@
 			transformation.init(transformationParameters, inMetadata, outMetadata);
 		}else{
 			transformation = RecordTransformFactory.createTransform(
-					transformSource, transformClassName, this, inMetadata, outMetadata, transformationParameters);
+					transformSource, transformClassName, this, inMetadata, outMetadata, transformationParameters, this.getClass().getClassLoader());
 		}
 	}
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsReader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsReader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsReader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -195,7 +195,7 @@
 	 * @throws ComponentNotReadyException
 	 */
 	private static JmsMsg2DataRecord createProcessorDynamic(String psorCode) throws ComponentNotReadyException {
-		DynamicJavaCode dynCode = new DynamicJavaCode(psorCode);
+		DynamicJavaCode dynCode = new DynamicJavaCode(psorCode, JmsReader.class.getClassLoader());
         dynCode.setCaptureCompilerOutput(true);
         logger.info(&quot; (compiling dynamic source) &quot;);
         // use DynamicJavaCode to instantiate transformation class

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/JmsWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -180,7 +180,7 @@
 	 * @throws ComponentNotReadyException
 	 */
 	private static DataRecord2JmsMsg createProcessorDynamic(String psorCode) throws ComponentNotReadyException {
-		DynamicJavaCode dynCode = new DynamicJavaCode(psorCode);
+		DynamicJavaCode dynCode = new DynamicJavaCode(psorCode, JmsWriter.class.getClassLoader());
         dynCode.setCaptureCompilerOutput(true);
         logger.info(&quot; (compiling dynamic source) &quot;);
         // use DynamicJavaCode to instantiate transformation class

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/LookupJoin.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/LookupJoin.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/LookupJoin.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -301,42 +301,17 @@
         checkInputPorts(status, 1, 1);
         checkOutputPorts(status, 1, 1);
 
-        try {
-        	
-    		lookupTable = getGraph().getLookupTable(lookupTableName);
-    		if (lookupTable == null) {
-    			throw new ComponentNotReadyException(&quot;Lookup table \&quot;&quot;
-    					+ lookupTableName + &quot;\&quot; not found.&quot;);
-    		}
-    		if (!lookupTable.isInitialized()) {
-    			lookupTable.init();
-    		}
-    		lookupMetadata = lookupTable.getMetadata();
-    		DataRecordMetadata inMetadata[] = {
-    				getInputPort(READ_FROM_PORT).getMetadata(), lookupMetadata };
-    		DataRecordMetadata outMetadata[] = { getOutputPort(WRITE_TO_PORT)
-    				.getMetadata() };
-    		try {
-    			recordKey = new RecordKey(joinKey, inMetadata[0]);
-    			recordKey.init();
-    			lookupTable.setLookupKey(recordKey);
-    		} catch (Exception e) {
-    			throw new ComponentNotReadyException(this, e);
-    		}
-        	
-        	
-    		if (freeLookupTable) {
-    			lookupTable.free();
-    		}
-//            init();
-//            free();
-        } catch (ComponentNotReadyException e) {
-            ConfigurationProblem problem = new ConfigurationProblem(e.getMessage(), ConfigurationStatus.Severity.ERROR, this, ConfigurationStatus.Priority.NORMAL);
-            if(!StringUtils.isEmpty(e.getAttributeName())) {
-                problem.setAttributeName(e.getAttributeName());
-            }
-            status.add(problem);
-        }
+ 
+//        try {
+////            init();
+////            free();
+//        } catch (ComponentNotReadyException e) {
+//            ConfigurationProblem problem = new ConfigurationProblem(e.getMessage(), ConfigurationStatus.Severity.ERROR, this, ConfigurationStatus.Priority.NORMAL);
+//            if(!StringUtils.isEmpty(e.getAttributeName())) {
+//                problem.setAttributeName(e.getAttributeName());
+//            }
+//            status.add(problem);
+//        }
         
         return status;
 	}
@@ -371,7 +346,7 @@
 			}else{
 				transformation = RecordTransformFactory.createTransform(
 						transformSource, transformClassName, this, inMetadata,
-						outMetadata, transformationParameters);
+						outMetadata, transformationParameters, this.getClass().getClassLoader());
 			}
 		} catch (Exception e) {
 			throw new ComponentNotReadyException(this, e);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MergeJoin.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MergeJoin.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MergeJoin.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -140,8 +140,7 @@
  * @since       April 4, 2002
  * @revision    $Revision$
  * @created     4. June 2003
- */
-/**
+ *
  * @author Jan Hadrava, Javlin Consulting (www.javlinconsulting.cz)
  *
  */
@@ -385,7 +384,7 @@
 			transformation.init(transformationParameters, inMetadata, outMetadata);
 		}else{
             transformation = RecordTransformFactory.createTransform(
-            		transformSource, transformClassName, this, inMetadata, outMetadata, transformationParameters);
+            		transformSource, transformClassName, this, inMetadata, outMetadata, transformationParameters, this.getClass().getClassLoader());
         }
 	}
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MultiLevelReader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MultiLevelReader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/MultiLevelReader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -220,7 +220,7 @@
 	 * @throws ComponentNotReadyException
 	 */
 	private TypeSelector createSelectorDynamic(String seltorCode) throws ComponentNotReadyException {
-		DynamicJavaCode dynCode = new DynamicJavaCode(seltorCode);
+		DynamicJavaCode dynCode = new DynamicJavaCode(seltorCode, this.getClass().getClassLoader());
         dynCode.setCaptureCompilerOutput(true);
         logger.info(&quot; (compiling dynamic source) &quot;);
         // use DynamicJavaCode to instantiate transformation class
@@ -256,7 +256,7 @@
         parser.setExceptionHandler(ParserExceptionHandlerFactory.getHandler(policyType));
 
         // initialize multifile reader based on prepared parser
-        reader = new MultiFileReader(parser, fileURL);
+        reader = new MultiFileReader(parser, getGraph().getProjectURL(), fileURL);
         reader.setLogger(logger);
         reader.setFileSkip(skipFirstLine ? 1 : 0);
         reader.setSkip(skipRows);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Normalizer.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Normalizer.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Normalizer.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -157,7 +157,7 @@
 	 * @throws ComponentNotReadyException
 	 */
 	private RecordNormalize createNormalizerDynamic(String normCode) throws ComponentNotReadyException {
-		DynamicJavaCode dynCode = new DynamicJavaCode(normCode);
+		DynamicJavaCode dynCode = new DynamicJavaCode(normCode, this.getClass().getClassLoader());
         dynCode.setCaptureCompilerOutput(true);
         logger.info(&quot; (compiling dynamic source) &quot;);
         // use DynamicJavaCode to instantiate transformation class

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Partition.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Partition.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Partition.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -257,7 +257,7 @@
 			function.setGraph(getGraph());
 			return function;
 		}else{//get partition function form java code
-			DynamicJavaCode dynCode = new DynamicJavaCode(psorCode);
+			DynamicJavaCode dynCode = new DynamicJavaCode(psorCode, this.getClass().getClassLoader());
 	        dynCode.setCaptureCompilerOutput(true);
 	        logger.info(&quot; (compiling dynamic source) &quot;);
 	        // use DynamicJavaCode to instantiate transformation class

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Reformat.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Reformat.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Reformat.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -228,7 +228,7 @@
 		} else {
 		    transformation = RecordTransformFactory.createTransform(
 		            transform, transformClass, this, inMetadata,
-		            outMetadata, transformationParameters);
+		            outMetadata, transformationParameters, this.getClass().getClassLoader());
 		}
 	}
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/SequenceChecker.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/SequenceChecker.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/SequenceChecker.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -35,8 +35,8 @@
 import org.jetel.graph.Result;
 import org.jetel.graph.TransformationGraph;
 import org.jetel.util.ComponentXMLAttributes;
+import org.jetel.util.MiscUtils;
 import org.jetel.util.StringUtils;
-import org.jetel.util.MiscUtils;
 import org.w3c.dom.Element;
 /**
  *  &lt;h3&gt;Sequence Checker Component&lt;/h3&gt;
@@ -142,6 +142,7 @@
 		DataRecord[] records = {new DataRecord(inPort.getMetadata()), new DataRecord(inPort.getMetadata())};
 		records[0].init();
 		records[1].init();
+		boolean error = false; 
 		
 		while ((records[current] = inPort.readRecord(records[current])) != null &amp;&amp; runIt) {
 			if (isFirst) {
@@ -150,13 +151,18 @@
 				compareResult = recordComparator.compare(records[current], records[previous]);
 
 				if (compareResult == 0) {
-					if (uniqueKeys) 
-						return Result.ERROR;
+					if (uniqueKeys) {
+						error = true;
+						break;
+					}
 				} else if (compareResult &gt; 0) {
-					if (!sortOrderAscending) 
-						return Result.ERROR;
+					if (!sortOrderAscending) {
+						error = true;
+						break;
+					}
 				} else if (sortOrderAscending) {
-					return Result.ERROR;
+					error = true;
+					break;
 				}
 			}
 			
@@ -167,7 +173,8 @@
 			previous = previous ^ 1;
 		}
 		if (isOutPort) broadcastEOF();
-        return runIt ? Result.FINISHED_OK : Result.ABORTED;
+		Result result = error ? Result.ERROR : Result.FINISHED_OK;
+        return runIt ? result : Result.ABORTED;
 	}
 
 	@Override

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/StructureWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/StructureWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/StructureWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -225,7 +225,7 @@
 		super.init();
 		// based on file mask, create/open output file
 		try {
-			writer = FileUtils.getWritableChannel(fileURL, appendData);
+			writer = FileUtils.getWritableChannel(getGraph().getProjectURL(), fileURL, appendData);
 			buffer = ByteBuffer.allocateDirect(StringUtils.getMaxLength(header,footer));
 			formatter.init(getInputPort(READ_FROM_PORT).getMetadata());
             formatter.setDataTarget(writer);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Trash.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Trash.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/Trash.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -22,8 +22,10 @@
 import java.io.BufferedOutputStream;
 import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
+import java.io.IOException;
 import java.io.PrintWriter;
 import java.nio.ByteBuffer;
+import java.nio.channels.Channels;
 
 import org.jetel.data.DataRecord;
 import org.jetel.data.Defaults;
@@ -37,6 +39,7 @@
 import org.jetel.graph.Result;
 import org.jetel.graph.TransformationGraph;
 import org.jetel.util.ComponentXMLAttributes;
+import org.jetel.util.FileUtils;
 import org.jetel.util.StringUtils;
 import org.jetel.util.SynchronizeUtils;
 import org.w3c.dom.Element;
@@ -189,8 +192,8 @@
 		if (debugPrint) {
             if(debugFilename != null) {
           		try {
-    				outStream = new PrintWriter(new BufferedOutputStream(new FileOutputStream(debugFilename)));
-    			} catch (FileNotFoundException ex) {
+    				outStream = new PrintWriter(Channels.newWriter(FileUtils.getWritableChannel(getGraph().getProjectURL(), debugFilename, false), Defaults.DataFormatter.DEFAULT_CHARSET_ENCODER));
+    			} catch (IOException ex) {
     				throw new ComponentNotReadyException(ex.getMessage());
     			}
             } else {

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSReader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSReader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSReader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -50,18 +50,19 @@
 /**
  *  &lt;h3&gt;XLS Reader Component&lt;/h3&gt;
  *
- * &lt;!-- Parses data from xls file and send the records to out ports. --&gt;
+ * &lt;!-- Parses data from xls file and send the records to output ports. --&gt;
  *
  * &lt;table border=&quot;1&quot;&gt;
  *  &lt;th&gt;Component:&lt;/th&gt;
  * &lt;tr&gt;&lt;td&gt;&lt;h4&gt;&lt;i&gt;Name:&lt;/i&gt;&lt;/h4&gt;&lt;/td&gt;
  * &lt;td&gt;XLSReader&lt;/td&gt;&lt;/tr&gt;
  * &lt;tr&gt;&lt;td&gt;&lt;h4&gt;&lt;i&gt;Category:&lt;/i&gt;&lt;/h4&gt;&lt;/td&gt;
- * &lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
+ * &lt;td&gt;Readers&lt;/td&gt;&lt;/tr&gt;
  * &lt;tr&gt;&lt;td&gt;&lt;h4&gt;&lt;i&gt;Description:&lt;/i&gt;&lt;/h4&gt;&lt;/td&gt;
- * &lt;td&gt;Parses data from xls file and send the records to out ports.&lt;br&gt;Because 
+ * &lt;td&gt;Parses data from xls file and send the records to output ports.&lt;br&gt;Because 
  * POI currently uses a lot of memory for large sheets, it is impossible to read 
- * large data (over ~4.3MB in xls file - 2.1MB in flat file)&lt;/td&gt;&lt;/tr&gt;
+ * large data (over ~4.3MB in xls file - 2.1MB in flat file). JExcel can handle 
+ * with bigger files (up to ~8.1MB in xls file - ~4.9MB in flat file)&lt;/td&gt;&lt;/tr&gt;
  * &lt;tr&gt;&lt;td&gt;&lt;h4&gt;&lt;i&gt;Inputs:&lt;/i&gt;&lt;/h4&gt;&lt;/td&gt;
  * &lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
  * &lt;tr&gt;&lt;td&gt;&lt;h4&gt;&lt;i&gt;Outputs:&lt;/i&gt;&lt;/h4&gt;&lt;/td&gt;
@@ -158,7 +159,7 @@
 	private int metadataRow = 0;
 	private String[][] fieldMap;
 	
-	private boolean usePOI = true;
+	public final static boolean usePOI = true;
 
 	/**
 	 * @param id
@@ -231,6 +232,11 @@
         return runIt ? Result.FINISHED_OK : Result.ABORTED;
 	}
 
+	@Override
+	public void free() {
+		super.free();
+		parser.close();
+	}
 	/*
 	 * (non-Javadoc)
 	 * 
@@ -412,6 +418,7 @@
 		if (metadataRow != 0){
 			parser.setMetadataRow(metadataRow-1);
 		}
+		//set proper mapping type beetwen clover and xls fields
 		if (fieldMap != null){
 			String[] cloverFields = new String[fieldMap.length];
 			String[] xlsFields = new String[fieldMap.length];

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.component/src/org/jetel/component/XLSWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -24,7 +24,6 @@
 import java.io.File;
 
 import org.jetel.data.DataRecord;
-import org.jetel.data.formatter.Formatter;
 import org.jetel.data.formatter.JExcelXLSDataFormatter;
 import org.jetel.data.formatter.XLSDataFormatter;
 import org.jetel.data.formatter.XLSFormatter;
@@ -56,7 +55,8 @@
  * &lt;td&gt;Reads data from input port and writes them to given xls sheet in xls file. If 
  *  in one graph you want to write to the same file but to different sheets each XLSWriter
  *  has to have another phase&lt;br&gt;Because POI currently uses a lot of memory for
- *   large sheets, it is impossible to save large data (over ~1.8MB) to xls file&lt;/td&gt;&lt;/tr&gt;
+ *   large sheets, it is impossible to save large data (over ~1.8MB) to xls file.
+ *   JExcel can handle with bigger files (up to ~5.7MB in flat file)&lt;/td&gt;&lt;/tr&gt;
  * &lt;tr&gt;&lt;td&gt;&lt;h4&gt;&lt;i&gt;Inputs:&lt;/i&gt;&lt;/h4&gt;&lt;/td&gt;
  * &lt;td&gt;one input port defined/connected.&lt;/td&gt;&lt;/tr&gt;
  * &lt;tr&gt;&lt;td&gt;&lt;h4&gt;&lt;i&gt;Outputs:&lt;/i&gt;&lt;/h4&gt;&lt;/td&gt;
@@ -202,15 +202,8 @@
 	public void init() throws ComponentNotReadyException {
 		super.init();
 		File out = new File(fileURL);
-//		try {
-//			if (!out.exists()){
-//				out.createNewFile();
-//			}
-			formatter.init(getInputPort(READ_FROM_PORT).getMetadata());
-            formatter.setDataTarget(out);
-//		}catch(IOException ex){
-//			throw new ComponentNotReadyException(ex);
-//		}
+		formatter.init(getInputPort(READ_FROM_PORT).getMetadata());
+		formatter.setDataTarget(out);
 	}
 
 	public static Node fromXML(TransformationGraph graph, Element nodeXML) throws XMLConfigurationException {
@@ -248,7 +241,7 @@
 		xmlElement.setAttribute(XML_FIRSTCOLUMN_ATTRIBUTE,String.valueOf(formatter.getFirstColumn()));
 		xmlElement.setAttribute(XML_FIRSTDATAROW_ATTRIBUTE, String.valueOf(formatter.getFirstRow()+1));
 		xmlElement.setAttribute(XML_NAMESROW_ATTRIBUTE, String.valueOf(formatter.getNamesRow()+1));
-		if (formatter.getSheetName() != null) {//TODO can't we obtain it from parser?
+		if (formatter.getSheetName() != null) {
 			xmlElement.setAttribute(XML_SHEETNAME_ATTRIBUTE,formatter.getSheetName());
 		}
 	}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/DBConnection.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/DBConnection.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/DBConnection.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -50,6 +50,7 @@
 import org.jetel.graph.TransformationGraph;
 import org.jetel.metadata.DataRecordMetadata;
 import org.jetel.util.ComponentXMLAttributes;
+import org.jetel.util.FileUtils;
 import org.jetel.util.PropertyRefResolver;
 import org.jetel.util.StringUtils;
 import org.jetel.util.crypto.Enigma;
@@ -202,16 +203,20 @@
         if(!StringUtils.isEmpty(configFileName)) {
             try {
                 InputStream stream = null;
-                if (!new File(configFileName).exists()) {
-                    // config file not found on file system - try classpath
-                    stream = getClass().getClassLoader().getResourceAsStream(configFileName);
-                    if(stream == null) {
-                        throw new FileNotFoundException(&quot;Config file for db connection &quot; + getId() + &quot; not found (&quot; + configFileName + &quot;)&quot;);
-                    }
-                    stream = new BufferedInputStream(stream);
-                } else {
-                    stream = new BufferedInputStream(new FileInputStream(configFileName));
-                }
+                URL url = FileUtils.getFileURL(getGraph().getProjectURL(), configFileName);
+                stream = url.openStream();
+
+//old code - last usage in 2.0                 
+//                if (!new File(configFileName).exists()) {
+//                    // config file not found on file system - try classpath
+//                    stream = getClass().getClassLoader().getResourceAsStream(configFileName);
+//                    if(stream == null) {
+//                        throw new FileNotFoundException(&quot;Config file for db connection &quot; + getId() + &quot; not found (&quot; + configFileName + &quot;)&quot;);
+//                    }
+//                    stream = new BufferedInputStream(stream);
+//                } else {
+//                    stream = new BufferedInputStream(new FileInputStream(configFileName));
+//                }
                 
                 this.config.load(stream);
                 stream.close();
@@ -239,6 +244,9 @@
 	 * @see java.sql.Connection#setTransactionIsolation(int)
 	 */
 	private void connect() {
+        if(!isInitialized()) {
+            throw new RuntimeException(&quot;DBConnection (&quot; + getId() +&quot;) is not initialized.&quot;);
+        }
 	    String dbDriverName;
 	    if (dbDriver==null){
 	        dbDriverName=config.getProperty(XML_DBDRIVER_ATTRIBUTE);
@@ -255,15 +263,10 @@
 	                	// try to create URL directly, if failed probably the protocol is missing, so use File.toURL
 	                    for(int i=0;i&lt;libraryPaths.length;i++){
 	                    	try {
-	                    		// valid url
-	                    		myURLs[i]=new URL(libraryPaths[i]);
+                                // valid url
+                                myURLs[i] = FileUtils.getFileURL(getGraph() == null ? null : getGraph().getProjectURL(), libraryPaths[i]);
 	                    	} catch (MalformedURLException ex1) {
-	                    		try {
-	                    			// probably missing protocol prefix, try to load it as a file
-	                    			myURLs[i] = new File(libraryPaths[i]).toURI().toURL();
-	                    		} catch (MalformedURLException ex2) {
-	                    			throw new RuntimeException(&quot;Malformed URL: &quot; + ex1.getMessage());
-	                    		}
+	                    	    throw new RuntimeException(&quot;Malformed URL: &quot; + ex1.getMessage());
 	                    	}
 	                }
 	                

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/JmsConnection.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/JmsConnection.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/src/org/jetel/connection/JmsConnection.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -19,11 +19,8 @@
 */
 package org.jetel.connection;
 
-import java.io.BufferedInputStream;
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.FileNotFoundException;
 import java.io.InputStream;
+import java.net.URL;
 import java.util.Hashtable;
 import java.util.Properties;
 
@@ -45,6 +42,7 @@
 import org.jetel.graph.TransformationGraph;
 import org.jetel.metadata.DataRecordMetadata;
 import org.jetel.util.ComponentXMLAttributes;
+import org.jetel.util.FileUtils;
 import org.w3c.dom.Element;
 
 /**
@@ -112,25 +110,28 @@
 		this.destId = destId;
 	}
 	
-	private static Properties readConfig(String cfgFile) {
+	private static Properties readConfig(URL contextURL, String cfgFile) {
 		Properties config = new Properties();
 		try {
             InputStream stream = null;
-            if (!new File(cfgFile).exists()) {
-                // config file not found on file system - try classpath
-                stream = JmsConnection.class.getClassLoader().getResourceAsStream(cfgFile);
-                if(stream == null) {
-                    throw new FileNotFoundException(&quot;Config file for JMS connection not found (&quot; + cfgFile +&quot;)&quot;);
-                }
-                stream = new BufferedInputStream(stream);
-            } else {
-                stream = new BufferedInputStream(new FileInputStream(cfgFile));
-            }
+            URL url = FileUtils.getFileURL(contextURL, cfgFile);
+            stream = url.openStream();
             
+//            if (!new File(cfgFile).exists()) {
+//                // config file not found on file system - try classpath
+//                stream = JmsConnection.class.getClassLoader().getResourceAsStream(cfgFile);
+//                if(stream == null) {
+//                    throw new FileNotFoundException(&quot;Config file for JMS connection not found (&quot; + cfgFile +&quot;)&quot;);
+//                }
+//                stream = new BufferedInputStream(stream);
+//            } else {
+//                stream = new BufferedInputStream(new FileInputStream(cfgFile));
+//            }
+            
 			config.load(stream);
 			stream.close();
 		} catch (Exception ex) {
-			throw new RuntimeException(ex);
+			throw new RuntimeException(&quot;Config file for JMS connection not found (&quot; + cfgFile +&quot;)&quot;, ex);
 		}
 		return config;
 	}
@@ -220,7 +221,7 @@
 		JmsConnection con;
 		try {
 			if (xattribs.exists(XML_CONFIG_ATTRIBUTE)) {
-				Properties config = readConfig(xattribs.getString(XML_CONFIG_ATTRIBUTE));
+				Properties config = readConfig(graph.getProjectURL(), xattribs.getString(XML_CONFIG_ATTRIBUTE));
 				con = new JmsConnection(xattribs.getString(XML_ID_ATTRIBUTE),
 						config.getProperty(XML_INICTX_FACTORY_ATTRIBUTE, null),
 						config.getProperty(XML_PROVIDER_URL_ATTRIBUTE, null),

Copied: branches/cloveretl.engine.rel-2-1-0/cloveretl.connection/test (from rev 2346, trunk/cloveretl.connection/test)

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/data/in/bad/FL28_NL_nulls.txt
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/data/in/bad/FL28_NL_nulls.txt	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/data/in/bad/FL28_NL_nulls.txt	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,3 +1 @@
-  N/AStone          01/11/93
--15.5          112  11/03/02
- -0.7Bone Broo    99        
\ No newline at end of file
+  N/AStone          01/11/93-15.5          112  11/03/02 -0.7Bone Broo    99        
\ No newline at end of file

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/BUGS.txt
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/BUGS.txt	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/BUGS.txt	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,3 +1,5 @@
 *******************************************************************************
                                  KNOWN BUGS
 *******************************************************************************
+
+- metadata defined by connection stub are not compatible with new checkConfig system
\ No newline at end of file

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/HISTORY.txt
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/HISTORY.txt	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/docs/HISTORY.txt	2007-01-31 14:29:53 UTC (rev 2420)
@@ -2,6 +2,34 @@
                           CLOVER ETL - HISTORY of RELEASES
 *******************************************************************************
 
+REL 2-1-0
+---------
+Changes/bug fixes:
++ Added new component &quot;Data Generator&quot; - generator of synthetic/random data
++ Added new component &quot;Lookup Table Reader/Writer&quot; - reader/writer of records from/to lookup table
++ Added new component &quot;Lookup Join&quot; - joins incoming data with selected lookup table
++ Added new component &quot;JMS Reader&quot; - receives JMS-messages
++ Added new component &quot;JMS Writer&quot; - sends JMS-messages
++ Added new component &quot;Normalizer&quot; - normalizes input records
++ Added new component &quot;Denormalizer&quot; - denormalizes input records
++ Added new component &quot;Structure writer&quot; - record mask formatter
++ Added new connection &quot;JMS connection&quot; - connection related with JSMReader and JMSWriter
++ developers can use new method for engine initialization - runGraph.initEngine()
++ new approach in DataField.setToDefaultValue() method;
+  in case the default value is not preset, engine tries to set the field value to null
++ DBConnection has new calling method order;
+  new DBConnection(), init(), getConnection()/getStatement(), free() 
+  (connect() method is now private - call init() method instead)
++ Extended LookupTable interface by put() and remove() methods
++ all GraphElement(s) should implement checkConfig() method; this method is used for
+  checking engine element configuration; related changes of transformation graph startup
+  are described in runGraph class comments
++ components (Node descendants) should not override direct run() method, instead 
+  for this purpose was introduced new execute() method
++ WatchDog thread has new wide logging and inter-component communication facilities
++ Added new data field type cbyte (compressed byte array)
++ All join components are ready to satisfy more slave input data streams
+
 REL 2-0-2
 ---------
 Release in particular repairing bugs from 2.0.1 version.

Copied: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/customizedTransformExample.java (from rev 2395, trunk/cloveretl.engine/examples/customizedTransformExample.java)

Copied: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/data/orders2.dat (from rev 2395, trunk/cloveretl.engine/examples/data/orders2.dat)

Copied: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/data/orders2.xls (from rev 2395, trunk/cloveretl.engine/examples/data/orders2.xls)

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphAproximativeJoin.grf
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphAproximativeJoin.grf	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphAproximativeJoin.grf	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,143 +1,139 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;Graph created=&quot;Tue Oct 24 13:04:40 CEST 2006&quot; description=&quot;This graph ilustrates usage of Aproximative Join component.&#10;This component requires prepared data: they have &#10;to have a key (component Key Generator creates it) &#10;and be sorted by this key.&quot; guiVersion=&quot;1.4&quot; licenseType=&quot;Evaluation license&quot; modified=&quot;Tue Oct 24 14:01:53 CEST 2006&quot; name=&quot;graphFixedLengthData&quot;&gt;
+&lt;Graph created=&quot;Tue Oct 24 13:04:40 CEST 2006&quot; description=&quot;This graph ilustrates usage of Aproximative Join component.&#10;This component requires prepared data: they have &#10;to have a key (component Key Generator creates it) &#10;and be sorted by this key.&quot; guiVersion=&quot;1.6&quot; licenseType=&quot;Unlicensed clover.GUI&quot; modified=&quot;Fri Jan 26 09:29:45 CET 2007&quot; name=&quot;graphFixedLengthData&quot; revision=&quot;1.5&quot;&gt;
 &lt;Global&gt;
 &lt;Metadata id=&quot;Metadata4&quot;&gt;
-&lt;Record name=&quot;conforming_out&quot; type=&quot;fixed&quot;&gt;
-&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;last_name&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;first_name&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;_total_conformity_&quot; nullable=&quot;true&quot; size=&quot;8&quot; type=&quot;numeric&quot;/&gt;
+&lt;Record name=&quot;conforming_out&quot; recordDelimiter=&quot;\n&quot; recordSize=&quot;71&quot; type=&quot;fixed&quot;&gt;
+&lt;Field name=&quot;no&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;3&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;last_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;first_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;_total_conformity_&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;8&quot; type=&quot;numeric&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Metadata id=&quot;Metadata0&quot;&gt;
-&lt;Record name=&quot;customer&quot; recordDelimiter=&quot;\n&quot; type=&quot;fixed&quot;&gt;
-&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
-&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;false&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Record name=&quot;customer&quot; recordDelimiter=&quot;&#10;&quot; recordSize=&quot;212&quot; type=&quot;fixed&quot;&gt;
+&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
+&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;false&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Metadata id=&quot;Metadata2&quot;&gt;
-&lt;Record name=&quot;customer_with_key&quot; type=&quot;fixed&quot;&gt;
-&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
-&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; size=&quot;28&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; size=&quot;28&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field locale=&quot;en.US&quot; name=&quot;key&quot; nullable=&quot;true&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
+&lt;Record name=&quot;customer_with_key&quot; recordSize=&quot;239&quot; type=&quot;fixed&quot;&gt;
+&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
+&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;28&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;28&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field locale=&quot;en.US&quot; name=&quot;key&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Metadata id=&quot;Metadata1&quot;&gt;
-&lt;Record name=&quot;employee&quot; type=&quot;delimited&quot;&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;employee_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;full_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;first_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;last_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;position_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;position_title&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;store_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;department_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birth_date&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;hire_date&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;end_date&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;salary&quot; nullable=&quot;true&quot; type=&quot;numeric&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;supervisor_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;education_level&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;marital_status&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;gender&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;\n&quot; name=&quot;management_role&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
+&lt;Record name=&quot;employee&quot; recordSize=&quot;-1&quot; type=&quot;delimited&quot;&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;employee_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;full_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;first_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;last_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;position_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;position_title&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;store_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;department_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birth_date&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;hire_date&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;end_date&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;salary&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;numeric&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;supervisor_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;education_level&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;marital_status&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;gender&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;\n&quot; name=&quot;management_role&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Metadata id=&quot;Metadata3&quot;&gt;
-&lt;Record name=&quot;employee_with_key&quot; type=&quot;delimited&quot;&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;employee_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;full_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;first_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;last_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;position_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;position_title&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;store_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;department_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birth_date&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;hire_date&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;end_date&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;salary&quot; nullable=&quot;true&quot; type=&quot;numeric&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;supervisor_id&quot; nullable=&quot;true&quot; type=&quot;integer&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;education_level&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;marital_status&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;gender&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;management_role&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;\n&quot; locale=&quot;en.US&quot; name=&quot;key&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
+&lt;Record name=&quot;employee_with_key&quot; recordSize=&quot;-1&quot; type=&quot;delimited&quot;&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;employee_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;full_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;first_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;last_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;position_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;position_title&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;store_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;department_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birth_date&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;hire_date&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;end_date&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;salary&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;numeric&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;supervisor_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;education_level&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;marital_status&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;gender&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;management_role&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;\n&quot; locale=&quot;en.US&quot; name=&quot;key&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Metadata id=&quot;Metadata5&quot;&gt;
-&lt;Record name=&quot;suspicious&quot; type=&quot;delimited&quot;&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;lname&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;fname&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;gender&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;last_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;first_name&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birth_date&quot; nullable=&quot;true&quot; type=&quot;date&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; name=&quot;gender1&quot; nullable=&quot;true&quot; type=&quot;string&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; length=&quot;8&quot; name=&quot;_lname_conformity_&quot; nullable=&quot;true&quot; scale=&quot;2&quot; type=&quot;numeric&quot;/&gt;
-&lt;Field delimiter=&quot;;&quot; length=&quot;8&quot; name=&quot;_fname_conformity_&quot; nullable=&quot;true&quot; scale=&quot;2&quot; type=&quot;numeric&quot;/&gt;
-&lt;Field delimiter=&quot;\n&quot; length=&quot;8&quot; name=&quot;_total_conformity_&quot; nullable=&quot;true&quot; scale=&quot;2&quot; type=&quot;numeric&quot;/&gt;
+&lt;Record name=&quot;suspicious&quot; recordSize=&quot;-1&quot; type=&quot;delimited&quot;&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;lname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;fname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;gender&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;last_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;first_name&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;EEE MMM dd yyyy&quot; name=&quot;birth_date&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;gender1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; length=&quot;8&quot; name=&quot;_lname_conformity_&quot; nullable=&quot;true&quot; scale=&quot;2&quot; shift=&quot;0&quot; type=&quot;numeric&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; length=&quot;8&quot; name=&quot;_fname_conformity_&quot; nullable=&quot;true&quot; scale=&quot;2&quot; shift=&quot;0&quot; type=&quot;numeric&quot;/&gt;
+&lt;Field delimiter=&quot;\n&quot; length=&quot;8&quot; name=&quot;_total_conformity_&quot; nullable=&quot;true&quot; scale=&quot;2&quot; shift=&quot;0&quot; type=&quot;numeric&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Connection dbConfig=&quot;koule_postgre.cfg&quot; id=&quot;DBConnection0&quot; type=&quot;JDBC&quot;/&gt;
 &lt;Property fileURL=&quot;workspace.prm&quot; id=&quot;GraphParameter0&quot;/&gt;
+&lt;Sequence cached=&quot;10&quot; fileURL=&quot;id.seq&quot; id=&quot;Sequence0&quot; name=&quot;id&quot; start=&quot;1&quot; step=&quot;1&quot; type=&quot;SIMPLE_SEQUENCE&quot;/&gt;
 &lt;/Global&gt;
 &lt;Phase number=&quot;0&quot;&gt;
-&lt;Node conformity=&quot;0.8&quot; enabled=&quot;enabled&quot; guiHeight=&quot;67&quot; guiName=&quot;aproximative join&quot; guiWidth=&quot;122&quot; guiX=&quot;444&quot; guiY=&quot;176&quot; id=&quot;APROX_MERGE_JOIN1&quot; joinKey=&quot;lname 4 0.5 true false false false;fname 3 0.5 true false false false&quot; matchingKey=&quot;key&quot; type=&quot;APROX_MERGE_JOIN&quot;&gt;
-&lt;attr name=&quot;transform&quot;&gt;${out.0.lname} = ${in.0.lname};
-${out.0.fname} = ${in.0.fname};
-${out.0.last_name} = ${in.1.last_name};
-${out.0.first_name} = ${in.1.first_name};
-&lt;/attr&gt;
-&lt;attr name=&quot;slaveOverrideKey&quot;&gt;last_name;first_name&lt;/attr&gt;
+&lt;Node conformity=&quot;0.8&quot; enabled=&quot;enabled&quot; guiHeight=&quot;67&quot; guiName=&quot;aproximative join&quot; guiWidth=&quot;122&quot; guiX=&quot;444&quot; guiY=&quot;176&quot; id=&quot;APROX_MERGE_JOIN1&quot; joinKey=&quot;lname 4 0.5 true false false false;fname 3 0.5 true false false false&quot; matchingKey=&quot;key&quot; slaveOverrideKey=&quot;last_name;first_name&quot; transformClass=&quot;customizedTransformExample&quot; type=&quot;APROX_MERGE_JOIN&quot;&gt;
 &lt;attr name=&quot;transformForSuspicious&quot;&gt;${out.0.lname} = ${in.0.lname};
 ${out.0.fname} = ${in.0.fname};
 ${out.0.birthdate} = ${in.0.birthdate};
@@ -152,9 +148,15 @@
 &lt;Node append=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/employee.out&quot; guiHeight=&quot;69&quot; guiName=&quot;employee without pair&quot; guiWidth=&quot;118&quot; guiX=&quot;596&quot; guiY=&quot;303&quot; id=&quot;DELIMITED_DATA_WRITER_NIO1&quot; type=&quot;DELIMITED_DATA_WRITER&quot;/&gt;
 &lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;64&quot; guiName=&quot;Ext Sort&quot; guiWidth=&quot;95&quot; guiX=&quot;296&quot; guiY=&quot;92&quot; id=&quot;EXT_SORT0&quot; sortKey=&quot;key&quot; type=&quot;EXT_SORT&quot;/&gt;
 &lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;64&quot; guiName=&quot;Ext Sort&quot; guiWidth=&quot;111&quot; guiX=&quot;296&quot; guiY=&quot;259&quot; id=&quot;EXT_SORT1&quot; sortKey=&quot;key&quot; type=&quot;EXT_SORT&quot;/&gt;
-&lt;Node OneRecordPerLine=&quot;true&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/data/customers.dat&quot; guiHeight=&quot;72&quot; guiName=&quot;customer&quot; guiWidth=&quot;119&quot; guiX=&quot;7&quot; guiY=&quot;92&quot; id=&quot;FIXLEN_DATA_READER_NIO0&quot; type=&quot;FIXLEN_DATA_READER&quot;/&gt;
-&lt;Node OneRecordPerLine=&quot;true&quot; append=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/conforming.txt&quot; guiHeight=&quot;69&quot; guiName=&quot;joined - similarity greater then 0.8&quot; guiWidth=&quot;111&quot; guiX=&quot;596&quot; guiY=&quot;54&quot; id=&quot;FIXLEN_DATA_WRITER_NIO0&quot; type=&quot;FIXLEN_DATA_WRITER&quot;/&gt;
-&lt;Node OneRecordPerLine=&quot;true&quot; append=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/customers.out&quot; guiHeight=&quot;54&quot; guiName=&quot;customer without pair&quot; guiWidth=&quot;123&quot; guiX=&quot;596&quot; guiY=&quot;215&quot; id=&quot;FIXLEN_DATA_WRITER_NIO1&quot; type=&quot;FIXLEN_DATA_WRITER&quot;/&gt;
+&lt;Node byteMode=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/data/customers.dat&quot; guiHeight=&quot;72&quot; guiName=&quot;customer&quot; guiWidth=&quot;119&quot; guiX=&quot;7&quot; guiY=&quot;92&quot; id=&quot;FIXLEN_DATA_READER_NIO0&quot; type=&quot;FIXLEN_DATA_READER&quot;&gt;
+&lt;attr name=&quot;OneRecordPerLine&quot;&gt;true&lt;/attr&gt;
+&lt;/Node&gt;
+&lt;Node append=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/conforming.txt&quot; guiHeight=&quot;69&quot; guiName=&quot;joined - similarity greater then 0.8&quot; guiWidth=&quot;111&quot; guiX=&quot;596&quot; guiY=&quot;54&quot; id=&quot;FIXLEN_DATA_WRITER_NIO0&quot; type=&quot;FIXLEN_DATA_WRITER&quot;&gt;
+&lt;attr name=&quot;OneRecordPerLine&quot;&gt;true&lt;/attr&gt;
+&lt;/Node&gt;
+&lt;Node append=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/customers.out&quot; guiHeight=&quot;54&quot; guiName=&quot;customer without pair&quot; guiWidth=&quot;123&quot; guiX=&quot;596&quot; guiY=&quot;215&quot; id=&quot;FIXLEN_DATA_WRITER_NIO1&quot; type=&quot;FIXLEN_DATA_WRITER&quot;&gt;
+&lt;attr name=&quot;OneRecordPerLine&quot;&gt;true&lt;/attr&gt;
+&lt;/Node&gt;
 &lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;70&quot; guiName=&quot;Key generator&quot; guiWidth=&quot;138&quot; guiX=&quot;152&quot; guiY=&quot;92&quot; id=&quot;KEY_GEN0&quot; keyExpression=&quot;lname 4;fname 3&quot; type=&quot;KEY_GEN&quot;/&gt;
 &lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;88&quot; guiName=&quot;Key generator&quot; guiWidth=&quot;145&quot; guiX=&quot;152&quot; guiY=&quot;259&quot; id=&quot;KEY_GEN1&quot; keyExpression=&quot;last_name 4;first_name 3&quot; type=&quot;KEY_GEN&quot;/&gt;
 &lt;Edge fromNode=&quot;APROX_MERGE_JOIN1:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge0&quot; inPort=&quot;0 (joined - similarity greater then 0.8)&quot; metadata=&quot;Metadata4&quot; outPort=&quot;0 (aproximative join)&quot; toNode=&quot;FIXLEN_DATA_WRITER_NIO0:0&quot;/&gt;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphCloverData.grf
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphCloverData.grf	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphCloverData.grf	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,63 +1,63 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;Graph created=&quot;Tue Oct 24 10:36:22 CEST 2006&quot; guiVersion=&quot;1.5&quot; licenseType=&quot;Evaluation license&quot; modified=&quot;Tue Oct 31 09:00:37 CET 2006&quot; name=&quot;graphCLOVERData&quot; revision=&quot;1.27&quot;&gt;
+&lt;Graph created=&quot;Tue Oct 24 10:36:22 CEST 2006&quot; guiVersion=&quot;1.6&quot; licenseType=&quot;Unlicensed clover.GUI&quot; modified=&quot;Wed Jan 24 10:05:43 CET 2007&quot; name=&quot;graphCLOVERData&quot; revision=&quot;1.28&quot;&gt;
 &lt;Global&gt;
 &lt;Metadata id=&quot;Metadata0&quot;&gt;
-&lt;Record name=&quot;customer&quot; recordDelimiter=&quot;\n&quot; type=&quot;fixed&quot;&gt;
-&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
-&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Record name=&quot;customer&quot; recordDelimiter=&quot;&#10;&quot; recordSize=&quot;212&quot; type=&quot;fixed&quot;&gt;
+&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
+&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Metadata id=&quot;Metadata1&quot;&gt;
-&lt;Record name=&quot;customer1&quot; type=&quot;fixed&quot;&gt;
-&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
-&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
-&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
-&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
-&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
-&lt;Field name=&quot;size&quot; nullable=&quot;true&quot; size=&quot;10&quot; type=&quot;integer&quot;/&gt;
+&lt;Record name=&quot;customer1&quot; recordSize=&quot;222&quot; type=&quot;fixed&quot;&gt;
+&lt;Field name=&quot;customer_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;account_num&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;11&quot; type=&quot;long&quot;/&gt;
+&lt;Field name=&quot;lname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;fname&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;mi&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;address1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;30&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;city&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;7&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;state_province&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;6&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;postal_code&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;country&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;5&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;customer_region_id&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;4&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;phone1&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;phone2&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;12&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;birthdate&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;marital_status&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;yearly_income&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;13&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;gender&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;total_children&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;num_children_at_home&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;education&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;string&quot;/&gt;
+&lt;Field format=&quot;EEE MMM dd yyyy&quot; name=&quot;date_accnt_opened&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;15&quot; type=&quot;date&quot;/&gt;
+&lt;Field name=&quot;member_card&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;8&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;occupation&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;20&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;houseowner&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;string&quot;/&gt;
+&lt;Field name=&quot;num_cars_owned&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;1&quot; type=&quot;integer&quot;/&gt;
+&lt;Field name=&quot;size&quot; nullable=&quot;true&quot; shift=&quot;0&quot; size=&quot;10&quot; type=&quot;integer&quot;/&gt;
 &lt;/Record&gt;
 &lt;/Metadata&gt;
 &lt;Property fileURL=&quot;workspace.prm&quot; id=&quot;GraphParameter0&quot;/&gt;
@@ -65,22 +65,17 @@
 &lt;Phase number=&quot;0&quot;&gt;
 &lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/customers.clv.zip&quot; guiHeight=&quot;0&quot; guiName=&quot;CLOVER Data Writer&quot; guiWidth=&quot;0&quot; guiX=&quot;558&quot; guiY=&quot;118&quot; id=&quot;CLOVER_WRITER0&quot; saveIndex=&quot;true&quot; saveMetadata=&quot;true&quot; type=&quot;CLOVER_WRITER&quot;/&gt;
 &lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;0&quot; guiName=&quot;Concatenate&quot; guiWidth=&quot;0&quot; guiX=&quot;328&quot; guiY=&quot;118&quot; id=&quot;CONCATENATE0&quot; type=&quot;CONCATENATE&quot;/&gt;
-&lt;Node enableIncomplete=&quot;true&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/data/customers.???&quot; guiHeight=&quot;66&quot; guiName=&quot;customer from file&quot; guiWidth=&quot;130&quot; guiX=&quot;50&quot; guiY=&quot;44&quot; id=&quot;FIXLEN_DATA_READER0&quot; type=&quot;FIXLEN_DATA_READER&quot;&gt;
+&lt;Node byteMode=&quot;false&quot; enableIncomplete=&quot;true&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/data/customers.???&quot; guiHeight=&quot;66&quot; guiName=&quot;customer from file&quot; guiWidth=&quot;130&quot; guiX=&quot;50&quot; guiY=&quot;44&quot; id=&quot;FIXLEN_DATA_READER0&quot; type=&quot;FIXLEN_DATA_READER&quot;&gt;
 &lt;attr name=&quot;OneRecordPerLine&quot;&gt;true&lt;/attr&gt;
 &lt;/Node&gt;
-&lt;Node enableIncomplete=&quot;true&quot; enabled=&quot;enabled&quot; fileURL=&quot;zip:${WORKSPACE}/data/data.zip#customers.dat;&quot; guiHeight=&quot;0&quot; guiName=&quot;Fixed Length Data Reader&quot; guiWidth=&quot;0&quot; guiX=&quot;48&quot; guiY=&quot;168&quot; id=&quot;FIXLEN_DATA_READER1&quot; type=&quot;FIXLEN_DATA_READER&quot;/&gt;
+&lt;Node byteMode=&quot;false&quot; enableIncomplete=&quot;true&quot; enabled=&quot;enabled&quot; fileURL=&quot;zip:${WORKSPACE}/data/data.zip#customers.dat;&quot; guiHeight=&quot;0&quot; guiName=&quot;Fixed Length Data Reader&quot; guiWidth=&quot;0&quot; guiX=&quot;48&quot; guiY=&quot;168&quot; id=&quot;FIXLEN_DATA_READER1&quot; type=&quot;FIXLEN_DATA_READER&quot;/&gt;
 &lt;Edge debugMode=&quot;false&quot; fromNode=&quot;CONCATENATE0:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge2&quot; inPort=&quot;0 (CLOVER Data Writer)&quot; metadata=&quot;Metadata0&quot; outPort=&quot;0 (Concatenate)&quot; toNode=&quot;CLOVER_WRITER0:0&quot;/&gt;
 &lt;Edge debugMode=&quot;false&quot; fromNode=&quot;FIXLEN_DATA_READER0:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge0&quot; inPort=&quot;1 (Concatenate)&quot; metadata=&quot;Metadata0&quot; outPort=&quot;0 (customer from file)&quot; toNode=&quot;CONCATENATE0:1&quot;/&gt;
 &lt;Edge debugMode=&quot;false&quot; fromNode=&quot;FIXLEN_DATA_READER1:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge8&quot; inPort=&quot;0 (Concatenate)&quot; metadata=&quot;Metadata0&quot; outPort=&quot;0 (Fixed Length Data Reader)&quot; toNode=&quot;CONCATENATE0:0&quot;/&gt;
 &lt;/Phase&gt;
 &lt;Phase number=&quot;1&quot;&gt;
-&lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/customers.clv.zip&quot; guiHeight=&quot;0&quot; guiName=&quot;Clover Data Reader&quot; guiWidth=&quot;0&quot; guiX=&quot;55&quot; guiY=&quot;296&quot; id=&quot;CLOVER_READER0&quot; startRecord=&quot;10000&quot; type=&quot;CLOVER_READER&quot;/&gt;
-&lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/strucured_customers.txt&quot; guiHeight=&quot;0&quot; guiName=&quot;Structured Data Writer&quot; guiWidth=&quot;0&quot; guiX=&quot;559&quot; guiY=&quot;296&quot; id=&quot;STRUCTURE_WRITER0&quot; type=&quot;STRUCTURE_WRITER&quot;&gt;
-&lt;attr name=&quot;mask&quot;&gt;&lt;Customer id=$customer_id&gt;
-	&lt;last name = $lname&gt;
-	&lt;first name = $fname&gt;
-&lt;/Customer&gt;
-&lt;/attr&gt;
+&lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/customers.clv.zip&quot; guiHeight=&quot;0&quot; guiName=&quot;Clover Data Reader&quot; guiWidth=&quot;0&quot; guiX=&quot;55&quot; guiY=&quot;296&quot; id=&quot;CLOVER_READER0&quot; indexFileURL=&quot;Index file URL&#9;&quot; startRecord=&quot;10&quot; type=&quot;CLOVER_READER&quot;/&gt;
+&lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/strucured_customers.txt&quot; guiHeight=&quot;0&quot; guiName=&quot;Structured Data Writer&quot; guiWidth=&quot;0&quot; guiX=&quot;559&quot; guiY=&quot;296&quot; id=&quot;STRUCTURE_WRITER0&quot; mask=&quot;&lt;Customer id=$customer_id&gt;&#10;&#9;&lt;last name = $lname&gt;&#10;&#9;&lt;first name = $fname&gt;&#10;&lt;/Customer&gt;&#10;&quot; type=&quot;STRUCTURE_WRITER&quot;&gt;
 &lt;attr name=&quot;header&quot;&gt;dir = ${WORKSPACE}
 &lt;/attr&gt;
 &lt;attr name=&quot;footer&quot;&gt;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphDBLoad5.grf
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphDBLoad5.grf	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphDBLoad5.grf	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,5 +1,5 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;Graph description=&quot;This graph illustrates usage of dbFields and cloverFields parameters of&#10;DB_OUTPUT_TABLE component.&#10;Parameter dbFields allows to specify that only certain fields of target DB table&#10;will be populated.&#10;Parameter cloverFields allows to specify which input/Clover fields are used&#10;for populating target fields.&#10;The final mapping is determined by the order in which Clover fields and DB fields appear&#10;in the parameters.&#10;Note: in this example, input field LAST_NAME is mapped onto FIRST_NAME in DB and&#10;input field FIRST_NAME onto LAST_NAME in DB.&#10;Note2: parameter batchMode allows for grouping of inserts into DB thus increasing throughput. It works&#10;only with DBs/JDBC drivers which support this feature (e.g. Oracle).&#10;&quot; name=&quot;TestingDBOutputTable&quot;&gt;
+&lt;Graph created=&quot;Wed Jan 24 09:02:52 CET 2007&quot; description=&quot;This graph illustrates usage of dbFields and cloverFields parameters of&#10;DB_OUTPUT_TABLE component.&#10;Parameter dbFields allows to specify that only certain fields of target DB table&#10;will be populated.&#10;Parameter cloverFields allows to specify which input/Clover fields are used&#10;for populating target fields.&#10;The final mapping is determined by the order in which Clover fields and DB fields appear&#10;in the parameters.&#10;Note: in this example, input field LAST_NAME is mapped onto FIRST_NAME in DB and&#10;input field FIRST_NAME onto LAST_NAME in DB.&#10;Note2: parameter batchMode allows for grouping of inserts into DB thus increasing throughput. It works&#10;only with DBs/JDBC drivers which support this feature (e.g. Oracle).&#10;&quot; guiVersion=&quot;1.6&quot; licenseType=&quot;Unlicensed clover.GUI&quot; modified=&quot;Wed Jan 24 10:55:54 CET 2007&quot; name=&quot;TestingDBOutputTable&quot; revision=&quot;1.0&quot;&gt;
 &lt;Global&gt;
 &lt;Metadata fileURL=&quot;metadata/employeeDB.fmt&quot; id=&quot;InMetadata&quot;/&gt;
 &lt;Connection dbConfig=&quot;koule_postgre.cfg&quot; id=&quot;DBConnection0&quot; type=&quot;JDBC&quot;/&gt;
@@ -7,7 +7,7 @@
 &lt;/Global&gt;
 &lt;Phase number=&quot;0&quot;&gt;
 &lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/employees.list.dat&quot; guiHeight=&quot;25&quot; guiName=&quot;INPUT&quot; guiWidth=&quot;50&quot; guiX=&quot;20&quot; guiY=&quot;20&quot; id=&quot;INPUT&quot; type=&quot;DELIMITED_DATA_READER&quot;/&gt;
-&lt;Node batchMode=&quot;false&quot; cloverFields=&quot;LAST_NAME;FIRST_NAME&quot; commit=&quot;300&quot; dbConnection=&quot;DBConnection0&quot; dbFields=&quot;FIRST_NAME;LAST_NAME&quot; dbTable=&quot;employee_tmp&quot; enabled=&quot;enabled&quot; guiHeight=&quot;25&quot; guiName=&quot;OUTPUT&quot; guiWidth=&quot;50&quot; guiX=&quot;195&quot; guiY=&quot;20&quot; id=&quot;OUTPUT&quot; type=&quot;DB_OUTPUT_TABLE&quot;/&gt;
+&lt;Node batchMode=&quot;false&quot; commit=&quot;300&quot; dbConnection=&quot;DBConnection0&quot; dbTable=&quot;employee_tmp&quot; enabled=&quot;enabled&quot; fieldMap=&quot;FIRST_NAME=first_name;LAST_NAME=last_name&quot; guiHeight=&quot;25&quot; guiName=&quot;OUTPUT&quot; guiWidth=&quot;50&quot; guiX=&quot;195&quot; guiY=&quot;20&quot; id=&quot;OUTPUT&quot; type=&quot;DB_OUTPUT_TABLE&quot;/&gt;
 &lt;Edge fromNode=&quot;INPUT:0&quot; guiBendpoints=&quot;&quot; id=&quot;INEDGE2&quot; inPort=&quot;0 (OUTPUT)&quot; metadata=&quot;InMetadata&quot; outPort=&quot;0 (INPUT)&quot; toNode=&quot;OUTPUT:0&quot;/&gt;
 &lt;/Phase&gt;
 &lt;/Graph&gt;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphExtFilter.grf
===================================================================
(Binary files differ)

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphIntersectData.grf
===================================================================
(Binary files differ)

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphJoinMergeInline.grf
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphJoinMergeInline.grf	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/graphJoinMergeInline.grf	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,41 +1,20 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;Graph description=&quot;This graph demonstrates how to use MERGE_JOIN component for 3way join.&quot; name=&quot;Testing Hash Joiner&quot;&gt;
+&lt;Graph created=&quot;Tue Jan 16 09:47:22 CET 2007&quot; guiVersion=&quot;1.6&quot; licenseType=&quot;Unlicensed clover.GUI&quot; modified=&quot;Wed Jan 24 09:27:14 CET 2007&quot; name=&quot;test&quot; revision=&quot;1.60&quot;&gt;
 &lt;Global&gt;
-&lt;Metadata fileURL=&quot;metadata/orders.fmt&quot; id=&quot;InMetadata1&quot;/&gt;
-&lt;Metadata fileURL=&quot;metadata/employees.fmt&quot; id=&quot;InMetadata2&quot;/&gt;
-&lt;Metadata fileURL=&quot;metadata/joinedOrders3way.fmt&quot; id=&quot;OutMetadata&quot;/&gt;
+&lt;Metadata fileURL=&quot;metadata/employees.fmt&quot; id=&quot;Metadata0&quot;/&gt;
+&lt;Metadata fileURL=&quot;metadata/joinedOrders3way.fmt&quot; id=&quot;Metadata1&quot;/&gt;
+&lt;Metadata fileURL=&quot;metadata/ordersFix.fmt&quot; id=&quot;Metadata2&quot;/&gt;
 &lt;Property fileURL=&quot;workspace.prm&quot; id=&quot;GraphParameter0&quot;/&gt;
 &lt;/Global&gt;
 &lt;Phase number=&quot;0&quot;&gt;
-&lt;Node enabled=&quot;enabled&quot; id=&quot;INPUT1&quot; type=&quot;DELIMITED_DATA_READER&quot;
-fileURL=&quot;${WORKSPACE}/data/orders.dat&quot;
-/&gt;
-&lt;Node enabled=&quot;enabled&quot; id=&quot;INPUT2&quot; type=&quot;DELIMITED_DATA_READER&quot;
-fileURL=&quot;${WORKSPACE}/data/employees.dat&quot;
-/&gt;
-&lt;Node enabled=&quot;enabled&quot; id=&quot;INPUT3&quot; type=&quot;DELIMITED_DATA_READER&quot;
-fileURL=&quot;${WORKSPACE}/data/employees.dat&quot;
-/&gt;
-
-&lt;Node enabled=&quot;enabled&quot; id=&quot;SORT1&quot; type=&quot;SORT&quot;
-sortKey=&quot;EmployeeID&quot; 
-/&gt;
-&lt;Node enabled=&quot;enabled&quot; id=&quot;SORT2&quot; type=&quot;SORT&quot;
-sortKey=&quot;EmployeeID&quot; 
-/&gt;
-&lt;Node enabled=&quot;enabled&quot; id=&quot;SORT3&quot; type=&quot;SORT&quot;
-sortKey=&quot;ReportsTo&quot; 
-/&gt;
-
-&lt;Edge fromNode=&quot;INPUT1:0&quot; id=&quot;INEDGE1s&quot; metadata=&quot;InMetadata1&quot;  toNode=&quot;SORT1:0&quot;/&gt;
-&lt;Edge fromNode=&quot;INPUT2:0&quot; id=&quot;INEDGE2s&quot; metadata=&quot;InMetadata2&quot;  toNode=&quot;SORT2:0&quot;/&gt;
-&lt;Edge fromNode=&quot;INPUT3:0&quot; id=&quot;INEDGE3s&quot; metadata=&quot;InMetadata2&quot;  toNode=&quot;SORT3:0&quot;/&gt;
-
-&lt;Node enabled=&quot;enabled&quot; id=&quot;JOIN&quot; type=&quot;MERGE_JOIN&quot;
-joinKey=&quot;EmployeeID=EmployeeID#EmployeeID=ReportsTo&quot;
-joinType=&quot;leftOuter&quot;
-slaveDuplicates=&quot;true&quot;
-&gt;&lt;attr name=&quot;transform&quot;&gt;
+&lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/data/employees.dat&quot; guiHeight=&quot;0&quot; guiName=&quot;Universal Data Reader&quot; guiWidth=&quot;0&quot; guiX=&quot;47&quot; guiY=&quot;276&quot; id=&quot;DATA_READER0&quot; type=&quot;DATA_READER&quot;/&gt;
+&lt;Node enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/data/employees.dat&quot; guiHeight=&quot;0&quot; guiName=&quot;Delimited Data Reader&quot; guiWidth=&quot;0&quot; guiX=&quot;47&quot; guiY=&quot;190&quot; id=&quot;DELIMITED_DATA_READER0&quot; type=&quot;DELIMITED_DATA_READER&quot;/&gt;
+&lt;Node append=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/joined_data_hash.out&quot; guiHeight=&quot;0&quot; guiName=&quot;Delimited Data Writer&quot; guiWidth=&quot;0&quot; guiX=&quot;656&quot; guiY=&quot;190&quot; id=&quot;DELIMITED_DATA_WRITER0&quot; type=&quot;DELIMITED_DATA_WRITER&quot;/&gt;
+&lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;0&quot; guiName=&quot;Ext Sort&quot; guiWidth=&quot;0&quot; guiX=&quot;275&quot; guiY=&quot;83&quot; id=&quot;EXT_SORT0&quot; sortKey=&quot;EmployeeID&quot; type=&quot;EXT_SORT&quot;/&gt;
+&lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;0&quot; guiName=&quot;Ext Sort&quot; guiWidth=&quot;0&quot; guiX=&quot;275&quot; guiY=&quot;190&quot; id=&quot;EXT_SORT1&quot; sortKey=&quot;EmployeeID&quot; type=&quot;EXT_SORT&quot;/&gt;
+&lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;0&quot; guiName=&quot;Ext Sort&quot; guiWidth=&quot;0&quot; guiX=&quot;275&quot; guiY=&quot;276&quot; id=&quot;EXT_SORT2&quot; sortKey=&quot;ReportsTo&quot; type=&quot;EXT_SORT&quot;/&gt;
+&lt;Node enabled=&quot;enabled&quot; guiHeight=&quot;0&quot; guiName=&quot;Ext Merge Join&quot; guiWidth=&quot;0&quot; guiX=&quot;480&quot; guiY=&quot;190&quot; id=&quot;MERGE_JOIN1&quot; joinKey=&quot;EmployeeID=EmployeeID#EmployeeID=ReportsTo&quot; type=&quot;MERGE_JOIN&quot;&gt;
+&lt;attr name=&quot;transform&quot;&gt;
 import org.jetel.component.DataRecordTransform;
 import org.jetel.data.*;
 
@@ -67,14 +46,13 @@
 
 &lt;/attr&gt;
 &lt;/Node&gt;
-
-&lt;Node append=&quot;false&quot; enabled=&quot;enabled&quot; fileURL=&quot;${WORKSPACE}/output/joined_data_hash.out&quot; guiHeight=&quot;25&quot; guiName=&quot;WRITER&quot; guiWidth=&quot;50&quot; guiX=&quot;370&quot; guiY=&quot;20&quot; id=&quot;WRITER&quot; type=&quot;DELIMITED_DATA_WRITER&quot;/&gt;
-
-&lt;Edge fromNode=&quot;SORT1:0&quot; guiBendpoints=&quot;&quot; id=&quot;INEDGE1&quot; inPort=&quot;0 (JOIN)&quot; metadata=&quot;InMetadata1&quot; outPort=&quot;0 (INPUT1)&quot; toNode=&quot;JOIN:0&quot;/&gt;
-&lt;Edge fromNode=&quot;SORT2:0&quot; guiBendpoints=&quot;&quot; id=&quot;INEDGE2&quot; inPort=&quot;1 (JOIN)&quot; metadata=&quot;InMetadata2&quot; outPort=&quot;0 (INPUT2)&quot; toNode=&quot;JOIN:1&quot;/&gt;
-&lt;Edge fromNode=&quot;SORT3:0&quot; guiBendpoints=&quot;&quot; id=&quot;INEDGE3&quot; inPort=&quot;2 (JOIN)&quot; metadata=&quot;InMetadata2&quot; outPort=&quot;0 (INPUT3)&quot; toNode=&quot;JOIN:2&quot;/&gt;
-
-&lt;Edge fromNode=&quot;JOIN:0&quot; guiBendpoints=&quot;&quot; id=&quot;OUTEDGE&quot; inPort=&quot;0 (WRITER)&quot; metadata=&quot;OutMetadata&quot; outPort=&quot;0 (JOIN)&quot; toNode=&quot;WRITER:0&quot;/&gt;
-
+&lt;Node enabled=&quot;enabled&quot; fieldMap=&quot;OrderID=$A;CustomerID=$B;EmployeeID=$C;OrderDate=$D;RequiredDate=$E;ShippedDate=$F;ShipVia=$G;Freight=$H;ShipName=$I;ShipAddress=$J;ShipCity=$K;ShipRegion=$L;ShipPostalCode=$M;ShipCountry=$N&quot; fileURL=&quot;${WORKSPACE}/data/orders2.xls&quot; guiHeight=&quot;0&quot; guiName=&quot;XLS Data Reader&quot; guiWidth=&quot;0&quot; guiX=&quot;48&quot; guiY=&quot;83&quot; id=&quot;XLS_READER0&quot; metadataRow=&quot;1&quot; startRow=&quot;2&quot; type=&quot;XLS_READER&quot;/&gt;
+&lt;Edge fromNode=&quot;DATA_READER0:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge2&quot; inPort=&quot;0 (Ext Sort)&quot; metadata=&quot;Metadata0&quot; outPort=&quot;0 (Universal Data Reader)&quot; toNode=&quot;EXT_SORT2:0&quot;/&gt;
+&lt;Edge fromNode=&quot;DELIMITED_DATA_READER0:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge1&quot; inPort=&quot;0 (Ext Sort)&quot; metadata=&quot;Metadata0&quot; outPort=&quot;0 (Delimited Data Reader)&quot; toNode=&quot;EXT_SORT1:0&quot;/&gt;
+&lt;Edge debugMode=&quot;false&quot; fromNode=&quot;EXT_SORT0:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge3&quot; inPort=&quot;0 (Ext Merge Join)&quot; metadata=&quot;Metadata2&quot; outPort=&quot;0 (Ext Sort)&quot; toNode=&quot;MERGE_JOIN1:0&quot;/&gt;
+&lt;Edge debugMode=&quot;false&quot; fromNode=&quot;EXT_SORT1:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge4&quot; inPort=&quot;1 (Ext Merge Join)&quot; metadata=&quot;Metadata0&quot; outPort=&quot;0 (Ext Sort)&quot; toNode=&quot;MERGE_JOIN1:1&quot;/&gt;
+&lt;Edge debugMode=&quot;false&quot; fromNode=&quot;EXT_SORT2:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge5&quot; inPort=&quot;2 (Ext Merge Join)&quot; metadata=&quot;Metadata0&quot; outPort=&quot;0 (Ext Sort)&quot; toNode=&quot;MERGE_JOIN1:2&quot;/&gt;
+&lt;Edge debugMode=&quot;false&quot; fromNode=&quot;MERGE_JOIN1:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge6&quot; inPort=&quot;0 (Delimited Data Writer)&quot; metadata=&quot;Metadata1&quot; outPort=&quot;0 (Ext Merge Join)&quot; toNode=&quot;DELIMITED_DATA_WRITER0:0&quot;/&gt;
+&lt;Edge fromNode=&quot;XLS_READER0:0&quot; guiBendpoints=&quot;&quot; id=&quot;Edge0&quot; inPort=&quot;0 (Ext Sort)&quot; metadata=&quot;Metadata2&quot; outPort=&quot;0 (XLS Data Reader)&quot; toNode=&quot;EXT_SORT0:0&quot;/&gt;
 &lt;/Phase&gt;
 &lt;/Graph&gt;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/metadata/employees.fmt
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/metadata/employees.fmt	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/examples/metadata/employees.fmt	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,20 +1,20 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;Record name=&quot;Employees&quot; type=&quot;delimited&quot;&gt;
-	&lt;Field name=&quot;EmployeeID&quot; type=&quot;string&quot; delimiter=&quot;;&quot; /&gt;
-	&lt;Field name=&quot;LastName&quot; type=&quot;string&quot; delimiter=&quot;;&quot; format=&quot;#&quot; /&gt;
-	&lt;Field name=&quot;FirstName&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;Title&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;TitleInCourtesy&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;BirthDate&quot; type=&quot;date&quot; delimiter=&quot;;&quot; format=&quot;dd/MM/yyyy&quot; /&gt;
-	&lt;Field name=&quot;HireDate&quot; type=&quot;date&quot; delimiter=&quot;;&quot; format=&quot;dd/MM/yyyy&quot; /&gt;
-	&lt;Field name=&quot;Address&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;City&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;Region&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;PostalCode&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;Country&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;Phone&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;Extension&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;Photo&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;Memo&quot; type=&quot;string&quot; delimiter=&quot;;&quot;/&gt;
-	&lt;Field name=&quot;ReportsTo&quot; type=&quot;string&quot; delimiter=&quot;\n&quot;/&gt;
+&lt;Record name=&quot;Employees&quot; recordDelimiter=&quot;&quot; recordSize=&quot;-1&quot; type=&quot;delimited&quot;&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;EmployeeID&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;#&quot; name=&quot;LastName&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;FirstName&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Title&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;TitleInCourtesy&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;dd/MM/yyyy&quot; name=&quot;BirthDate&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; format=&quot;dd/MM/yyyy&quot; name=&quot;HireDate&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;date&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Address&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;City&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Region&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;PostalCode&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Country&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Phone&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Extension&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Photo&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;;&quot; name=&quot;Memo&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;string&quot;/&gt;
+&lt;Field delimiter=&quot;\r\n&quot; name=&quot;ReportsTo&quot; nullable=&quot;true&quot; shift=&quot;0&quot; type=&quot;integer&quot;/&gt;
 &lt;/Record&gt;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/CustomizedRecordTransform.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/CustomizedRecordTransform.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/CustomizedRecordTransform.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1417,7 +1417,6 @@
 							count++;
 							outFieldsName[i][j] = null;
 							inFieldsName[i][index] = null;
-							break;
 						}
 					}
 				}				
@@ -1431,11 +1430,10 @@
 						index = StringUtils.findString(outFieldsName[i][j],
 								inFieldsName[k]);
 						if (index &gt; -1) {//output field name found amoung input fields
-							if (putMapping(i, j, i, index, rule, transformMap)){
+							if (putMapping(i, j, k, index, rule, transformMap)){
 								count++;
 								outFieldsName[i][j] = null;
 								inFieldsName[k][index] = null;
-								break;
 							}
 						}
 					}					
@@ -1453,7 +1451,6 @@
 							count++;
 							outFieldsName[i][j] = null;
 							inFieldsName[i][index] = null;
-							break;
 						}
 					}
 				}				
@@ -1467,11 +1464,10 @@
 						index = StringUtils.findStringIgnoreCase(
 								outFieldsName[i][j], inFieldsName[k]);
 						if (index &gt; -1) {//output field name found amoung input fields
-							if (putMapping(i, j, i, index, rule, transformMap)){
+							if (putMapping(i, j, k, index, rule, transformMap)){
 								count++;
 								outFieldsName[i][j] = null;
 								inFieldsName[k][index] = null;
-								break;
 							}
 						}
 					}					
@@ -1621,9 +1617,9 @@
 				sequenceID = ruleString.indexOf(DOT) == -1 ? ruleString
 						: ruleString.substring(0, ruleString.indexOf(DOT));
 				try {
-						target[order[i][REC_NO]].getField(order[i][FIELD_NO]).setValue(
+						target[order[i][REC_NO]].getField(order[i][FIELD_NO]).fromString(
 								transformMapArray[order[i][REC_NO]][order[i][FIELD_NO]]
-										.getValue(getGraph().getSequence(sequenceID)));
+										.getValue(getGraph().getSequence(sequenceID)).toString());
 					} catch (BadDataFormatException e) {
 						errorMessage = &quot;Can't set value from sequence &quot; + sequenceID + 
 							&quot; to field &quot; + targetMetadata[order[i][REC_NO]].getName() + 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/RecordTransformFactory.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/RecordTransformFactory.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/component/RecordTransformFactory.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -23,7 +23,6 @@
  */
 package org.jetel.component;
 
-import java.io.File;
 import java.net.MalformedURLException;
 import java.net.URL;
 import java.net.URLClassLoader;
@@ -37,6 +36,7 @@
 import org.jetel.metadata.DataRecordMetadata;
 import org.jetel.util.CodeParser;
 import org.jetel.util.DynamicJavaCode;
+import org.jetel.util.FileUtils;
 
 public class RecordTransformFactory {
 
@@ -50,7 +50,7 @@
     public static final Pattern PATTERN_PREPROCESS_1 = Pattern.compile(&quot;\\$\\{out\\.&quot;); 
     public static final Pattern PATTERN_PREPROCESS_2 = Pattern.compile(&quot;\\$\\{in\\.&quot;); 
     
-    public static RecordTransform createTransform(String transform, String transformClass, Node node, DataRecordMetadata[] inMetadata, DataRecordMetadata[] outMetadata, Properties transformationParameters) throws ComponentNotReadyException {
+    public static RecordTransform createTransform(String transform, String transformClass, Node node, DataRecordMetadata[] inMetadata, DataRecordMetadata[] outMetadata, Properties transformationParameters, ClassLoader classLoader) throws ComponentNotReadyException {
         RecordTransform transformation = null;
         Log logger = LogFactory.getLog(node.getClass());
         
@@ -67,7 +67,7 @@
             switch (guessTransformType(transform)) {
             case TRANSFORM_JAVA_SOURCE:
                 // try compile transform parameter as java code
-                DynamicJavaCode dynaTransCode = new DynamicJavaCode(transform);
+                DynamicJavaCode dynaTransCode = new DynamicJavaCode(transform, classLoader);
                 transformation = RecordTransformFactory.loadClassDynamic(
                         logger, dynaTransCode);
                 break;
@@ -77,7 +77,7 @@
             case TRANSFORM_JAVA_PREPROCESS:
                 transformation = RecordTransformFactory.loadClassDynamic(
                         logger, &quot;Transform&quot; + node.getId(), transform,
-                        inMetadata, outMetadata);
+                        inMetadata, outMetadata, classLoader);
                 break;
             default:
                 // logger.error(&quot;Can't determine transformation code type at
@@ -100,7 +100,7 @@
     
     public static RecordTransform loadClass(Log logger, String transformClass) throws ComponentNotReadyException {
         //TODO parsing url from transformClass parameter
-        return loadClass(logger, transformClass, null);
+        return loadClass(logger, transformClass, null, null);
     }
     
     /**
@@ -111,7 +111,7 @@
      * @throws ComponentNotReadyException
      */
     public static RecordTransform loadClass(Log logger,
-            String transformClassName, String[] libraryPaths)
+            String transformClassName, URL contextURL, String[] libraryPaths)
             throws ComponentNotReadyException {
         RecordTransform transformation = null;
         // try to load in transformation class &amp; instantiate
@@ -134,16 +134,9 @@
             for (int i = 0; i &lt; libraryPaths.length; i++) {
                 try {
                     // valid url
-                    myURLs[i] = new URL(libraryPaths[i]);
-                } catch (MalformedURLException ex1) {
-                    try {
-                        // probably missing protocol prefix, try to load it as a
-                        // file
-                        myURLs[i] = new File(libraryPaths[i]).toURI().toURL();
-                    } catch (MalformedURLException ex2) {
-                        throw new ComponentNotReadyException(&quot;Malformed URL: &quot;
-                                + ex1.getMessage());
-                    }
+                    myURLs[i] = FileUtils.getFileURL(contextURL, libraryPaths[i]);
+                } catch (MalformedURLException e) {
+                    throw new ComponentNotReadyException(&quot;Malformed URL: &quot; + e.getMessage());
                 }
             }
             try {
@@ -173,7 +166,7 @@
      */
     public static RecordTransform loadClassDynamic(Log logger,
             String className, String transformCode,
-            DataRecordMetadata[] inMetadata, DataRecordMetadata[] outMetadata)
+            DataRecordMetadata[] inMetadata, DataRecordMetadata[] outMetadata, ClassLoader classLoader)
             throws ComponentNotReadyException {
         DynamicJavaCode dynamicTransformCode;
         // creating dynamicTransformCode from internal transformation format
@@ -182,7 +175,7 @@
         codeParser.parse();
         codeParser.addTransformCodeStub(&quot;Transform&quot; + className);
 
-        dynamicTransformCode = new DynamicJavaCode(codeParser.getSourceCode());
+        dynamicTransformCode = new DynamicJavaCode(codeParser.getSourceCode(), classLoader);
         return loadClassDynamic(logger,dynamicTransformCode);
     }
     

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/ByteDataField.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/ByteDataField.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/ByteDataField.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -476,7 +476,11 @@
 		if (isNull) return -1;
 		
 		if (obj instanceof ByteDataField){
-			byteObj = ((ByteDataField) obj).value;
+			if (!((ByteDataField) obj).isNull()) {
+				byteObj = ((ByteDataField) obj).value;
+			}else {
+				return 1; 			
+			}
 		}else if (obj instanceof byte[]){
 			byteObj= (byte[])obj;
 		}else {

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DataRecord.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DataRecord.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DataRecord.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -26,6 +26,7 @@
 
 import org.jetel.metadata.DataFieldMetadata;
 import org.jetel.metadata.DataRecordMetadata;
+import org.jetel.util.BitArray;
 
 /**
  *  A class that represents one data record with structure based on provided
@@ -42,11 +43,19 @@
  */
 public class DataRecord implements Serializable, Comparable {
 
+    private static final long serialVersionUID = 2497808992091497225L;
+
+
+    // switch- shall we handle differently NULLable records (record
+    // which has at least one field NULLable ?)
+    private static final boolean HANDLE_NULLABLE = false;
+    
+    
 	/**
      * Currently not used
 	 * @since
 	 */
-	private transient String codeClassName;
+	// private transient String codeClassName;
 
 	/**
      * Array for holding data fields
@@ -179,6 +188,7 @@
 	public boolean[] copyFieldsByName(DataRecord sourceRecord) {
         boolean[] result = new boolean[fields.length];
         Arrays.fill(result, false);
+        if (sourceRecord == null) return result;
         DataField sourceField;
         DataField targetField;
         int sourceLength = sourceRecord.getMetadata().getNumFields();
@@ -243,10 +253,34 @@
 	 * @since          April 23, 2002
 	 */
 	public void deserialize(ByteBuffer buffer) {
-		for (int i = 0; i &lt; fields.length; i++) {
-			fields[i].deserialize(buffer);
-		}
-	}
+        if (HANDLE_NULLABLE &amp;&amp; metadata.isNullable()) {
+            final int base = buffer.position();
+            BitArray nullSwitches = metadata.getFieldsNullSwitches();
+            final int numNullBytes = BitArray.bitsLength2Bytes(metadata
+                    .getNumNullableFields());
+            byte indicator = 0;
+            // skip to first field
+            buffer.position(buffer.position() + numNullBytes);
+            // are there any NULLs ? if not, use the simple version
+            int nullCounter = 0;
+            for (int i = 0; i &lt; fields.length; i++) {
+                if (nullSwitches.isSet(i)) {
+                    if (BitArray.isSet(buffer, base, nullCounter)) {
+                        fields[i].setNull(true);
+                    } else {
+                        fields[i].deserialize(buffer);
+                    }
+                    nullCounter++;
+                } else {
+                    fields[i].deserialize(buffer);
+                }
+            }
+        } else {
+            for (int i = 0; i &lt; fields.length; i++) {
+                fields[i].deserialize(buffer);
+            }
+        }
+    }
 
 
 	/**
@@ -315,7 +349,7 @@
 	 * @return    The codeClassName value
 	 */
 	public String getCodeClassName() {
-		return codeClassName;
+		return &quot;&quot;; //codeClassName;
 	}
 
 
@@ -401,10 +435,34 @@
 	 * @since          April 23, 2002
 	 */
 	public void serialize(ByteBuffer buffer) {
-		for (int i = 0; i &lt; fields.length; i++) {
-			fields[i].serialize(buffer);
-		}
-	}
+        if (HANDLE_NULLABLE &amp;&amp; metadata.isNullable()) {
+            final int base = buffer.position();
+            BitArray nullSwitches = metadata.getFieldsNullSwitches();
+            final int numNullBytes = BitArray.bitsLength2Bytes(metadata
+                    .getNumNullableFields());
+            // clear NULL indicators
+            for (int i = 0; i &lt; numNullBytes; i++) {
+                buffer.put((byte) 0);
+            }
+            int nullCounter = 0;
+            for (int i = 0; i &lt; fields.length; i++) {
+                if (nullSwitches.isSet(i)) {
+                    if (fields[i].isNull) {
+                        BitArray.set(buffer, base, nullCounter);
+                    } else {
+                        fields[i].serialize(buffer);
+                    }
+                    nullCounter++;
+                } else {
+                    fields[i].serialize(buffer);
+                }
+            }
+        } else {
+            for (int i = 0; i &lt; fields.length; i++) {
+                fields[i].serialize(buffer);
+            }
+        }
+    }
 
 
 	/**
@@ -413,7 +471,7 @@
 	 * @param  codeClassName  The new codeClassName value
 	 */
 	public void setCodeClassName(String codeClassName) {
-		this.codeClassName = codeClassName;
+		// this.codeClassName = codeClassName;
 	}
 
 
@@ -526,8 +584,17 @@
 	 * @return    The size value
 	 */
 	public int getSizeSerialized() {
-		int size=0;
-		for (int i = 0; i &lt; fields.length; size+=fields[i++].getSizeSerialized());
+        int size=0;
+        if (HANDLE_NULLABLE &amp;&amp; metadata.isNullable()){
+            for (int i = 0; i &lt; fields.length;i++){
+                if (!fields[i].isNull()){
+                    size+=fields[i].getSizeSerialized(); 
+                }
+            }
+            size+=BitArray.bitsLength2Bytes(metadata.getNumNullableFields());
+        }else{
+            for (int i = 0; i &lt; fields.length; size+=fields[i++].getSizeSerialized());
+        }
 		return size;
 	}
 	
@@ -554,7 +621,6 @@
         }
         return true;
     }
-    
 }
 /*
  *  end class DataRecord

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DateDataField.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DateDataField.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/DateDataField.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -462,7 +462,11 @@
 		if (obj instanceof java.util.Date){
 			return value.compareTo((java.util.Date) obj);
 		}else if (obj instanceof DateDataField){
-			return value.compareTo(((DateDataField) obj).value);
+			if (!((DateDataField) obj).isNull()) {
+				return value.compareTo(((DateDataField) obj).value);
+			}else{
+				return 1;
+			}
 		}else if (obj instanceof java.sql.Date){
 		    long result=value.getTime()-((java.sql.Date)obj).getTime();
 		    if (result&gt;0) return 1; else if (result&lt;0) return -1; else return 0;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/IntegerDataField.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/IntegerDataField.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/IntegerDataField.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -465,7 +465,11 @@
 		if (isNull) return -1;
 	    
 		if (obj instanceof IntegerDataField){
-			return compareTo(((IntegerDataField) obj).value);
+			if (!((IntegerDataField) obj).isNull()) {
+				return compareTo(((IntegerDataField) obj).value);
+			}else{
+				return 1;
+			}
 		}else if (obj instanceof Integer){
 			return compareTo(((Integer)obj).intValue());
 		}else if (obj instanceof Long){

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/NumericDataField.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/NumericDataField.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/NumericDataField.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -553,7 +553,11 @@
 		if (isNull) return -1;
 	    
 		if (obj instanceof NumericDataField){
-			return compareTo(((NumericDataField) obj).value);
+			if (!((NumericDataField) obj).isNull()) {
+				return compareTo(((NumericDataField) obj).value);
+			}else {
+				return 1;
+			}
 		}else if (obj instanceof Double){
 			return compareTo(((Double)obj).doubleValue());
 		}else if (obj instanceof Integer){

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/CloverDataFormatter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/CloverDataFormatter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/CloverDataFormatter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -25,6 +25,7 @@
 import java.io.DataOutputStream;
 import java.io.File;
 import java.io.FileInputStream;
+import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.OutputStream;
@@ -75,6 +76,7 @@
 	private File idxTmpFile;
 	private ReadableByteChannel idxReader;
 	private boolean append;
+	private boolean isOpen = false;
 	
 	private final static short LEN_SIZE_SPECIFIER = 4;
 	private final static int SHORT_SIZE_BYTES = 2;
@@ -104,18 +106,7 @@
 			throws ComponentNotReadyException {
 		this.metadata = _metadata;
         buffer = ByteBuffer.allocateDirect(Defaults.DEFAULT_INTERNAL_IO_BUFFER_SIZE);
-        if (saveIndex) {//create temporary index file
-            String dataDir = fileURL.substring(0,fileURL.lastIndexOf(File.separatorChar)+1);
-            idxTmpFile = new File(dataDir + fileName  + &quot;.idx.tmp&quot;);
-            try{
-                idxWriter = Channels.newChannel(new DataOutputStream(
-                        new FileOutputStream(idxTmpFile)));
-            }catch(IOException ex){
-                throw new ComponentNotReadyException(ex);
-            }
-            idxBuffer = ByteBuffer.allocateDirect(Defaults.DEFAULT_INTERNAL_IO_BUFFER_SIZE);
-        }
-	}
+ 	}
 
     /* (non-Javadoc)
      * @see org.jetel.data.formatter.Formatter#setDataTarget(java.lang.Object)
@@ -128,6 +119,18 @@
             this.out = (FileOutputStream)outputDataTarget;
         }
         writer = Channels.newChannel(this.out);
+        if (saveIndex) {//create temporary index file
+            String dataDir = fileURL.substring(0,fileURL.lastIndexOf(File.separatorChar)+1);
+            idxTmpFile = new File(dataDir + fileName  + &quot;.idx.tmp&quot;);
+            try{
+                idxWriter = Channels.newChannel(new DataOutputStream(
+                        new FileOutputStream(idxTmpFile)));
+            }catch(FileNotFoundException ex){
+                throw new RuntimeException(ex);
+            }
+            idxBuffer = ByteBuffer.allocateDirect(Defaults.DEFAULT_INTERNAL_IO_BUFFER_SIZE);
+        }
+        isOpen = true;
     }
 
 	
@@ -136,6 +139,7 @@
 	 * @see org.jetel.data.formatter.Formatter#close()
 	 */
 	public void close() {
+		if (!isOpen) return;
 		try{
 			flush();
 			if (saveIndex) {
@@ -144,9 +148,8 @@
 					ByteBufferUtils.flush(idxBuffer,idxWriter);
 					idxWriter.close();
 					ByteBufferUtils.reload(idxBuffer,idxReader);
-				}else{
-					idxBuffer.flip();
 				}
+				idxBuffer.flip();
 				long startValue = 0;//first index
 				int position;
 				if (out instanceof ZipOutputStream) {
@@ -208,6 +211,7 @@
 			}else{
 				out.close();
 			}
+			isOpen = false;
 		}catch(IOException ex){
 			ex.printStackTrace();
 		}
@@ -226,6 +230,7 @@
 		while (buffer.remaining() &gt;= LONG_SIZE_BYTES){
 			if (idxBuffer.remaining() &lt; SHORT_SIZE_BYTES ){//end of idxBuffer, reload it
 				ByteBufferUtils.reload(idxBuffer,idxReader);
+				idxBuffer.flip();
 			}
 			if (idxBuffer.remaining() &lt; SHORT_SIZE_BYTES ){//there is no more sizes to working up
 				break;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/JExcelXLSDataFormatter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/JExcelXLSDataFormatter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/JExcelXLSDataFormatter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,3 +1,22 @@
+/*
+*    jETeL/Clover - Java based ETL application framework.
+*    Copyright (C) 2005-06  Javlin Consulting &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">info at javlinconsulting.cz</A>&gt;
+*    
+*    This library is free software; you can redistribute it and/or
+*    modify it under the terms of the GNU Lesser General Public
+*    License as published by the Free Software Foundation; either
+*    version 2.1 of the License, or (at your option) any later version.
+*    
+*    This library is distributed in the hope that it will be useful,
+*    but WITHOUT ANY WARRANTY; without even the implied warranty of
+*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    
+*    Lesser General Public License for more details.
+*    
+*    You should have received a copy of the GNU Lesser General Public
+*    License along with this library; if not, write to the Free Software
+*    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*
+*/
 
 package org.jetel.data.formatter;
 
@@ -24,55 +43,64 @@
 
 import org.jetel.data.DataRecord;
 import org.jetel.data.primitive.Decimal;
-import org.jetel.exception.ComponentNotReadyException;
 import org.jetel.metadata.DataFieldMetadata;
 import org.jetel.metadata.DataRecordMetadata;
 import org.jetel.util.MiscUtils;
 import org.jetel.util.StringUtils;
 
-public class JExcelXLSDataFormatter implements XLSFormatter {
+/**
+ * Writes records to xls sheet using JExcelAPI
+ *  
+ * @author avackova (<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">agata.vackova at javlinconsulting.cz</A>) ; 
+ * (c) JavlinConsulting s.r.o.
+ *  www.javlinconsulting.cz
+ *
+ * @since Jan 16, 2007
+ *
+ */
+public class JExcelXLSDataFormatter extends XLSFormatter {
 	
-	private DataRecordMetadata metadata;
 	private WritableWorkbook wb;
 	private String sheetName = null;
 	private WritableSheet sheet;
-	private boolean append;
-	private int sheetNumber = -1;
-	private int recCounter;
-	private int firstColumn;
-	private String firstColumnIndex = &quot;A&quot;;
-	private int namesRow;
-	private int firstRow;
-	private boolean savedNames;
 	private WritableCellFormat[] cellStyle;
-	private boolean closed = true;
+	private boolean open = false;
 
+	/**
+	 * Constructor
+	 * 
+	 * @param append indicates if append data to existing xls sheet or replace 
+	 * them by new data 
+	 */
 	public JExcelXLSDataFormatter(boolean append){
-		this.append = append;
+		super(append);
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.formatter.Formatter#close()
+	 */
 	public void close() {
-		if (!closed) {
+		if (open) {
 			try {
 				wb.write();
 				wb.close();
-				closed = true;
+				open = false;
 			} catch (Exception e) {
 				e.printStackTrace();
 			}
 		}		
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.formatter.Formatter#flush()
+	 */
 	public void flush() throws IOException {
 		wb.write();
 	}
 
-	public void init(DataRecordMetadata _metadata)
-			throws ComponentNotReadyException {
-		this.metadata = _metadata;
-
-	}
-	
+	/* (non-Javadoc)
+	 * @see org.jetel.data.formatter.XLSFormatter#prepareSheet()
+	 */
 	public void prepareSheet(){
 		//get or create sheet depending of its existence and append attribute
 		if (sheetName != null){
@@ -126,12 +154,13 @@
 			}
 			sheet.setColumnView(firstColumn + i, view);
 			format = metadata.getField(i).getFormatStr();
-			if (format!=null){
+			if (format!=null){//apply format coherent to metadata format
 				cellStyle[i] = metadata.getField(i).getType() == DataFieldMetadata.DATE_FIELD
 						|| metadata.getField(i).getType() == DataFieldMetadata.DATETIME_FIELD 
 						? new WritableCellFormat(new DateFormat(format))
 						: new WritableCellFormat(new NumberFormat(format));
 			}else if (metadata.getField(i).getType() == DataFieldMetadata.DATE_FIELD || metadata.getField(i).getType() == DataFieldMetadata.DATETIME_FIELD){
+				//for date it has to be set an format (else data are sensless)
 				if (metadata.getField(i).getLocaleStr() != null) {
 					format = ((SimpleDateFormat) java.text.DateFormat
 							.getDateInstance(java.text.DateFormat.DEFAULT,
@@ -143,9 +172,12 @@
 				cellStyle[i] = new WritableCellFormat(new DateFormat(format));
 			}
 		}
-		closed = false;
+		open = true;
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.formatter.Formatter#setDataTarget(java.lang.Object)
+	 */
 	public void setDataTarget(Object outputDataTarget) {
 		Workbook oldWb = null;
         try{
@@ -154,7 +186,7 @@
             }
             if (oldWb != null){
             	wb = Workbook.createWorkbook((File)outputDataTarget, oldWb);
-        		closed = false;
+        		open = true;
            }else{
             	wb = Workbook.createWorkbook((File)outputDataTarget);
             }
@@ -163,6 +195,9 @@
         }
 	}
 
+    /**
+     * Method for saving names of columns
+     */
     private void saveNames() throws IOException{
 		recCounter = namesRow &gt; -1 ? namesRow : 0;
 		WritableFont font = new WritableFont(WritableFont.ARIAL, WritableFont.DEFAULT_POINT_SIZE, WritableFont.BOLD);
@@ -182,6 +217,9 @@
 		savedNames = true;
     }
 	
+	/* (non-Javadoc)
+	 * @see org.jetel.data.formatter.Formatter#write(org.jetel.data.DataRecord)
+	 */
 	public int write(DataRecord record) throws IOException {
 		if (!savedNames){
 			saveNames();
@@ -189,7 +227,7 @@
 		}
 		char metaType;//metadata field type
 		Object value;//field value
-		Object valueXls = null;
+		Object valueXls = null;//value to set
 		short colNum;
 		for (short i=0;i&lt;metadata.getNumFields();i++){
 			metaType = metadata.getField(i).getType();
@@ -252,6 +290,7 @@
 			try {
 				sheet.addCell((WritableCell)valueXls);
 			}catch (RowsExceededException e) {
+				//write data to new sheet
 				savedNames = namesRow == -1;
 				setSheetNumber(-1);
 				prepareSheet();
@@ -264,49 +303,5 @@
         return 0;
 	}
 	
-	public void setSheetName(String sheetName) {
-		this.sheetName = sheetName;
-	}
 
-	public void setSheetNumber(int sheetNumber) {
-		this.sheetNumber = sheetNumber;
-	}
-	
-	public void setFirstRow(int firstRow){
-		this.firstRow = firstRow;
-	}
-
-	public void setFirstColumn(String firstColumn){
-		this.firstColumnIndex = firstColumn;
-	}
-
-	public int getFirstColumn() {
-		return firstColumn;
-	}
-
-	public void setNamesRow(int namesRow) {
-		this.namesRow = namesRow;
-	}
-
-	public boolean isAppend() {
-		return append;
-	}
-
-	public int getFirstRow() {
-		return firstRow;
-	}
-
-	public int getNamesRow() {
-		return namesRow;
-	}
-
-	public String getSheetName() {
-		return sheetName;
-	}
-
-	public int getSheetNumber() {
-		return sheetNumber;
-	}
-	
-
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSDataFormatter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSDataFormatter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSDataFormatter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -29,7 +29,6 @@
 
 import javax.naming.InvalidNameException;
 
-import org.apache.poi.hssf.model.Workbook;
 import org.apache.poi.hssf.usermodel.HSSFCell;
 import org.apache.poi.hssf.usermodel.HSSFCellStyle;
 import org.apache.poi.hssf.usermodel.HSSFDataFormat;
@@ -39,12 +38,10 @@
 import org.apache.poi.hssf.usermodel.HSSFWorkbook;
 import org.jetel.data.DataRecord;
 import org.jetel.data.primitive.Decimal;
-import org.jetel.exception.ComponentNotReadyException;
 import org.jetel.metadata.DataFieldMetadata;
-import org.jetel.metadata.DataRecordMetadata;
 
 /**
- * Writes records to xls sheet
+ * Writes records to xls sheet using POI library
  *  
 /**
 * @author avackova &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">agata.vackova at javlinconsulting.cz</A>&gt; ; 
@@ -52,37 +49,23 @@
 *	www.javlinconsulting.cz
 *	@created October 10, 2006
  */
-public class XLSDataFormatter implements XLSFormatter {
+public class XLSDataFormatter extends XLSFormatter {
 
-	private final static int CELL_NUMBER_IN_SHEET = 'Z'-'A'+1;//number of &quot;AA&quot; cell in excel sheet
-
 	private HSSFWorkbook wb;
 	private HSSFSheet sheet;
 	private HSSFRow row;
 	private HSSFCell cell;
 	private HSSFCellStyle[] cellStyle;
 	private HSSFDataFormat dataFormat;
-	private DataRecordMetadata metadata;
-	private FileOutputStream out;
-	private int firstRow = 0;
-	private int recCounter;
-	private int namesRow = -1;
-	private boolean append;
-	private String sheetName = null;
-	private int sheetNumber = -1;
-	private String firstColumnIndex = &quot;A&quot;;
-	private int firstColumn;
-	private boolean savedNames = false;
 	
-	public XLSDataFormatter(boolean append){
-		this.append = append;
-	}
-
-	/* (non-Javadoc)
-	 * @see org.jetel.data.formatter.Formatter#init(org.jetel.metadata.DataRecordMetadata)
+	/**
+	 * Constructor
+	 * 
+	 * @param append indicates if append data to existing xls sheet or replace 
+	 * them by new data 
 	 */
-	public void init(DataRecordMetadata _metadata) throws ComponentNotReadyException{
-		this.metadata = _metadata;
+	public XLSDataFormatter(boolean append) {
+		super(append);
 	}
 
     /* (non-Javadoc)
@@ -101,6 +84,9 @@
         }
     }
     
+    /* (non-Javadoc)
+     * @see org.jetel.data.formatter.XLSFormatter#prepareSheet()
+     */
     public void prepareSheet(){
 		//get or create sheet depending of its existence and append attribute
 		if (sheetName != null){
@@ -155,6 +141,9 @@
 		}
     }
     
+    /**
+     * Method for saving names of columns
+     */
     private void saveNames(){
 		recCounter = namesRow &gt; -1 ? namesRow : 0;
 		HSSFCellStyle metaStyle = wb.createCellStyle();
@@ -163,6 +152,7 @@
 		metaStyle.setFont(font);
 		row = sheet.createRow(recCounter);
 		String name;
+		//iterate over metadata
 		for (short i=0;i&lt;metadata.getNumFields();i++){
 			cell = row.createCell((short)(firstColumn + i));
 			name = metadata.getField(i).getName();
@@ -251,87 +241,4 @@
 
 	}
 
-	public void setSheetName(String sheetName) {
-		this.sheetName = sheetName;
-	}
-
-	public void setSheetNumber(int sheetNumber) {
-		this.sheetNumber = sheetNumber;
-	}
-	
-	public void setFirstRow(int firstRow){
-		this.firstRow = firstRow;
-	}
-
-	public void setFirstColumn(String firstColumn){
-		this.firstColumnIndex = firstColumn;
-	}
-
-	public int getFirstColumn() {
-		return firstColumn;
-	}
-
-	public void setNamesRow(int namesRow) {
-		this.namesRow = namesRow;
-	}
-
-	public boolean isAppend() {
-		return append;
-	}
-
-	public int getFirstRow() {
-		return firstRow;
-	}
-
-	public int getNamesRow() {
-		return namesRow;
-	}
-
-	public String getSheetName() {
-		return sheetName;
-	}
-
-	public int getSheetNumber() {
-		return sheetNumber;
-	}
-	/**
-	 * This method calculates xls colum number from its code:
-	 * 	A='A'-65=0,B='B'-65,....,Z='Z'-65=CELL_NUMBER_IN_SHEET-1,
-	 *  XYZ = ('X'-64)*CELL_NUMBER_IN_SHEET^2+('Y'-64)*CELL_NUMBER_IN_SHEET+('Z'-65)
-	 * @param cellCode
-	 * @return column's number from its code
-	 * @throws InvalidNameException
-	 */
-	public static short getCellNum(String cellCode)throws InvalidNameException{
-		char[] cellCodeU = cellCode.toUpperCase().toCharArray();
-		int length = cellCodeU.length;
-		int cellNumber = 0;
-		for (int j=0;j&lt;length;j++){
-			if (cellCodeU[j]&lt;'A' || cellCodeU[j]&gt;'Z')
-				throw new InvalidNameException(&quot;Wrong column index: &quot; + cellCode);
-			cellNumber = cellNumber*CELL_NUMBER_IN_SHEET + (cellCodeU[j]-64);
-		}
-		cellNumber-=1;
-		if (cellNumber&lt;0) 
-			throw new InvalidNameException(&quot;Wrong column index: &quot; + cellCode);
-		return (short)cellNumber;
-	}
-	
-	/**
-	 * This method finds xls column code from its number (0 based)
-	 * 
-	 * @param cellNumber
-	 * @return column's code from its number
-	 */
-	public static String getCellCode(short cellNumber){
-		//invert column number to CELL_NUMBER_IN_SHEET based form
-		String cellNumberXlsBase = Integer.toString(cellNumber,CELL_NUMBER_IN_SHEET);
-		StringBuffer cellCode = new StringBuffer(cellNumberXlsBase.length());
-		//each digit except last diminished by 1 ('A'=0) invert back to decimal form
-		for (short i=0;i&lt;cellNumberXlsBase.length()-1;i++){
-			cellCode.append((char)(Integer.parseInt(cellNumberXlsBase.substring(i,i+1),CELL_NUMBER_IN_SHEET)-1+'A'));
-		}
-		cellCode.append((char)(Integer.parseInt(cellNumberXlsBase.substring(cellNumberXlsBase.length()-1,cellNumberXlsBase.length()),CELL_NUMBER_IN_SHEET)+'A'));
-		return cellCode.toString();
-	}
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSFormatter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSFormatter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/formatter/XLSFormatter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,29 +1,219 @@
+/*
+*    jETeL/Clover - Java based ETL application framework.
+*    Copyright (C) 2005-06  Javlin Consulting &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">info at javlinconsulting.cz</A>&gt;
+*    
+*    This library is free software; you can redistribute it and/or
+*    modify it under the terms of the GNU Lesser General Public
+*    License as published by the Free Software Foundation; either
+*    version 2.1 of the License, or (at your option) any later version.
+*    
+*    This library is distributed in the hope that it will be useful,
+*    but WITHOUT ANY WARRANTY; without even the implied warranty of
+*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    
+*    Lesser General Public License for more details.
+*    
+*    You should have received a copy of the GNU Lesser General Public
+*    License along with this library; if not, write to the Free Software
+*    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*
+*/
 
 package org.jetel.data.formatter;
 
-public interface XLSFormatter extends Formatter {
+import java.io.FileOutputStream;
+
+import javax.naming.InvalidNameException;
+
+import org.jetel.exception.ComponentNotReadyException;
+import org.jetel.metadata.DataRecordMetadata;
+
+/**
+ * Formats records for xls file. Order of method calling:
+ * &lt;ul&gt;
+ * &lt;li&gt;init(DataRecordMetadata)&lt;/li&gt;
+ * &lt;li&gt;setDataTarget(File) &lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setSheetName(String)&lt;/i&gt; or &lt;i&gt;setSheetNumber(int)&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setFirstRow(int)&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setFirstColumn(int)&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setNamesRow(int)&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;prepareSheet()&lt;/li&gt;
+ * &lt;li&gt;write(DataRecord)&lt;/li&gt;
+ * &lt;li&gt;close()&lt;/li&gt;&lt;/ul&gt;
+ * 
+ * @author avackova (<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">agata.vackova at javlinconsulting.cz</A>) ; 
+ * (c) JavlinConsulting s.r.o.
+ *  www.javlinconsulting.cz
+ *
+ * @since Jan 15, 2007
+ *
+ */
+public abstract class XLSFormatter implements Formatter {
 	
-	public void prepareSheet();
+	protected final static int CELL_NUMBER_IN_SHEET = 'Z'-'A'+1;//number of &quot;AA&quot; cell in excel sheet
 
-	public void setSheetName(String sheetName);
+	protected DataRecordMetadata metadata;
+	protected FileOutputStream out;
+	protected int firstRow = 0;
+	protected int recCounter;
+	protected int namesRow = -1;
+	protected boolean append;
+	protected String sheetName = null;
+	protected int sheetNumber = -1;
+	protected String firstColumnIndex = &quot;A&quot;;
+	protected int firstColumn;
+	protected boolean savedNames = false;
 
-	public void setSheetNumber(int sheetNumber);
+	/**
+	 * Constructor
+	 * 
+	 * @param append indicates if append data to existing xls sheet or replace 
+	 * them by new data 
+	 */
+	public XLSFormatter(boolean append){
+		this.append = append;
+	}
+
+	/* (non-Javadoc)
+	 * @see org.jetel.data.formatter.Formatter#init(org.jetel.metadata.DataRecordMetadata)
+	 */
+	public void init(DataRecordMetadata _metadata) throws ComponentNotReadyException{
+		this.metadata = _metadata;
+	}
+
+	/**
+	 * Prepares sheet in xls file, which was set by method setSheetName(String sheetName)
+	 *  or setSheetNumber(int sheetNumber) for saving data. If any of above methods wasn't
+	 *  called there is created new sheet with default name.
+	 */
+	public abstract void prepareSheet();
+
+	/**
+	 * Set name of sheet, data will be written to. It has higher prioryty then
+	 * setSheetNumber method
+	 * 
+	 * @param sheetName
+	 */
+	public void setSheetName(String sheetName) {
+		this.sheetName = sheetName;
+	}
+
+	/**
+	 * Set number of sheet, data will be written to. If there was called method
+	 * setSheetName before calling prepareSheet, this number will be ignored.
+	 * 
+	 * @param sheetNumber
+	 */
+	public void setSheetNumber(int sheetNumber) {
+		this.sheetNumber = sheetNumber;
+	}
 	
-	public void setFirstRow(int firstRow);
+	/**
+	 * Sets the number of row (0-based), for first data record.
+	 * 
+	 * @param firstRow
+	 */
+	public void setFirstRow(int firstRow){
+		this.firstRow = firstRow;
+	}
 
-	public void setFirstColumn(String firstColumn);
+	/**
+	 * Sets the code of first column 
+	 * 
+	 * @param firstColumn: &quot;A&quot;,&quot;B&quot;,..,&quot;AA&quot;,...
+	 */
+	public void setFirstColumn(String firstColumn){
+		this.firstColumnIndex = firstColumn;
+	}
 
-	public int getFirstColumn();
+	/**
+	 * @return code of first column (&quot;A&quot;,&quot;B&quot;,..,&quot;AA&quot;,...)
+	 */
+	public int getFirstColumn() {
+		return firstColumn;
+	}
 
-	public void setNamesRow(int namesRow);
+	/**
+	 * Sets the number of row, that metadata names will be save
+	 * 
+	 * @param namesRow
+	 */
+	public void setNamesRow(int namesRow) {
+		this.namesRow = namesRow;
+	}
 
-	public boolean isAppend();
+	/**
+	 * @return if data will be appent to currently set sheet or will be replaced by new data
+	 */
+	public boolean isAppend() {
+		return append;
+	}
 
-	public int getFirstRow() ;
+	/**
+	 * @return number of first data row
+	 */
+	public int getFirstRow() {
+		return firstRow;
+	}
 
-	public int getNamesRow();
+	/**
+	 * @return number of row with names of columns
+	 */
+	public int getNamesRow() {
+		return namesRow;
+	}
 
-	public String getSheetName();
+	/**
+	 * @return sheet name, which was set by setSheetName method
+	 */
+	public String getSheetName() {
+		return sheetName;
+	}
 
-	public int getSheetNumber();
+	/**
+	 * @return sheet number, which was set by setSheetNumber method
+	 */
+	public int getSheetNumber() {
+		return sheetNumber;
+	}
+
+	/**
+	 * This method calculates xls colum number from its code:
+	 * 	A='A'-65=0,B='B'-65,....,Z='Z'-65=CELL_NUMBER_IN_SHEET-1,
+	 *  XYZ = ('X'-64)*CELL_NUMBER_IN_SHEET^2+('Y'-64)*CELL_NUMBER_IN_SHEET+('Z'-65)
+	 * @param cellCode
+	 * @return column's number from its code
+	 * @throws InvalidNameException
+	 */
+	public static short getCellNum(String cellCode)throws InvalidNameException{
+		char[] cellCodeU = cellCode.toUpperCase().toCharArray();
+		int length = cellCodeU.length;
+		int cellNumber = 0;
+		for (int j=0;j&lt;length;j++){
+			if (cellCodeU[j]&lt;'A' || cellCodeU[j]&gt;'Z')
+				throw new InvalidNameException(&quot;Wrong column index: &quot; + cellCode);
+			cellNumber = cellNumber*CELL_NUMBER_IN_SHEET + (cellCodeU[j]-64);
+		}
+		cellNumber-=1;
+		if (cellNumber&lt;0) 
+			throw new InvalidNameException(&quot;Wrong column index: &quot; + cellCode);
+		return (short)cellNumber;
+	}
+	
+	/**
+	 * This method finds xls column code from its number (0 based)
+	 * 
+	 * @param cellNumber
+	 * @return column's code from its number
+	 */
+	public static String getCellCode(int cellNumber){
+		//invert column number to CELL_NUMBER_IN_SHEET based form
+		String cellNumberXlsBase = Integer.toString(cellNumber,CELL_NUMBER_IN_SHEET);
+		StringBuffer cellCode = new StringBuffer(cellNumberXlsBase.length());
+		//each digit except last diminished by 1 ('A'=0) invert back to decimal form
+		for (short i=0;i&lt;cellNumberXlsBase.length()-1;i++){
+			cellCode.append((char)(Integer.parseInt(cellNumberXlsBase.substring(i,i+1),CELL_NUMBER_IN_SHEET)-1+'A'));
+		}
+		cellCode.append((char)(Integer.parseInt(cellNumberXlsBase.substring(cellNumberXlsBase.length()-1,cellNumberXlsBase.length()),CELL_NUMBER_IN_SHEET)+'A'));
+		return cellCode.toString();
+	}
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/lookup/LookupTable.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/lookup/LookupTable.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/lookup/LookupTable.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -156,9 +156,4 @@
 	 */
 	public void free();
 	
-    /**
-     * NOTE: copy from GraphElement
-     */
-    public abstract ConfigurationStatus checkConfig(ConfigurationStatus status);
-
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/CloverDataParser.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/CloverDataParser.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/CloverDataParser.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -181,6 +181,7 @@
             int i=0;
             do {
                 ByteBufferUtils.reload(recordBuffer,recordFile);
+                recordBuffer.flip();
                 i++;
             }while (i*Defaults.DEFAULT_INTERNAL_IO_BUFFER_SIZE &lt; idx);
             recordBuffer.position((int)idx%Defaults.DEFAULT_INTERNAL_IO_BUFFER_SIZE);
@@ -208,6 +209,7 @@
 		if (recordBuffer.remaining() &lt; LEN_SIZE_SPECIFIER) {
 			try {
 				ByteBufferUtils.reload(recordBuffer,recordFile);
+				recordBuffer.flip();
 			} catch (IOException e) {
 				throw new JetelException(e.getLocalizedMessage());
 			}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/DelimitedDataParser.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/DelimitedDataParser.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/DelimitedDataParser.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -43,6 +43,7 @@
 import org.jetel.metadata.DataFieldMetadata;
 import org.jetel.metadata.DataRecordMetadata;
 import org.jetel.util.QuotingDecoder;
+import org.jetel.util.StringUtils;
 
 /**
  *  Parsing delimited text data. Supports delimiters with the length of up to 32
@@ -389,7 +390,10 @@
                             try{
                                 fieldStringBuffer.put((char) character);
                             }catch(BufferOverflowException ex){
-                                throw new IOException(&quot;Field too long or can not find delimiter [&quot;+String.valueOf(delimiters[fieldCounter])+&quot;]&quot;);
+                                throw new IOException(
+										&quot;Field too long or can not find delimiter [&quot;
+												+ StringUtils.specCharToString(String
+																.valueOf(delimiters[fieldCounter]))						+ &quot;]\n&quot;);
                             }
 						}
 						delimiterPosition = 0;
@@ -450,11 +454,13 @@
 			record.getField(fieldNum).fromString(strData);
 		} catch (BadDataFormatException bdfe) {
 			if(exceptionHandler != null ) {  //use handler only if configured
-                exceptionHandler.populateHandler(getErrorMessage(bdfe.getMessage(),data,recordCounter, fieldNum), record, -1, fieldNum, strData, bdfe);
+                exceptionHandler.populateHandler(getErrorMessage(bdfe
+						.getMessage(), data, recordCounter, fieldNum), record,
+						-1, fieldNum, &quot;\&quot;&quot; + StringUtils.specCharToString(strData) + &quot;\&quot;&quot;, bdfe);
 			} else {
                 bdfe.setRecordNumber(recordCounter);
                 bdfe.setFieldNumber(fieldNum);
-                bdfe.setOffendingValue(strData);
+                bdfe.setOffendingValue(&quot;\&quot;&quot; + StringUtils.specCharToString(strData) + &quot;\&quot;&quot;);
                 throw bdfe;
 			}
 		} catch (Exception ex) {

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/JExcelXLSDataParser.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/JExcelXLSDataParser.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/JExcelXLSDataParser.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,7 +1,28 @@
 
+/*
+*    jETeL/Clover - Java based ETL application framework.
+*    Copyright (C) 2005-06  Javlin Consulting &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">info at javlinconsulting.cz</A>&gt;
+*    
+*    This library is free software; you can redistribute it and/or
+*    modify it under the terms of the GNU Lesser General Public
+*    License as published by the Free Software Foundation; either
+*    version 2.1 of the License, or (at your option) any later version.
+*    
+*    This library is distributed in the hope that it will be useful,
+*    but WITHOUT ANY WARRANTY; without even the implied warranty of
+*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    
+*    Lesser General Public License for more details.
+*    
+*    You should have received a copy of the GNU Lesser General Public
+*    License along with this library; if not, write to the Free Software
+*    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*
+*/
+
 package org.jetel.data.parser;
 
 import java.io.InputStream;
+import java.util.ArrayList;
 import java.util.Iterator;
 import java.util.Map;
 
@@ -14,12 +35,24 @@
 
 import org.jetel.data.DataRecord;
 import org.jetel.data.Defaults;
+import org.jetel.data.formatter.XLSDataFormatter;
+import org.jetel.data.formatter.XLSFormatter;
 import org.jetel.exception.BadDataFormatException;
 import org.jetel.exception.ComponentNotReadyException;
 import org.jetel.exception.JetelException;
 import org.jetel.metadata.DataFieldMetadata;
 import org.jetel.util.StringUtils;
 
+/**
+ * Parsing data from xls file using JExcelAPI.
+ * 
+ * @author avackova (<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">agata.vackova at javlinconsulting.cz</A>) ; 
+ * (c) JavlinConsulting s.r.o.
+ *  www.javlinconsulting.cz
+ *
+ * @since Jan 16, 2007
+ *
+ */
 public class JExcelXLSDataParser extends XLSParser {
 	
 	private Workbook wb;
@@ -27,10 +60,16 @@
 	private Cell cell;
 	private String charset = null;
 	
+	/**
+	 * Default constructor
+	 */
 	public JExcelXLSDataParser() {
 		charset = Defaults.DataParser.DEFAULT_CHARSET_DECODER;
 	}
 	
+	/**
+	 * @param charset
+	 */
 	public JExcelXLSDataParser(String charset) {
 		this.charset = charset;
 	}
@@ -74,8 +113,25 @@
 
 	@Override
 	public String[] getNames() {
-		// TODO Auto-generated method stub
-		return null;
+		ArrayList&lt;String&gt; names = new ArrayList&lt;String&gt;();
+		if (metadataRow &gt; -1) {
+			Cell[] row = sheet.getRow(metadataRow);
+			//go through each not empty cell
+			for (int i=0;i&lt;row.length;i++){
+				cell = row[i];
+				names.add(XLSFormatter.getCellCode(cell.getColumn()) + &quot; - &quot; +
+						cell.getContents());
+			}
+		}else{
+			Cell[] row = sheet.getRow(firstRow);
+			for (int i=0;i&lt;row.length;i++){
+				cell = row[i];
+				names.add(XLSDataFormatter.getCellCode(cell.getColumn()) + &quot; - &quot; +
+						cell.getContents().substring(0, Math.min(
+								cell.getContents().length(), MAX_NAME_LENGTH)));
+			}
+		}
+		return names.toArray(new String[0]);
 	}
 
 	@Override
@@ -107,12 +163,16 @@
 	@Override
 	protected DataRecord parseNext(DataRecord record) throws JetelException {
 		if (currentRow&gt;=lastRow) return null;
-//		row = sheet.getRow(currentRow);
 		char type;
 		for (short i=0;i&lt;fieldNumber.length;i++){
 			if (fieldNumber[i][CLOVER_NUMBER] == -1) continue; //in metdata there is not any field corresponding to this column
-			cell = sheet.getCell(fieldNumber[i][XLS_NUMBER], currentRow);
-// 			cell = row.getCell((short)fieldNumber[i][XLS_NUMBER]);
+			try {
+				cell = sheet.getCell(fieldNumber[i][XLS_NUMBER], currentRow);
+			} catch (ArrayIndexOutOfBoundsException e1) {
+				//more fields in metadata then in xls file
+				record.getField(fieldNumber[i][CLOVER_NUMBER]).setNull(true);
+				continue;
+			}
 			type = metadata.getField(fieldNumber[i][CLOVER_NUMBER]).getType();
 			try{
 				switch (type) {
@@ -153,23 +213,6 @@
 					}
 				}
 			}
-//			catch (NullPointerException np){// empty cell
-//				try {
-//					record.getField(fieldNumber[i][CLOVER_NUMBER]).setNull(true);
-//				}catch (BadDataFormatException ex){
-//					BadDataFormatException bdfe = new BadDataFormatException(np.getMessage());
-//					bdfe.setRecordNumber(currentRow+1);
-//					bdfe.setFieldNumber(fieldNumber[i][CLOVER_NUMBER]);
-//					if(exceptionHandler != null ) {  //use handler only if configured
-//		                exceptionHandler.populateHandler(
-//		                		getErrorMessage(bdfe.getMessage(), currentRow+1, fieldNumber[i][CLOVER_NUMBER]), 
-//		                		record,	currentRow + 1, fieldNumber[i][CLOVER_NUMBER], &quot;null&quot;, bdfe);
-//					} else {
-//						throw new RuntimeException(getErrorMessage(bdfe.getMessage(), 
-//								currentRow + 1, fieldNumber[i][CLOVER_NUMBER]));
-//					}
-//				}
-//			}
 		}
 		currentRow++;
 		recordCounter++;

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSDataParser.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSDataParser.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSDataParser.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -41,7 +41,7 @@
 import org.jetel.util.StringUtils;
 
 /**
- * Parsing data from xls file.
+ * Parsing data from xls file using POI library.
  * 
 /**
 * @author avackova &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">agata.vackova at javlinconsulting.cz</A>&gt; ; 
@@ -106,17 +106,20 @@
 				switch (type) {
 				case DataFieldMetadata.DATE_FIELD:
 				case DataFieldMetadata.DATETIME_FIELD:
-					record.getField(fieldNumber[i][CLOVER_NUMBER]).setValue(cell.getDateCellValue());
+					record.getField(fieldNumber[i][CLOVER_NUMBER]).setValue(
+							cell.getDateCellValue());
 					break;
 				case DataFieldMetadata.BYTE_FIELD:
 				case DataFieldMetadata.STRING_FIELD:
-					record.getField(fieldNumber[i][CLOVER_NUMBER]).fromString(getStringFromCell(cell));
+					record.getField(fieldNumber[i][CLOVER_NUMBER]).fromString(
+							getStringFromCell(cell));
 					break;
 				case DataFieldMetadata.DECIMAL_FIELD:
 				case DataFieldMetadata.INTEGER_FIELD:
 				case DataFieldMetadata.LONG_FIELD:
 				case DataFieldMetadata.NUMERIC_FIELD:
-					record.getField(fieldNumber[i][CLOVER_NUMBER]).setValue(cell.getNumericCellValue());
+					record.getField(fieldNumber[i][CLOVER_NUMBER]).setValue(
+							cell.getNumericCellValue());
 					break;
 				}
 			} catch (NumberFormatException bdne) {//exception when trying get date or number from not numeric cell
@@ -267,6 +270,9 @@
 		// TODO Auto-generated method stub
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.XLSParser#getNames()
+	 */
 	public String[] getNames(){
 		ArrayList&lt;String&gt; names = new ArrayList&lt;String&gt;();
 		if (metadataRow &gt; -1) {

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSParser.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSParser.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/parser/XLSParser.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,4 +1,24 @@
 
+/*
+*    jETeL/Clover - Java based ETL application framework.
+*    Copyright (C) 2005-06  Javlin Consulting &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">info at javlinconsulting.cz</A>&gt;
+*    
+*    This library is free software; you can redistribute it and/or
+*    modify it under the terms of the GNU Lesser General Public
+*    License as published by the Free Software Foundation; either
+*    version 2.1 of the License, or (at your option) any later version.
+*    
+*    This library is distributed in the hope that it will be useful,
+*    but WITHOUT ANY WARRANTY; without even the implied warranty of
+*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    
+*    Lesser General Public License for more details.
+*    
+*    You should have received a copy of the GNU Lesser General Public
+*    License along with this library; if not, write to the Free Software
+*    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*
+*/
+
 package org.jetel.data.parser;
 
 import java.util.Map;
@@ -15,6 +35,28 @@
 import org.jetel.exception.PolicyType;
 import org.jetel.metadata.DataRecordMetadata;
 
+/**
+ * Parses data from xls file. Order of method calling:
+ * &lt;ul&gt;
+ * &lt;li&gt;init(DataRecordMetadata)&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setSheetName(String)&lt;/i&gt; or &lt;i&gt;setSheetNumber(int)&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setFirstRow(int)&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setMappingType(int)&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setCloverFields(int)&lt;/i&gt; - optional (depending on mapping type)&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setXlsFields(int)&lt;/i&gt; - optional (depending on mapping type)&lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;setMetadataRow(int)&lt;/i&gt; - optional (depending on mapping type)&lt;/li&gt;
+ * &lt;li&gt;setDataSource(InputStream) &lt;/li&gt;
+ * &lt;li&gt;&lt;i&gt;getNames()&lt;/i&gt; - optional&lt;/li&gt;
+ * &lt;li&gt;getNext(DataRecord)&lt;/li&gt;
+ * &lt;li&gt;close()&lt;/li&gt;&lt;/ul&gt;
+ * 
+ * @author avackova (<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">agata.vackova at javlinconsulting.cz</A>) ; 
+ * (c) JavlinConsulting s.r.o.
+ *  www.javlinconsulting.cz
+ *
+ * @since Jan 16, 2007
+ *
+ */
 public abstract class XLSParser implements Parser {
 
 	public final static int NO_METADATA_INFO = 0;
@@ -45,12 +87,21 @@
 	protected final static int MAX_NAME_LENGTH = 10;
 
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#close()
+	 */
 	public abstract void close() ;
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#setExceptionHandler(org.jetel.exception.IParserExceptionHandler)
+	 */
 	public void setExceptionHandler(IParserExceptionHandler handler) {
         this.exceptionHandler = handler;
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#getExceptionHandler()
+	 */
 	public IParserExceptionHandler getExceptionHandler() {
         return exceptionHandler;
 	}
@@ -74,8 +125,18 @@
 		return record;
 	}
 
+	/**
+	 * An operation that produces next record from Input data or null
+	 * 
+	 * @param record to fill
+	 * @return The Next value
+	 * @throws JetelException
+	 */
 	protected abstract DataRecord parseNext(DataRecord record) throws JetelException;
 	
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#getNext(org.jetel.data.DataRecord)
+	 */
 	public DataRecord getNext(DataRecord record) throws JetelException {
 		record = parseNext(record);
 		if(exceptionHandler != null ) {  //use handler only if configured
@@ -87,6 +148,9 @@
 		return record;
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#getPolicyType()
+	 */
 	public PolicyType getPolicyType() {
         if(exceptionHandler != null) {
             return exceptionHandler.getType();
@@ -94,13 +158,22 @@
         return null;
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#init(org.jetel.metadata.DataRecordMetadata)
+	 */
 	public void init(DataRecordMetadata _metadata)throws ComponentNotReadyException{
 		this.metadata = _metadata;
 	}
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#setDataSource(java.lang.Object)
+	 */
 	public abstract void setDataSource(Object inputDataSource) throws ComponentNotReadyException;
 
 
+	/* (non-Javadoc)
+	 * @see org.jetel.data.parser.Parser#skip(int)
+	 */
 	public int skip(int nRec) throws JetelException {
 		currentRow+=nRec;
 		return nRec;
@@ -221,30 +294,64 @@
 	protected abstract void cloverfieldsAndXlsNames(Map fieldNames)
 		throws ComponentNotReadyException;
 
+	/**
+	 * Sets xls sheet for reading data
+	 * 
+	 * @param sheetName
+	 */
 	public void setSheetName(String sheetName) {
 		this.sheetName = sheetName;
 	}
 
+	/**
+	 * Sets row, which data will be read from
+	 * 
+	 * @param firstRecord
+	 */
 	public void setFirstRow(int firstRecord) {
 		this.firstRow = firstRecord;
 	}
 
+	/**
+	 * Row, wchich was set by setFirstRow method
+	 * 
+	 * @return
+	 */
 	public int getFirstRow() {
 		return firstRow;
 	}
 
+	/**
+	 * Gets number, which was set by setSheetNumber method
+	 * 
+	 * @return
+	 */
 	public int getSheetNumber() {
 		return sheetNumber;
 	}
 
+	/**
+	 * @return numbers of read records
+	 */
 	public int getRecordCount() {
 		return recordCounter;
 	}
 
+	/**
+	 * Sets clover fields for mapping metadata with xls columns
+	 * 
+	 * @param cloverFields
+	 */
 	public void setCloverFields(String[] cloverFields) {
 		this.cloverFields = cloverFields;
 	}
 
+	/**
+	 * Sets row, names of columns will be read from
+	 * 
+	 * @param metadataRow
+	 * @throws ComponentNotReadyException
+	 */
 	public void setMetadataRow(int metadataRow) throws ComponentNotReadyException{
 		if (metadataRow &lt; 0) 
 			throw new ComponentNotReadyException(&quot;Number of metadata row has to be greter then 0&quot;);
@@ -254,14 +361,35 @@
 		}
 	}
 
+	/**
+	 * Sets columns' names for mapping metadata with xls columns
+	 * 
+	 * @param xlsFields
+	 */
 	public void setXlsFields(String[] xlsFields) {
 		this.xlsFields = xlsFields;
 	}
 
+	/**
+	 * Sets number of xls sheet, data will be read from
+	 * 
+	 * @param sheetNumber
+	 */
 	public void setSheetNumber(int sheetNumber) {
 		this.sheetNumber = sheetNumber;
 	}
 
+	/**
+	 * Sets mapping type between xls columns and metadata 
+	 * 
+	 * @param mappingType: &lt;ul&gt;
+	 * &lt;li&gt;NO_METADATA_INFO - cell order coresponds with field order in metadata&lt;/li&gt;
+	 * &lt;li&gt;ONLY_CLOVER_FIELDS  - cells are read in order of clover fields&lt;/li&gt;
+	 * &lt;li&gt;CLOVER_FIELDS_AND_XLS_NUMBERS - mapping between coresponding fields and cells&lt;/li&gt;
+	 * &lt;li&gt;CLOVER_FIELDS_AND_XLS_NAMES - mapping between coresponding fields and cells&lt;/li&gt;
+	 * &lt;li&gt;MAP_NAMES - finds fields in metadata with the same names as names in xls sheet&lt;/li&gt;
+	 * &lt;/ul&gt;
+	 */
 	public void setMappingType(int mappingType) {
 		this.mappingType = mappingType;
 		switch (mappingType) {
@@ -273,14 +401,24 @@
 		}
 	}
 
+	/**
+	 * @return number, which was set by setMetadataRow method
+	 */
 	public int getMetadataRow() {
 		return metadataRow;
 	}
 
+	/**
+	 * @return String, which was set by setSheetName method
+	 */
 	public String getSheetName() {
 		return sheetName;
 	}
 
+	/**
+	 * @return array with names from row set by setMetadataRow method 
+	 * (or setFirstRow if metadata row was not been set)  
+	 */
 	public abstract String[] getNames();
 
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/sequence/Sequence.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/sequence/Sequence.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/data/sequence/Sequence.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -85,11 +85,6 @@
     public boolean isPersistent();
     
     /**
-     * NOTE: copy from GraphElement
-     */
-    public abstract ConfigurationStatus checkConfig(ConfigurationStatus status);
-
-    /**
      * Initializes sequence object. It is called after the sequence class is instantiated.
      * All necessary internal initialization should be performed in this method.
      * NOTE: copy from GraphElement

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/database/IConnection.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/database/IConnection.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/database/IConnection.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -30,23 +30,6 @@
 //    public void connect();
 
     /**
-     * NOTE: copy from GraphElement
-     */
-    public abstract ConfigurationStatus checkConfig(ConfigurationStatus status);
-
-    /**
-     * NOTE: copy from GraphElement
-     */
-    public abstract void init() throws ComponentNotReadyException;
-
-    /**
-     * Closes the sequence (current instance). All internal resources should be freed in
-     * this method.
-     * NOTE: copy from GraphElement
-     */
-    public abstract void free();
-
-    /**
      * Creates clover metadata from this connection. Used by DataRecordMetadataStub
      * for definition metadata from connection.
      * For example - in JDBC connection is expected parameter sqlQuery for definition metadata.

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/DirectEdge.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/DirectEdge.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/DirectEdge.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -146,7 +146,7 @@
 	        }
 	        record.deserialize(readBuffer);
 	    }catch(BufferUnderflowException ex){
-	        throw new IOException(ex.getMessage());
+	        throw new IOException(&quot;BufferUnderflow when reading/deserializing record&quot;);
 	    }
         bufferedRecords.decrementAndGet();
         
@@ -183,7 +183,7 @@
 	        readBuffer.limit(readBufferLimit);
 	        record.flip();
 	    }catch(BufferUnderflowException ex){
-	        throw new IOException(ex.getMessage());
+            throw new IOException(&quot;BufferUnderflow when reading/deserializing record&quot;);
 	    }
         bufferedRecords.decrementAndGet();
 	    
@@ -224,7 +224,8 @@
             record.serialize(tmpDataRecord);
         } catch (BufferOverflowException ex) {
             throw new IOException(
-                    &quot;Internal buffer is not big enough to accomodate data record ! (See MAX_RECORD_SIZE parameter)&quot;);
+                    &quot;Internal buffer is not big enough to accomodate data record ! (See MAX_RECORD_SIZE parameter)&quot;+
+                    &quot;\n [actual record size: &quot;+record.getSizeSerialized()+&quot; bytes]&quot;);
         }
         tmpDataRecord.flip();
         int length = tmpDataRecord.remaining();
@@ -269,7 +270,8 @@
             writeBuffer.put(record);
         } catch (BufferOverflowException ex) {
             throw new IOException(
-                    &quot;WriteBuffer is not big enough to accomodate data record !&quot;);
+                    &quot;WriteBuffer is not big enough to accomodate data record ! (See MAX_RECORD_SIZE parameter)&quot;+
+                    &quot;\n [actual record size: &quot;+record.rewind().remaining()+&quot; bytes]&quot;);
         }
 
         byteCounter += dataLength;
@@ -331,7 +333,7 @@
             flushWriteBuffer();
             
 	    }catch(InterruptedException ex){
-	        throw new RuntimeException(ex.getClass().getName()+&quot;:&quot;+ex.getMessage());
+	        throw new RuntimeException(&quot;Interrupted &quot;+ex.getClass().getName()+&quot;:&quot;+ex.getMessage());
 	    }
 	}
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Node.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Node.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Node.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -74,6 +74,7 @@
 
 	protected Result runResult;
     protected Throwable resultException;
+    protected String resultMessage;
 	
     protected Phase phase;
 
@@ -360,7 +361,12 @@
 	public void run() {
         runResult=Result.RUNNING; // set running result, so we know run() method was started
         try {
-            runResult = execute();
+            if((runResult = execute()) == Result.ERROR) {
+                Message msg = Message.createErrorMessage(this,
+                        new ErrorMsgBody(runResult.code(), 
+                                resultMessage != null ? resultMessage : runResult.message(), null));
+                getCloverRuntime().sendMessage(msg);
+            }
         } catch (IOException ex) {  // may be handled differently later
             runResult=Result.ERROR;
             resultException = ex;
@@ -788,13 +794,6 @@
         port.close();
     }
 
-	/* (non-Javadoc)
-	 * @see org.jetel.graph.GraphElement#free()
-	 */
-	public void free() {
-        super.free();
-	}
-    
 	/**
 	 *  Compares this Node to specified Object
 	 *

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Phase.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Phase.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/Phase.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -29,6 +29,7 @@
 import org.jetel.exception.ConfigurationStatus;
 import org.jetel.exception.GraphConfigurationException;
 import org.jetel.graph.runtime.NodeTrackingDetail;
+import org.jetel.graph.runtime.TrackingDetail;
 
 /**
  * A class that represents processing Phase of Transformation Graph
@@ -58,7 +59,7 @@
 	private int phaseMemUtilization;
 	private Result result;
     private boolean isCheckPoint;
-    private Map&lt;String,NodeTrackingDetail&gt; tracking;
+    private Map&lt;String,TrackingDetail&gt; tracking;
 
 	protected TransformationGraph graph;
 
@@ -412,7 +413,7 @@
      * @return the tracking
      * @since 10.1.2007
      */
-    public Map&lt;String, NodeTrackingDetail&gt; getTracking() {
+    public Map&lt;String, TrackingDetail&gt; getTracking() {
         return tracking;
     }
 
@@ -421,7 +422,7 @@
      * @param tracking the tracking to set
      * @since 10.1.2007
      */
-    public void setTracking(Map&lt;String, NodeTrackingDetail&gt; tracking) {
+    public void setTracking(Map&lt;String, TrackingDetail&gt; tracking) {
         this.tracking = tracking;
     }
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraph.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraph.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraph.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -24,6 +24,7 @@
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.net.MalformedURLException;
 import java.net.URL;
 import java.util.ArrayList;
 import java.util.Arrays;
@@ -62,6 +63,8 @@
 
 public final class TransformationGraph {
 
+    public static final String PROPERTY_PROJECT_DIR = &quot;PROJECT_DIR&quot;;
+    
 	private Map &lt;Integer,Phase&gt; phases;
 
 	private Map &lt;String,Node&gt; nodes;
@@ -96,7 +99,8 @@
 	
 	private int trackingInterval = Defaults.WatchDog.DEFAULT_WATCHDOG_TRACKING_INTERVAL;
 
-
+	private URL projectURL;
+    
     public TransformationGraph() {
         this(null);
     }
@@ -208,6 +212,29 @@
         }
     }
     
+    /**
+     * Returns URL from PROJECT_DIR graph property value.
+     * It is used as context URL for conversion from relative to absolute path.
+     * @return 
+     */
+    private boolean firstCallprojectURL = true;
+    public URL getProjectURL() {
+        if(firstCallprojectURL) {
+            firstCallprojectURL = false;
+            String projectURLStr = getGraphProperties().getStringProperty(PROPERTY_PROJECT_DIR);
+            
+            if(projectURLStr != null) {
+                try {
+                    projectURL = FileUtils.getFileURL(null, projectURLStr);
+                } catch (MalformedURLException e) {
+                    logger.warn(&quot;Home project dir is not in valid URL format - &quot; + projectURLStr);
+                }
+            }
+        }
+
+        return projectURL;
+    }
+    
 	/**
 	 *  Gets the IConnection object asssociated with the name provided
 	 *
@@ -309,31 +336,39 @@
 	 * @since     April 2, 2002
 	 */
 	public Result run() {
-		long timestamp = System.currentTimeMillis();
-		watchDog = new WatchDog(this, phasesArray, trackingInterval);
+        long timestamp = System.currentTimeMillis();
+        watchDog = new WatchDog(this, phasesArray, trackingInterval);
 
-		logger.info(&quot;Starting WatchDog thread ...&quot;);
-		watchDog.start();
-		try {
-			watchDog.join();
-		} catch (InterruptedException ex) {
-			logger.error(ex);
-			return Result.ABORTED;
-		}
-		logger.info(&quot;WatchDog thread finished - total execution time: &quot; 
-				+ (System.currentTimeMillis() - timestamp) / 1000
-				+ &quot; (sec)&quot;);
+        logger.info(&quot;Starting WatchDog thread ...&quot;);
+        watchDog.start();
+        try {
+            watchDog.join();
+        } catch (InterruptedException ex) {
+            logger.error(ex);
+            return Result.ABORTED;
+        }
+        logger.info(&quot;WatchDog thread finished - total execution time: &quot;
+                + (System.currentTimeMillis() - timestamp) / 1000 + &quot; (sec)&quot;);
 
-		freeResources();
+        freeResources();
 
-		if (watchDog.getStatus() == Result.FINISHED_OK) {
-			logger.info(&quot;Graph execution finished successfully&quot;);
-		} else {
-			logger.error(&quot;!!! Graph execution finished with errors !!!&quot;);
-		}
+        switch (watchDog.getStatus()) {
+        case FINISHED_OK:
+            logger.info(&quot;Graph execution finished successfully&quot;);
+            break;
+        case ABORTED:
+            logger.error(&quot;!!! Graph execution aborted !!!&quot;);
+            break;
+        case ERROR:
+            logger.error(&quot;!!! Graph execution finished with errors !!!&quot;);
+            break;
+        default:
+            logger.fatal(&quot;Unexpected result when executing graph !&quot;);
+        }
+        
         return watchDog.getStatus();
 
-	}
+    }
 
 
 
@@ -580,6 +615,7 @@
 	 */
 	public void addConnection(String name, IConnection connection) {
 		connections.put(name, connection);
+        connection.setGraph(this);
 	}
 
 	/**
@@ -591,6 +627,7 @@
 	 */
 	public void addSequence(String name, Sequence seq) {
 		sequences.put(name, seq);
+        seq.setGraph(this);
 	}
 
 	/**
@@ -601,6 +638,7 @@
 	 */
 	public void addLookupTable(String name, LookupTable lookupTable) {
 		lookupTables.put(name, lookupTable);
+        lookupTable.setGraph(this);
 	}
 
 	/**
@@ -715,10 +753,12 @@
 		if (graphProperties == null) {
 			graphProperties = new TypedProperties();
 		}
-        URL url = FileUtils.getFileURL(fileURL);
-        if(url == null) {
+        URL url;
+        try {
+            url = FileUtils.getFileURL(getProjectURL(), fileURL);
+        } catch(MalformedURLException e) {
             logger.error(&quot;Wrong URL/filename of file specified: &quot; + fileURL);
-            throw new IOException(&quot;Wrong URL/filename of file specified: &quot; + fileURL);
+            throw e;
         }
         InputStream inStream = new BufferedInputStream(url.openStream());
 		graphProperties.load(inStream);
@@ -734,10 +774,12 @@
         if (graphProperties == null) {
             graphProperties = new TypedProperties();
         }
-        URL url = FileUtils.getFileURL(fileURL);
-        if(url == null) {
+        URL url; 
+        try {
+            url = FileUtils.getFileURL(getProjectURL(), fileURL);
+        } catch(MalformedURLException e) {
             logger.error(&quot;Wrong URL/filename of file specified: &quot; + fileURL);
-            throw new IOException(&quot;Wrong URL/filename of file specified: &quot; + fileURL);
+            throw e;
         }
         InputStream inStream = new BufferedInputStream(url.openStream());
         graphProperties.loadSafe(inStream);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraphXMLReaderWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraphXMLReaderWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/TransformationGraphXMLReaderWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -632,7 +632,7 @@
 	            if (attributes.exists(&quot;fileURL&quot;)){
 	                String fileURL = attributes.getString(&quot;fileURL&quot;);
 	               try{
-                    graph.loadGraphPropertiesSafe(fileURL);
+	                   graph.loadGraphPropertiesSafe(fileURL);
                    }catch(IOException ex){
                        throw new XMLConfigurationException(&quot;Can't load property definition from &quot;+fileURL,ex); 
                    }

Copied: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMX.java (from rev 2346, trunk/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMX.java)
===================================================================
--- trunk/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMX.java	2007-01-22 10:22:16 UTC (rev 2346)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMX.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -0,0 +1,201 @@
+/*
+ *    jETeL/Clover - Java based ETL application framework.
+ *    Copyright (C) 2002-06  David Pavlis &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">david.pavlis at centrum.cz</A>&gt; and others.
+ *    
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License as published by the Free Software Foundation; either
+ *    version 2.1 of the License, or (at your option) any later version.
+ *    
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    
+ *    Lesser General Public License for more details.
+ *    
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Created on 9.1.2007
+ *
+ * TODO To change the template for this generated file go to
+ * Window - Preferences - Java - Code Style - Code Templates
+ */
+package org.jetel.graph.runtime;
+
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
+
+import javax.management.*; 
+
+public class CloverJMX extends NotificationBroadcasterSupport  implements CloverJMXMBean {
+
+    private long sequenceNumber = 1;
+    private String runningGraphName;
+    private String cloverVersion;
+    private int runingPhase;
+    private int runningNodes;
+    private long runTimeMS;
+    private WatchDog watchDog;
+    
+    
+    private Map&lt;String,TrackingDetail&gt; trackingMap;
+    
+    public CloverJMX(WatchDog watchDog){
+        StringBuilder str=new StringBuilder(30);
+      //  str.append(org.jetel.util.JetelVersion.getMajorVersion()).append('.');
+      //  str.append(org.jetel.util.JetelVersion.getMinorVersion()).append(&quot; build# &quot;);
+      //  str.append(org.jetel.util.JetelVersion.getBuildNumber()).append(&quot; compiled &quot;);
+      //  str.append(org.jetel.util.JetelVersion.getBuildDatetime());
+        
+        cloverVersion=str.toString();
+        this.watchDog=watchDog;
+    }
+    
+   
+    public String getCloverVersion() {
+       return cloverVersion;
+    }
+
+    public String getRunningGraphName() {
+        return runningGraphName;
+    }
+
+    public long getRunningGraphTime() {
+        return runTimeMS;
+    }
+
+    public int getRunningPhase() {
+        return runingPhase;
+    }
+
+    public int getRunningNodesCount() {
+        return runningNodes;
+    }
+
+    public TrackingDetail getTrackingDetail(String nodeID){
+        return trackingMap.get(nodeID);
+        
+    }
+    
+    public String getTrackingDetailString(String nodeID){
+        TrackingDetail detail=trackingMap.get(nodeID);
+        if (detail!=null){
+            StringBuilder str=new StringBuilder(60);
+            str.append(detail.getNodeId()).append(';');
+            str.append(detail.getNumInputPorts()).append(';');
+            str.append(detail.getNumOutputPorts()).append(';');
+            for(int i=0;i&lt;detail.getNumInputPorts();i++){
+                str.append(detail.getTotalRows(TrackingDetail.IN_PORT, i)).append(';');
+            }
+            for(int i=0;i&lt;detail.getNumOutputPorts();i++){
+                str.append(detail.getTotalRows(TrackingDetail.OUT_PORT, i)).append(';');
+            }
+            return str.toString();
+        }
+        return &quot;&quot;;
+    }
+
+    public String[] getNodesList(){
+         return trackingMap.keySet().toArray(new String[trackingMap.size()]);
+    }
+    
+    public int getUpdateInterval() {
+        // TODO Auto-generated method stub
+        return 0;
+    }
+
+    public void setUpdateInterval(int updateInterval) {
+        // TODO Auto-generated method stub
+
+    }
+
+    public void stopGraphExecution() {
+        watchDog.stopRun();
+
+    }
+    
+    public synchronized void updated() { 
+        Notification n = 
+            new AttributeChangeNotification(this, 
+                        sequenceNumber++, 
+                        System.currentTimeMillis(), 
+                        &quot;Tracking updated&quot;, 
+                        &quot;Tracking&quot;, 
+                        &quot;int&quot;, 
+                        -1/*oldSize*/, 
+                        1/*this.cacheSize*/); 
+ 
+    sendNotification(n); 
+    } 
+    
+    public synchronized void phaseUpdated() { 
+        Notification n = 
+            new AttributeChangeNotification(this, 
+                        sequenceNumber++, 
+                        System.currentTimeMillis(), 
+                        &quot;Phase updated&quot;, 
+                        &quot;Phase&quot;, 
+                        &quot;int&quot;, 
+                        -1/*oldSize*/, 
+                        runingPhase); 
+ 
+    sendNotification(n); 
+    } 
+ 
+    @Override 
+    public MBeanNotificationInfo[] getNotificationInfo() { 
+        String[] types = new String[] { 
+            AttributeChangeNotification.ATTRIBUTE_CHANGE 
+        }; 
+        String name = AttributeChangeNotification.class.getName(); 
+        String description = &quot;An attribute of this MBean has changed&quot;; 
+        MBeanNotificationInfo info = 
+            new MBeanNotificationInfo(types, name, description); 
+        return new MBeanNotificationInfo[] {info}; 
+    }
+
+    /**
+     * @param trackingMap the trackingMap to set
+     * @since 17.1.2007
+     */
+    public void setTrackingMap(Map&lt;String, TrackingDetail&gt; trackingMap) {
+        this.trackingMap = trackingMap;
+    }
+
+    /**
+     * @param runingPhase the runingPhase to set
+     * @since 17.1.2007
+     */
+    public void setRuningPhase(int runingPhase) {
+        this.runingPhase = runingPhase;
+        phaseUpdated();
+    }
+
+    /**
+     * @param runningGraphName the runningGraphName to set
+     * @since 17.1.2007
+     */
+    public void setRunningGraphName(String runningGraphName) {
+        this.runningGraphName = runningGraphName;
+    }
+
+    /**
+     * @param runTimeSec the runTimeSec to set
+     * @since 17.1.2007
+     */
+    public void setRunTime(long runTimeSec) {
+        this.runTimeMS = runTimeSec;
+    }
+
+
+    /**
+     * @param runningNodes the runningNodes to set
+     * @since 17.1.2007
+     */
+    public void setRunningNodes(int runningNodes) {
+        this.runningNodes = runningNodes;
+    } 
+
+}

Copied: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMXMBean.java (from rev 2346, trunk/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMXMBean.java)
===================================================================
--- trunk/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMXMBean.java	2007-01-22 10:22:16 UTC (rev 2346)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/CloverJMXMBean.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -0,0 +1,47 @@
+/*
+ *    jETeL/Clover - Java based ETL application framework.
+ *    Copyright (C) 2002-06  David Pavlis &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">david.pavlis at centrum.cz</A>&gt; and others.
+ *    
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License as published by the Free Software Foundation; either
+ *    version 2.1 of the License, or (at your option) any later version.
+ *    
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU    
+ *    Lesser General Public License for more details.
+ *    
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Created on 9.1.2007
+ *
+ * TODO To change the template for this generated file go to
+ * Window - Preferences - Java - Code Style - Code Templates
+ */
+package org.jetel.graph.runtime;
+
+import java.util.List;
+
+public interface CloverJMXMBean {
+  
+    public String getCloverVersion();
+    
+    public int getUpdateInterval();
+    public void setUpdateInterval(int updateInterval);
+    
+    public int getRunningPhase();
+    public String getRunningGraphName();
+    public long getRunningGraphTime();
+    
+    public int getRunningNodesCount();
+    public String[] getNodesList();
+    
+    public TrackingDetail getTrackingDetail(String nodeID);
+    public String getTrackingDetailString(String nodeID);
+    
+    public void stopGraphExecution();
+    
+}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/NodeTrackingDetail.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/NodeTrackingDetail.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/NodeTrackingDetail.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -48,6 +48,8 @@
     private long totalCPUTime;
     private long totalUserTime;
     private float usageCPU;
+    private float peakUsageCPU;
+    private float peakUsageUser;
     private float usageUser;
     private int avgWaitingTime;
     private int waitingRows[];
@@ -69,6 +71,7 @@
     public void clear(){
         timestamp=timespan=0;
         totalUserTime=totalCPUTime=0;
+        peakUsageCPU=peakUsageUser=0;
         /*Arrays.fill(totalRows,0);
         Arrays.fill(totalBytes,0);
         Arrays.fill(avgRows,0);
@@ -158,8 +161,10 @@
     public void updateRunTime(long cpuTime,long userTime,long systemTime){
         double time=cpuTime;
         usageCPU=(float)time/systemTime;
+        if (usageCPU&gt;peakUsageCPU) peakUsageCPU=usageCPU;
         time=userTime;
         usageUser=(float)time/systemTime;
+        if (usageUser&gt;peakUsageUser) peakUsageUser=usageUser;
         if (cpuTime&lt;0) return;
         totalCPUTime=cpuTime;
         totalUserTime=userTime;
@@ -226,5 +231,21 @@
     public float getUsageUser() {
         return usageUser;
     }
+
+    /**
+     * @return the peakUsageCPU
+     * @since 23.1.2007
+     */
+    public float getPeakUsageCPU() {
+        return peakUsageCPU;
+    }
+
+    /**
+     * @return the peakUsageUser
+     * @since 23.1.2007
+     */
+    public float getPeakUsageUser() {
+        return peakUsageUser;
+    }
     
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/TrackingDetail.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/TrackingDetail.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/TrackingDetail.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -47,6 +47,8 @@
     public int getNumOutputPorts();
     public Result getResult();
     public float getUsageCPU();
+    public float getPeakUsageCPU();
     public float getUsageUser();
+    public float getPeakUsageUser();
     
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/WatchDog.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/WatchDog.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/graph/runtime/WatchDog.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -36,6 +36,13 @@
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.locks.LockSupport;
 
+import javax.management.InstanceAlreadyExistsException;
+import javax.management.MBeanRegistrationException;
+import javax.management.MBeanServer;
+import javax.management.MalformedObjectNameException;
+import javax.management.NotCompliantMBeanException;
+import javax.management.ObjectName;
+
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.jetel.data.Defaults;
@@ -73,6 +80,8 @@
     private DuplicateKeyMap outMsgMap;
     private Throwable causeException;
     private String causeNodeID;
+    private CloverJMX mbean;
+    private volatile boolean runIt;
     
     private PrintTracking printTracking;
 
@@ -126,13 +135,17 @@
 	/**  Main processing method for the WatchDog object */
 	public void run() {
 		watchDogStatus = Result.RUNNING;
+        runIt=true;
 		logger.info(&quot;Thread started.&quot;);
 		logger.info(&quot;Running on &quot; + javaRuntime.availableProcessors() + &quot; CPU(s)&quot;
-			+ &quot; max available memory for JVM &quot; + javaRuntime.freeMemory() / 1024 + &quot; KB&quot;);
+			+ &quot; max available memory for JVM &quot; + javaRuntime.maxMemory() / 1024 + &quot; KB&quot;);
 		// renice - lower the priority
 		setPriority(Thread.MIN_PRIORITY);
 		
         printTracking=new PrintTracking();
+       
+        mbean=registerTrackingMBean();
+        mbean.setRunningGraphName(this.graph.getName());
 
         //disabled by Kokon
 //        Thread trackingThread=new Thread(printTracking, TRACKING_LOGGER_NAME);
@@ -140,11 +153,16 @@
 //        trackingThread.start();
         
 		for (currentPhaseNum = 0; currentPhaseNum &lt; phases.length; currentPhaseNum++) {
-			if (!executePhase(phases[currentPhaseNum])) {
-				watchDogStatus = Result.ERROR;
+			switch( executePhase(phases[currentPhaseNum]) ){
+            case ABORTED:
+                watchDogStatus = Result.ABORTED;
+                logger.error(&quot;!!! Phase execution aborted !!!&quot;);
+                return;
+            case ERROR:
+                watchDogStatus = Result.ERROR;
 				logger.error(&quot;!!! Phase finished with error - stopping graph run !!!&quot;);
 				return;
-			}
+            }
 			// force running of garbage collector
 			logger.info(&quot;Forcing garbage collection ...&quot;);
 			javaRuntime.runFinalization();
@@ -157,6 +175,38 @@
 		printPhasesSummary();
 	}
 
+
+    /**
+     * 
+     * @since 17.1.2007
+     */
+    private CloverJMX registerTrackingMBean() {
+       mbean = new CloverJMX(this);
+        // register MBean
+        MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();
+
+        // Construct the ObjectName for the MBean we will register
+        try {
+            ObjectName name = new ObjectName(
+                    &quot;org.jetel.graph.runtime:type=CloverJMX&quot;);
+            // Register the  MBean
+            mbs.registerMBean(mbean, name);
+
+        } catch (MalformedObjectNameException ex) {
+            ex.printStackTrace();
+        } catch (InstanceAlreadyExistsException e) {
+            // TODO Auto-generated catch block
+            e.printStackTrace();
+        } catch (MBeanRegistrationException e) {
+            // TODO Auto-generated catch block
+            e.printStackTrace();
+        } catch (NotCompliantMBeanException e) {
+            // TODO Auto-generated catch block
+            e.printStackTrace();
+        }
+        return mbean;
+    }
+
     public void runPhase(int phaseNo){
         watchDogStatus = Result.RUNNING;
         logger.info(&quot;Thread started.&quot;);
@@ -178,7 +228,12 @@
             }
         }
         if (currentPhaseNum&gt;=0){
-            if (!executePhase(phases[currentPhaseNum])) {
+            switch( executePhase(phases[currentPhaseNum]) ) {
+            case ABORTED:
+                watchDogStatus = Result.ABORTED;
+                logger.error(&quot;!!! Phase execution aborted !!!&quot;);
+                return;
+            case ERROR:
                 watchDogStatus = Result.ERROR;
                 logger.error(&quot;!!! Phase finished with error - stopping graph run !!!&quot;);
                 return;
@@ -216,7 +271,7 @@
 		long currentTimestamp;
 		long startTimestamp;
         long startTimeNano;
-        Map&lt;String,NodeTrackingDetail&gt; tracking=new LinkedHashMap&lt;String,NodeTrackingDetail&gt;(phase.getNodes().size());
+        Map&lt;String,TrackingDetail&gt; tracking=new LinkedHashMap&lt;String,TrackingDetail&gt;(phase.getNodes().size());
         List&lt;Node&gt; leafNodes;
         
         // let's create a copy of leaf nodes - we will watch them
@@ -232,9 +287,12 @@
         startTimeNano=System.nanoTime();
         
         printTracking.setTrackingInfo(tracking, phase.getPhaseNum());
+        mbean.setRuningPhase(phase.getPhaseNum());
+        mbean.setTrackingMap(tracking);
+        mbean.updated();
 	
         // entering the loop awaiting completion of work by all leaf nodes
-		while (true) {
+		while (runIt) {
             // wait on error message queue
             message=inMsgQueue.poll(Defaults.WatchDog.WATCHDOG_SLEEP_INTERVAL, TimeUnit.MILLISECONDS);
             if (message != null) {
@@ -244,9 +302,10 @@
                     logger
                             .fatal(&quot;!!! Fatal Error !!! - graph execution is aborting&quot;);
                     logger.error(&quot;Node &quot; + message.getSenderID()
-                            + &quot; finished with error: &quot; +
+                            + &quot; finished with status: &quot; +
                             ((ErrorMsgBody)message.getBody()).getErrorMessage()+
-                            &quot;caused by:&quot;+ causeException);
+                            &quot; caused by: &quot;+ causeException.getMessage());
+                    logger.debug(&quot;Node &quot;+ message.getSenderID()+&quot; error details:&quot;, causeException);
                     abort();
                     // printProcessingStatus(phase.getNodes().iterator(),
                     // phase.getPhaseNum());
@@ -285,6 +344,7 @@
 					leafNodesIterator.remove();
 				}
 			}
+            
             //  -----------------------------------
 			//  from time to time perform some task
             //  -----------------------------------
@@ -301,7 +361,7 @@
                 // gather tracking information
                 for (Node node : phase.getNodes()){
                     String nodeId=node.getId();
-                    NodeTrackingDetail trackingDetail=tracking.get(nodeId);
+                    NodeTrackingDetail trackingDetail=(NodeTrackingDetail)tracking.get(nodeId);
                     int inPortsNum=node.getInPorts().size();
                     int outPortsNum=node.getOutPorts().size();
                     if (trackingDetail==null){
@@ -342,8 +402,23 @@
                     //printProcessingStatus(phase.getNodes().iterator(), phase.getPhaseNum());
                     printTracking.execute(); // print tracking
                     lastTimestamp = currentTimestamp;
+                    
+                    // update mbean &amp; signal that it was updated
+                    mbean.setRunningNodes(leafNodes.size());
+                    mbean.setRunTime(currentTimestamp-startTimestamp);
+                    mbean.updated();
                 }
             }
+        if (!runIt){
+            // we were forced to stop execution, stop all Nodes
+            logger.error(&quot;User has interrupted graph execution !!!&quot;);
+            abort();
+            causeNodeID=null;
+            causeException=null;
+            return Result.ABORTED;
+        }else{
+            return Result.FINISHED_OK;
+        }
 			
 	}
 
@@ -351,8 +426,9 @@
 	/**
 	 *  Gets the Status of the WatchDog
 	 *
-	 * @return	0 READY, -1 ERROR, 1 RUNNING, 2 FINISHED OK    
+	 * @return	Result of WatchDog run-time    
 	 * @since     July 30, 2002
+     * @see     org.jetel.graph.Result
 	 */
 	public Result getStatus() {
 		return watchDogStatus;
@@ -379,6 +455,7 @@
 	 * @since    July 29, 2002
 	 */
 	public void abort() {
+        watchDogStatus=Result.ABORTED;
 		Iterator iterator = currentPhase.getNodes().iterator();
 		Node node;
 
@@ -417,13 +494,13 @@
 	 * @param  phase  Description of the Parameter
 	 * @return        Description of the Return Value
 	 */
-	private boolean executePhase(Phase phase) {
+	private Result executePhase(Phase phase) {
 		currentPhase = phase;
 		//phase.checkConfig();
 		// init phase
 		if (!phase.init()) {
 			// something went wrong !
-			return false;
+			return Result.ERROR;
 		}
 		logger.info(&quot;Starting up all nodes in phase [&quot; + phase.getPhaseNum() + &quot;]&quot;);
 		startUpNodes(phase);
@@ -450,7 +527,7 @@
         //end of phase, destroy it
 		phase.free();
         
-		return (watchDogStatus==Result.FINISHED_OK) ? true : false;
+		return watchDogStatus;
 	}
 
 	/*
@@ -480,7 +557,7 @@
 	}
     
 	class PrintTracking implements Runnable{
-	    Map&lt;String,NodeTrackingDetail&gt; tracking;
+	    Map&lt;String,TrackingDetail&gt; tracking;
         int phaseNo;
         Log trackingLogger;
         volatile boolean run;
@@ -491,7 +568,7 @@
             run=true;
         }
         
-        void setTrackingInfo(Map&lt;String,NodeTrackingDetail&gt; tracking, int phaseNo){
+        void setTrackingInfo(Map&lt;String,TrackingDetail&gt; tracking, int phaseNo){
             this.tracking=tracking;
             this.phaseNo=phaseNo;
         }
@@ -656,6 +733,16 @@
     public String getCauseNodeID() {
         return causeNodeID;
     }
+
+
+    /**
+     * Stop execution of graph
+     * 
+     * @since 29.1.2007
+     */
+    public void stopRun() {
+        this.runIt = false;
+    }
     
     
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangExecutor.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangExecutor.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangExecutor.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1503,6 +1503,43 @@
         }
         stack.storeVar(node.localVar, node.varSlot, value);
         
+        if (node.jjtGetNumChildren()&gt;0){
+            node.jjtGetChild(0).jjtAccept(this, data);
+            Object initValue=stack.pop();
+            
+            try {
+                if (value instanceof Numeric) {
+                        ((Numeric) value).setValue((Numeric) initValue);
+                } else if (value instanceof StringBuilder) {
+                    StringBuilder var = (StringBuilder) value;
+                    var.setLength(0);
+                    StringUtils.strBuffAppend(var,(CharSequence) initValue);
+                } else if (value instanceof Boolean) {
+                    stack.storeVar(node.localVar,node.varSlot, (Boolean)initValue); // boolean is not updatable - we replace the reference
+                    // stack.put(varName,((Boolean)value).booleanValue() ?
+                    // Stack.TRUE_VAL : Stack.FALSE_VAL);
+                } else if (value instanceof Date) {
+                    ((Date) value).setTime(((Date) initValue).getTime());
+                } else {
+                    throw new TransformLangExecutorRuntimeException(node,
+                            &quot;unknown variable \&quot;&quot; + node.name + &quot;\&quot;&quot;);
+                }
+            } catch (ClassCastException ex) {
+                throw new TransformLangExecutorRuntimeException(node,
+                        &quot;invalid assignment of \&quot;&quot; + initValue + &quot;\&quot; to variable \&quot;&quot;
+                                + node.name + &quot;\&quot; - incompatible data types&quot;);
+            } catch (NumberFormatException ex){
+                throw new TransformLangExecutorRuntimeException(node,
+                        &quot;invalid assignment of number \&quot;&quot; + initValue + &quot;\&quot; to variable \&quot;&quot; + node.name + &quot;\&quot; : &quot;+ex.getMessage());    
+            } catch (TransformLangExecutorRuntimeException ex){
+                throw ex;
+            } catch (Exception ex){
+                throw new TransformLangExecutorRuntimeException(node,
+                        &quot;invalid assignment of \&quot;&quot; + value + &quot;\&quot; to variable \&quot;&quot; + node.name + &quot;\&quot; : &quot;+ex.getMessage());  
+            }
+            
+        }
+        
         return data;
     }
 
@@ -1564,7 +1601,7 @@
     
     public Object visit(CLVFMapping node, Object data) {
         DataField field=outputRecords[node.recordNo].getField(node.fieldNo);
-        int arity=node.arity; // how many children we have defined
+        int arity=node.jjtGetNumChildren(); // how many children we have defined
         Object value=null;
         try{
             // we try till success or no more options
@@ -1578,19 +1615,11 @@
                     }else{
                         field.setValue(value);
                     }
-                }catch(BadDataFormatException ex){
-                    if (i == arity)
+                    break; // success during assignment, finish looping
+               }catch(Exception ex){
+                    if (i == arity-1)
                         throw ex;
-                    else
-                        continue;
-                    
-                }catch(Exception ex){
-                    if (i == arity)
-                        throw ex;
-                    else
-                        continue;
-                }
-                break; // success during assignment, finish looping
+               }
             }
             
         }catch(BadDataFormatException ex){
@@ -1610,7 +1639,6 @@
                     +&quot;) - assigning \&quot;&quot; + value + &quot;\&quot; (&quot;+(value!=null ? value.getClass(): &quot;unknown class&quot; )+&quot;)&quot;);
             
         }
-        
         return data;
     }
     

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangParser.jjt
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangParser.jjt	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/interpreter/TransformLangParser.jjt	2007-01-31 14:29:53 UTC (rev 2420)
@@ -405,6 +405,9 @@
     t = &lt;IDENTIFIER&gt;{
      if (!parserHelper.addVariable(t.image)){
        throw new ParseException(t, &quot;variable [&quot;+t.image+&quot;] already declared&quot;);
       }
      else {
        // is it local variable declaration ?
 
		if (parserHelper.inFunctionDeclaration){
          jjtThis.setVarSlot(parserHelper.getLocalVariableSlot(t.image));
          jjtThis.setLocalVariale(true);
        }
        else {
          jjtThis.setVarSlot(parserHelper.getGlobalVariableSlot(t.image));
          jjtThis.setLocalVariale(false);
        }
        jjtThis.setName(t.image);
      }
    }
+    
+    [&quot;=&quot; ConditionalOrExpression()]
+    
  }catch (ParseException e){
    parseExceptions.add(e);
//following code causes parser to cough     
 //do {
//      t = getNextToken();
//    }
//    while (t.kind != SEMICOLON);
  }
}
 
@@ -436,7 +439,7 @@
   	)
   	&lt;MAPPING&gt; 
   	
-  	ConditionalOrExpression() (&quot;:&quot; ConditionalOrExpression())* {jjtThis.setArity(jjtree.nodeArity());}
+  	ConditionalOrExpression() (&quot;:&quot; ConditionalOrExpression())*
 }
 
 /* Other nonterminals and their productions */

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/main/runGraph.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/main/runGraph.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/main/runGraph.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -155,136 +155,154 @@
 	 * @param  args  Description of the Parameter
 	 */
 	public static void main(String args[]) {
-		boolean verbose = false;
+        boolean verbose = false;
         boolean loadFromSTDIN = false;
-		Properties properties = new Properties();
-		int trackingInterval=-1;
-		String pluginsRootDirectory = null;
+        Properties properties = new Properties();
+        int trackingInterval = -1;
+        String pluginsRootDirectory = null;
         String password = null;
         String logHost = null;
-		
-		System.out.println(&quot;***  CloverETL framework/transformation graph runner ver &quot;+RUN_GRAPH_VERSION+&quot;, (c) 2002-06 D.Pavlis, released under GNU Lesser General Public License  ***&quot;);
-		System.out.println(&quot; Running with framework version: &quot;+JetelVersion.MAJOR_VERSION+&quot;.&quot;+JetelVersion.MINOR_VERSION+&quot; build#&quot;+JetelVersion.BUILD_NUMBER+&quot; compiled &quot;+JetelVersion.LIBRARY_BUILD_DATETIME);
-		System.out.println();
-        
-		if (args.length &lt; 1) {
-			printHelp();
-			System.exit(-1);
-		}
-        
-		// process command line arguments
-		for (int i = 0; i &lt; args.length; i++) {
-			if (args[i].startsWith(VERBOSE_SWITCH)) {
-				verbose = true;
-			}else if (args[i].startsWith(PROPERTY_FILE_SWITCH)){
-				i++;
-				try {
-					InputStream inStream = new BufferedInputStream(new FileInputStream(args[i]));
-					properties.load(inStream);
-				} catch (IOException ex) {
-					logger.error(ex.getMessage(), ex);
-					System.exit(-1);
-				}
-			}else if (args[i].startsWith(PROPERTY_DEFINITION_SWITCH)){
-			   	//String[] nameValue=args[i].replaceFirst(PROPERTY_DEFINITION_SWITCH,&quot;&quot;).split(&quot;=&quot;);
-				//properties.setProperty(nameValue[0],nameValue[1]);
-		    	String tmp =  args[i].replaceFirst(PROPERTY_DEFINITION_SWITCH,&quot;&quot;);
-        	    properties.setProperty(tmp.substring(0,tmp.indexOf(&quot;=&quot;)),tmp.substring(tmp.indexOf(&quot;=&quot;) +1)); 
-			}else if (args[i].startsWith(TRACKING_INTERVAL_SWITCH)) {
-				i++;
-                try{
+
+        System.out
+                .println(&quot;***  CloverETL framework/transformation graph runner ver &quot;
+                        + RUN_GRAPH_VERSION
+                        + &quot;, (c) 2002-06 D.Pavlis, released under GNU Lesser General Public License  ***&quot;);
+        System.out.println(&quot; Running with framework version: &quot;
+                + JetelVersion.MAJOR_VERSION + &quot;.&quot; + JetelVersion.MINOR_VERSION
+                + &quot; build#&quot; + JetelVersion.BUILD_NUMBER + &quot; compiled &quot;
+                + JetelVersion.LIBRARY_BUILD_DATETIME);
+        System.out.println();
+
+        if (args.length &lt; 1) {
+            printHelp();
+            System.exit(-1);
+        }
+
+        // process command line arguments
+        for (int i = 0; i &lt; args.length; i++) {
+            if (args[i].startsWith(VERBOSE_SWITCH)) {
+                verbose = true;
+            } else if (args[i].startsWith(PROPERTY_FILE_SWITCH)) {
+                i++;
+                try {
+                    InputStream inStream = new BufferedInputStream(
+                            new FileInputStream(args[i]));
+                    properties.load(inStream);
+                } catch (IOException ex) {
+                    logger.error(ex.getMessage(), ex);
+                    System.exit(-1);
+                }
+            } else if (args[i].startsWith(PROPERTY_DEFINITION_SWITCH)) {
+                // String[]
+                // nameValue=args[i].replaceFirst(PROPERTY_DEFINITION_SWITCH,&quot;&quot;).split(&quot;=&quot;);
+                // properties.setProperty(nameValue[0],nameValue[1]);
+                String tmp = args[i].replaceFirst(PROPERTY_DEFINITION_SWITCH,
+                        &quot;&quot;);
+                properties.setProperty(tmp.substring(0, tmp.indexOf(&quot;=&quot;)), tmp
+                        .substring(tmp.indexOf(&quot;=&quot;) + 1));
+            } else if (args[i].startsWith(TRACKING_INTERVAL_SWITCH)) {
+                i++;
+                try {
                     trackingInterval = Integer.parseInt(args[i]);
-                }catch(NumberFormatException ex){
-                    System.err.println(&quot;Invalid tracking parameter: \&quot;&quot;+args[i]+&quot;\&quot;&quot;);
+                } catch (NumberFormatException ex) {
+                    System.err.println(&quot;Invalid tracking parameter: \&quot;&quot;
+                            + args[i] + &quot;\&quot;&quot;);
                     System.exit(-1);
                 }
-			}else if (args[i].startsWith(INFO_SWITCH)){
-			    printInfo();
-			    System.exit(0);
-            }else if (args[i].startsWith(PLUGINS_SWITCH)){
+            } else if (args[i].startsWith(INFO_SWITCH)) {
+                printInfo();
+                System.exit(0);
+            } else if (args[i].startsWith(PLUGINS_SWITCH)) {
                 i++;
                 pluginsRootDirectory = args[i];
-            }else if (args[i].startsWith(PASSWORD_SWITCH)){
+            } else if (args[i].startsWith(PASSWORD_SWITCH)) {
                 i++;
-                password = args[i]; 
-            }else if (args[i].startsWith(LOAD_FROM_STDIN_SWITCH)){
-                loadFromSTDIN=true;
-            }else if (args[i].startsWith(LOG_HOST_SWITCH)){
+                password = args[i];
+            } else if (args[i].startsWith(LOAD_FROM_STDIN_SWITCH)) {
+                loadFromSTDIN = true;
+            } else if (args[i].startsWith(LOG_HOST_SWITCH)) {
                 i++;
-                logHost = args[i]; 
-            }else if (args[i].startsWith(&quot;-&quot;)) {
-				System.err.println(&quot;Unknown option: &quot;+args[i]);
-				System.exit(-1);
+                logHost = args[i];
+            } else if (args[i].startsWith(&quot;-&quot;)) {
+                System.err.println(&quot;Unknown option: &quot; + args[i]);
+                System.exit(-1);
             }
-		}
+        }
 
-        //setup log4j appenders
-        if(logHost != null) {
+        // setup log4j appenders
+        if (logHost != null) {
             String[] hostAndPort = logHost.split(&quot;:&quot;);
-            if(hostAndPort[0].length() == 0 || hostAndPort.length &gt; 2) {
-                System.err.println(&quot;Invalid log destination, i.e. -loghost localhost:4445&quot;);
+            if (hostAndPort[0].length() == 0 || hostAndPort.length &gt; 2) {
+                System.err
+                        .println(&quot;Invalid log destination, i.e. -loghost localhost:4445&quot;);
                 System.exit(-1);
             }
             int port = 4445;
             try {
-                if(hostAndPort.length == 2) {
+                if (hostAndPort.length == 2) {
                     port = Integer.parseInt(hostAndPort[1]);
                 }
-            } catch(NumberFormatException e) {
-                System.err.println(&quot;Invalid log destination, i.e. -loghost localhost:4445&quot;);
+            } catch (NumberFormatException e) {
+                System.err
+                        .println(&quot;Invalid log destination, i.e. -loghost localhost:4445&quot;);
                 System.exit(-1);
             }
-            Logger.getRootLogger().addAppender(new SocketAppender(hostAndPort[0], port));
+            Logger.getRootLogger().addAppender(
+                    new SocketAppender(hostAndPort[0], port));
         }
 
-        //engine initialization - should be called only once
+        // engine initialization - should be called only once
         runGraph.initEngine(pluginsRootDirectory, password);
-        
-		//prapere input stream with XML graph definition
+
+        // prapere input stream with XML graph definition
         InputStream in = null;
         if (loadFromSTDIN) {
             System.out.println(&quot;Graph definition loaded from STDIN&quot;);
             in = System.in;
         } else {
-            System.out.println(&quot;Graph definition file: &quot; + args[args.length - 1]);
-            URL fileURL = FileUtils.getFileURL(args[args.length - 1]);
-            if(fileURL == null) {
-                System.err.println(&quot;Error - graph definition file can't be read.&quot;);
-                System.exit(-1);
-            }
-            try{
-                in=fileURL.openStream();
+            System.out.println(&quot;Graph definition file: &quot;
+                    + args[args.length - 1]);
+            try {
+                URL fileURL = FileUtils.getFileURL(null, args[args.length - 1]);
+                in = fileURL.openStream();
             } catch (IOException e) {
-                System.err.println(&quot;Error - graph definition file can't be read: &quot; + e.getMessage());
+                System.err
+                        .println(&quot;Error - graph definition file can't be read: &quot;
+                                + e.getMessage());
                 System.exit(-1);
             }
         }
-        
-        //loading graph from the input stream
+
+        // loading graph from the input stream
         TransformationGraph graph = null;
         try {
             graph = runGraph.loadGraph(in, properties);
 
-            //check graph elements configuration
-            ConfigurationStatus status = graph.checkConfig(null);
+            // check graph elements configuration
             logger.info(&quot;Checking graph configuration...&quot;);
-            status.log();
+            try {
+                ConfigurationStatus status = graph.checkConfig(null);
+                status.log();
+            } catch(Exception e) {
+                logger.error(&quot;Checking graph failed! (&quot; + e.getMessage() + &quot;)&quot;);
+            }
 
-            if(!graph.init()) {
-                throw new GraphConfigurationException(&quot;Graph initialization failed.&quot;);
+            if (!graph.init()) {
+                throw new GraphConfigurationException(
+                        &quot;Graph initialization failed.&quot;);
             }
 
             if (verbose) {
-                //this can be called only after graph.init()
+                // this can be called only after graph.init()
                 graph.dumpGraphConfiguration();
             }
-        }catch(XMLConfigurationException ex){
+        } catch (XMLConfigurationException ex) {
             logger.error(&quot;Error in reading graph from XML !&quot;, ex);
             if (verbose) {
                 ex.printStackTrace(System.err);
             }
             System.exit(-1);
-        }catch(GraphConfigurationException ex){
+        } catch (GraphConfigurationException ex) {
             logger.error(&quot;Error - graph's configuration invalid !&quot;, ex);
             if (verbose) {
                 ex.printStackTrace(System.err);
@@ -297,35 +315,42 @@
             }
             System.exit(-1);
         }
-        
+
         // set tracking interval
-		if(trackingInterval!=-1){
-			graph.setTrackingInterval(trackingInterval*1000);
-		}
-		
-		//	start all Nodes (each node is one thread)
-		Result result=Result.N_A;
-		try {
+        if (trackingInterval != -1) {
+            graph.setTrackingInterval(trackingInterval * 1000);
+        }
+
+        // start all Nodes (each node is one thread)
+        Result result = Result.N_A;
+        try {
             result = graph.run();
-		} catch (RuntimeException ex) {
-			System.err.println(&quot;Fatal error during graph run !&quot;);
-			System.err.println(ex.getCause().getMessage());
-			if (verbose) {
-				ex.printStackTrace();
-			}
-			System.exit(-1);
-		}
-		if (result==Result.FINISHED_OK) {
-			// everything O.K.
-			System.out.println(&quot;Execution of graph successful !&quot;);
-			System.exit(0);
-		} else {
-			// something FAILED !!
-			System.err.println(&quot;Execution of graph failed !&quot;);
-			System.exit(result.code());
-		}
+        } catch (RuntimeException ex) {
+            System.err.println(&quot;Fatal error during graph run !&quot;);
+            System.err.println(ex.getCause().getMessage());
+            if (verbose) {
+                ex.printStackTrace();
+            }
+            System.exit(-1);
+        }
+        switch (result) {
 
-	}
+        case FINISHED_OK:
+            // everything O.K.
+            System.out.println(&quot;Execution of graph successful !&quot;);
+            System.exit(0);
+            break;
+        case ABORTED:
+            // execution was ABORTED !!
+            System.err.println(&quot;Execution of graph aborted !&quot;);
+            System.exit(result.code());
+            break;
+        default:
+            System.err.println(&quot;Execution of graph failed !&quot;);
+            System.exit(result.code());
+        }
+
+    }
     
     
 	private static void printHelp() {

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataFieldMetadata.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataFieldMetadata.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataFieldMetadata.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -92,7 +92,7 @@
 	 *
 	 *   [record name].[field name]
 	 */
-	private String codeStr;
+//	private String codeStr;
 
 	private TypedProperties fieldProperties;
 	
@@ -249,7 +249,7 @@
 		ret.setType(getType());
 		ret.setNullable(isNullable());
 		ret.setDefaultValueStr(getDefaultValueStr());
-		ret.setCodeStr(getCodeStr());
+//		ret.setCodeStr(getCodeStr());
 		ret.setLocaleStr(getLocaleStr());
 
 		//copy record properties
@@ -497,9 +497,9 @@
 	 *
 	 * @param  codeStr
 	 */
-	public void setCodeStr(String codeStr) {
-		this.codeStr = codeStr;
-	}
+//	public void setCodeStr(String codeStr) {
+//		this.codeStr = codeStr;
+//	}
 
 
 	/**
@@ -507,9 +507,9 @@
 	 *
 	 * @return
 	 */
-	public String getCodeStr() {
-		return codeStr;
-	}
+//	public String getCodeStr() {
+//		return codeStr;
+//	}
 
 
 	/**

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadata.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadata.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadata.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -29,6 +29,7 @@
 import java.util.Properties;
 
 import org.jetel.exception.InvalidGraphObjectNameException;
+import org.jetel.util.BitArray;
 import org.jetel.util.StringUtils;
 import org.jetel.util.TypedProperties;
 
@@ -51,8 +52,9 @@
 	/**
 	 * @since
 	 */
-	private List fields;
-
+	private List&lt;DataFieldMetadata&gt; fields;
+	private BitArray fieldNullSwitch;
+    
 	private Map fieldNames;
 	private Map fieldTypes;
 
@@ -61,6 +63,7 @@
 	private String[] recordDelimiters;
 	private short recordSize;
 	private String localeStr;
+    private short numNullableFields;
 
 	private TypedProperties recordProperties;
 
@@ -99,11 +102,13 @@
 			throw new InvalidGraphObjectNameException(_name,&quot;RECORD&quot;);
 		}
 		this.name = _name;
-		this.fields = new ArrayList();
+		this.fields = new ArrayList&lt;DataFieldMetadata&gt;();
 		fieldNames = new HashMap();
 		fieldTypes = new HashMap();
 		recordProperties = null;
 		localeStr=null;
+        numNullableFields=0;
+        fieldNullSwitch=new BitArray();
 	}
 
 	/**
@@ -337,6 +342,16 @@
 	private void structureChanged() {
 	    fieldNames.clear();
 	    fieldTypes.clear();
+        numNullableFields=0;
+        fieldNullSwitch.resize(fields.size());
+        int count=0;
+        for(DataFieldMetadata fieldMeta: fields){
+            if (fieldMeta.isNullable()){
+                numNullableFields++;
+                fieldNullSwitch.set(count);
+            }
+            count++;
+        }
 	}
 	
 	/**  Description of the Method */
@@ -607,6 +622,39 @@
     	}
     	return result;
     }
+
+
+    /**
+     * Determine whether DataRecord described by this metadata
+     * has at least one field which may contain a NULL value.&lt;br&gt;
+     * 
+     * @return true if at least nullable field is present otherwise false
+     * @since 18.1.2007
+     */
+    public boolean isNullable() {
+        return numNullableFields!=0;
+    }
+
+
+    /**
+     * Returns BitArray where bits are set for fields
+     * which may contain NULL.
+     * 
+     * @return the fieldNullSwitch
+     * @since 18.1.2007
+     */
+    public BitArray getFieldsNullSwitches() {
+        return fieldNullSwitch;
+    }
+
+
+    /**
+     * @return the countNullableFields
+     * @since 18.1.2007
+     */
+    public short getNumNullableFields() {
+        return numNullableFields;
+    }
     
 }
 /*

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadataXMLReaderWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadataXMLReaderWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/DataRecordMetadataXMLReaderWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -367,12 +367,12 @@
 					}
 				}
 
-				if (field.getCodeStr() != null) {
-				    Element codeElement = doc.createElement(CODE_ELEMENT);
-				    fieldElement.appendChild(codeElement);
-				    Text codeText = doc.createTextNode(field.getCodeStr());
-				    codeElement.appendChild(codeText);
-				}
+//				if (field.getCodeStr() != null) {
+//				    Element codeElement = doc.createElement(CODE_ELEMENT);
+//				    fieldElement.appendChild(codeElement);
+//				    Text codeText = doc.createTextNode(field.getCodeStr());
+//				    codeElement.appendChild(codeText);
+//				}
 
 			}
 		}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/MetadataFactory.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/MetadataFactory.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/metadata/MetadataFactory.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -21,11 +21,11 @@
 
 import java.io.BufferedInputStream;
 import java.io.IOException;
-import java.net.MalformedURLException;
 import java.net.URL;
 import java.sql.SQLException;
 
 import org.jetel.graph.TransformationGraph;
+import org.jetel.util.FileUtils;
 import org.w3c.dom.DOMException;
 
 
@@ -49,22 +49,12 @@
 	 * @see	org.jetel.metadata.DataRecordMetadata
 	 */
 	public static DataRecordMetadata fromFile(TransformationGraph graph, String fileURL) throws IOException {
-		URL url;
-		try{
-			url = new URL(fileURL); 
-		}catch(MalformedURLException e){
-			// try to patch the url
-			try {
-				url=new URL(&quot;file:&quot;+fileURL);
-			}catch(MalformedURLException ex){
-				throw new RuntimeException(&quot;Wrong URL of file specified: &quot;+ex.getMessage());
-			}
-		}
+		URL url = FileUtils.getFileURL(graph.getProjectURL(), fileURL);
+        
 		DataRecordMetadata recordMetadata;
 		DataRecordMetadataXMLReaderWriter metadataXMLRW = new DataRecordMetadataXMLReaderWriter(graph);
 		try{
-		recordMetadata=metadataXMLRW.read(
-				new BufferedInputStream(url.openStream()));
+		recordMetadata=metadataXMLRW.read(new BufferedInputStream(url.openStream()));
 			if (recordMetadata==null){
 				throw new RuntimeException(&quot;Can't parse metadata definition file: &quot;+fileURL);
 			}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginClassLoader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginClassLoader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginClassLoader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -22,6 +22,7 @@
 import java.net.URL;
 import java.net.URLClassLoader;
 import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.Collection;
 import java.util.HashSet;
 import java.util.Iterator;
@@ -42,21 +43,25 @@
 
     private PluginDescriptor[] importPlugins;
     
-    public PluginClassLoader(ClassLoader parent, PluginDescriptor pluginDescriptor, URL[] urls) {
-        super(urls, parent);
+    /**
+     * Constructor.
+     * @param parent
+     * @param pluginDescriptor
+     */
+    public PluginClassLoader(ClassLoader parent, PluginDescriptor pluginDescriptor) {
+        super(pluginDescriptor.getLibraryURLs(), parent);
         
         this.pluginDescriptor = pluginDescriptor;
         collectImports();
     }
 
-    
     /**
-     * Collect all plugin descriptors, on which depeneds this plugin. 
+     * Collect all plugin descriptors, on which depends this plugin. 
      */
     private void collectImports() {
         PluginDescriptor pluginDescriptor;
         Collection prerequisites = getPluginDescriptor().getPrerequisites();
-        List importPlugins = new ArrayList();
+        List&lt;PluginDescriptor&gt; importPlugins = new ArrayList&lt;PluginDescriptor&gt;();
         
         for(Iterator it = prerequisites.iterator(); it.hasNext();) {
             PluginPrerequisite prerequisite = (PluginPrerequisite) it.next();
@@ -66,69 +71,53 @@
             }
         }
         
-        this.importPlugins = (PluginDescriptor[]) importPlugins.toArray(new PluginDescriptor[importPlugins.size()]);
+        this.importPlugins = importPlugins.toArray(new PluginDescriptor[importPlugins.size()]);
     }
 
-
-    protected Class loadClass(String name, boolean resolve) throws ClassNotFoundException {
-        Class ret;
+    @Override
+    protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {
         try {
-            ret = getParent().loadClass(name);
-        } catch (ClassNotFoundException cnfe) {
-            ret = loadClass(name, resolve, this, null);
+            return super.findClass(name);
+        } catch(ClassNotFoundException e) {
+            return findClassInPrerequisities(name, null);
         }
-        if (ret != null) {
-            return ret;
-        }
-        throw new ClassNotFoundException(name);
     }
     
-    public synchronized Class loadClass(String name, boolean resolve, PluginClassLoader requestor, Set seen) throws ClassNotFoundException {
+    synchronized public Class&lt;?&gt; findClass(String name, Set&lt;String&gt; seen) throws ClassNotFoundException {
         //firstly we will try if this class is not loaded yet
-        Class ret = null;
+        Class&lt;?&gt; ret = null;
         ret = findLoadedClass(name);
         if(ret != null) {
-            if (resolve) {
-                resolveClass(ret);
-            }
             return ret; // found already loaded class in this plug-in
         }
         
         //secondly we try use findClass() method from URLClassLoader
-        try {
-            ret = findClass(name);
-        } catch (ClassNotFoundException cnfe) {
-            // ignore
-        }
-        if(ret != null) {
-            if (resolve) {
-                resolveClass(ret);
-            }
-            return ret; // found class in this plug-in
-        }
+        return findClass(name);
+    }
 
-        if(seen == null) {
-            seen = new HashSet();
-        }
-        seen.add(getPluginDescriptor().getId());
+   private Class&lt;?&gt; findClassInPrerequisities(String name, Set&lt;String&gt; seen) throws ClassNotFoundException {
+       Class&lt;?&gt; ret = null;
+       
+       if(seen == null) {
+           seen = new HashSet&lt;String&gt;();
+       }
+       seen.add(getPluginDescriptor().getId());
 
-        //try all dependant plugins
-        for(int i = 0; i &lt; importPlugins.length; i++) {
-            if(seen.contains(importPlugins[i].getId())) {
-                continue;
-            }
-            ret = ((PluginClassLoader) importPlugins[i].getClassLoader()).loadClass(name, resolve, requestor, seen);
-            if(ret != null) {
-                if (resolve) {
-                    resolveClass(ret);
-                }
-                break; // found class in imported plug-in
-            }
-        }
-
-        return ret;
-    }
-    
+       //try all dependant plugins
+       for(int i = 0; i &lt; importPlugins.length; i++) {
+           if(seen.contains(importPlugins[i].getId())) {
+               continue;
+           }
+           try {
+               return ((PluginClassLoader) importPlugins[i].getClassLoader()).findClass(name, seen);
+           } catch(ClassNotFoundException e) {
+               //continue;
+           }
+       }
+       
+       throw new ClassNotFoundException(name);
+   }
+       
     /**
      * @return returns the plug-in descriptor
      */
@@ -136,4 +125,23 @@
         return pluginDescriptor;
     }
 
+    /**
+     * @return concatened lists of parent class loader, this class loader and all
+     * dependant class loaders URLs (getURLs())
+     */
+    public URL[] getAllURLs() {
+        List&lt;URL&gt; retURLs = new ArrayList&lt;URL&gt;();
+        ClassLoader parentClassLoader = getParent();
+        
+        if(parentClassLoader instanceof URLClassLoader) {
+           retURLs.addAll(Arrays.asList(((URLClassLoader) parentClassLoader).getURLs()));
+        }
+        retURLs.addAll(Arrays.asList(getURLs()));
+        
+        for(int i = 0; i &lt; importPlugins.length; i++) {
+            retURLs.addAll(Arrays.asList(((PluginClassLoader) importPlugins[i].getClassLoader()).getURLs()));
+        }
+        
+        return retURLs.toArray(new URL[retURLs.size()]);
+    }
 }
\ No newline at end of file

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginDescriptor.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginDescriptor.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/plugin/PluginDescriptor.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -189,21 +189,26 @@
             return null;
         }
         if(classLoader == null) {
-            URL[] urls = new URL[libraries.size()];
-            
-            for(int i = 0; i &lt; libraries.size(); i++) {
-                File f = new File(manifest.getParentFile().getAbsolutePath() + System.getProperty(&quot;file.separator&quot;) + libraries.get(i));
-                try {
-                    urls[i] = f.toURL();
-                } catch (MalformedURLException e) {
-                    logger.error(&quot;Cannot create URL to plugin (&quot; + getManifest() + &quot;) library &quot; + libraries.get(i) + &quot;.&quot;);
-                }
-            }
-            classLoader = new PluginClassLoader(PluginDescriptor.class.getClassLoader(), this, urls);
+            classLoader = new PluginClassLoader(PluginDescriptor.class.getClassLoader(), this);
         }
         return classLoader;
     }
     
+    public URL[] getLibraryURLs() {
+        URL[] urls = new URL[libraries.size()];
+        
+        for(int i = 0; i &lt; libraries.size(); i++) {
+            File f = new File(manifest.getParentFile().getAbsolutePath() + System.getProperty(&quot;file.separator&quot;) + libraries.get(i));
+            try {
+                urls[i] = f.toURL();
+            } catch (MalformedURLException e) {
+                logger.error(&quot;Cannot create URL to plugin (&quot; + getManifest() + &quot;) library &quot; + libraries.get(i) + &quot;.&quot;);
+            }
+        }
+        
+        return urls;
+    }
+    
     public void addExtension(String pointId, Properties parameters) {
         extensions.add(new Extension(pointId, parameters, this));
     }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/BitArray.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/BitArray.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/BitArray.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -18,7 +18,8 @@
 *
 */
 package org.jetel.util;
-import java.lang.IndexOutOfBoundsException;
+import java.nio.ByteBuffer;
+import java.util.Arrays;
 /**
  * Class for representing strings of bits.&lt;br&gt;
  * Uses arrays of bytes to group bits by 8 together.
@@ -31,8 +32,9 @@
 
 public class BitArray {
 
-	private final byte bits[];
-	private final int length;
+	private  byte bits[];
+	private  int length;
+    private  int lengthBytes;
 
 
 	/**
@@ -43,64 +45,120 @@
 	public BitArray(int size) {
 		length = size;
 		if (length&lt;1) throw new RuntimeException(&quot;Can't create ZERO length array !&quot;);
-		bits = new byte[(size-1) / 8 + 1];
+		bits = new byte[((size-1) &gt;&gt; 3) + 1];
+        lengthBytes=bits.length;
 		// init array
-		for (int i = 0; i &lt; bits.length; i++) {
-			bits[i]=0;
-		}
+        Arrays.fill(bits,(byte)0);
 	}
 
+    /**
+     * Creates BitArray with space for 16 bits.
+     * 
+     */
+    public BitArray(){
+        this(16);
+    }
+    
+    private BitArray(byte[] bits,int length){
+        this.bits=bits;
+        this.length=length;
+        this.lengthBytes=bitsLength2Bytes(length);
+        
+    }
+    
+    
+    /**
+     * Wraps existing byte array into BitArray
+     * 
+     * @param bits
+     * @param length
+     * @return
+     * @since 23.1.2007
+     */
+    public static BitArray wrap(byte[] bits,int length){
+        return new BitArray(bits,length);
+    }
 
+    /**
+     * Utility method which makes sure we can
+     * accomodate specified number of bits and then
+     * resets all bits.
+     * 
+     * @param size
+     * @since 23.1.2007
+     */
+    public void resize(int size){
+       ensureSize(size);
+       resetAll();
+    }
+    
+    /**
+     * Ensures that the BitArray can accomodate specified
+     * number of bits
+     * 
+     * @param size
+     * @since 18.1.2007
+     */
+    public void ensureSize(int size){
+        length = size;
+        lengthBytes = ((size-1) &gt;&gt; 3) + 1; 
+        if (bits.length &lt; lengthBytes){
+            bits = new byte[lengthBytes];
+        }
+       
+    }
+    
 	/**
-	 *  Sets the specified bit to 1/True
+	 *  Sets the specified bit to 1/True.
+     *  The index is ZERO based.
 	 *
 	 *@param  index  which bit to set
 	 */
 	public final void set(int index) {
-		if (index &gt;= length) {
-			throw new IndexOutOfBoundsException();
-		}
-		bits[index / 8] |= (byte) (1 &lt;&lt; (index % 8));
+		bits[index &gt;&gt; 3] |= (byte) (1 &lt;&lt; (index % 8));
 	}
 
 
 	/**
-	 *  Re-sets the specified bit to 0/false
+	 *  Re-sets the specified bit to 0/false.
+     *  The index is ZERO based.
 	 *
 	 *@param  index  which bit to reset
 	 */
 	public final void reset(int index) {
-		if (index &gt;= length) {
-			throw new IndexOutOfBoundsException();
-		}
-		bits[index / 8] &amp;= (~((byte) (1 &lt;&lt; (index % 8))));
+		bits[index &gt;&gt; 3] &amp;= (~((byte) (1 &lt;&lt; (index % 8))));
 	}
 
+    
+    public final void resetAll(){
+        Arrays.fill(bits,0,lengthBytes,(byte)0);
+    }
+    
+    public final void setAll(){
+        Arrays.fill(bits,0,lengthBytes,(byte)0xFF);
+    }
 
 	/**
-	 *  Gets state of specified bit
+	 *  Gets state of specified bit.
+     *  The index is ZERO based.
 	 *
 	 *@param  index  which bit to check
 	 *@return        true/false according to bit state
 	 */
-	public final boolean get(int index) {
-		if (index &gt;= length) {
-			throw new IndexOutOfBoundsException();
-		}
-		byte pattern = (byte) (1 &lt;&lt; (index % 8));
-		return (bits[index / 8] &amp; pattern) == pattern ? true : false;
+	public final boolean isSet(int index) {
+		return (bits[index &gt;&gt; 3] &amp; ((byte) (1 &lt;&lt; (index % 8)))) != 0;
 	}
 
 
 	/**
 	 *  Gets state of specified bit&lt;br&gt;
-	 *  Synonym for get()
+	 *  Synonym for isSet()
 	 *
 	 *@param  index  which bit to check
 	 *@return        true/false according to bit state
 	 */
-	public final boolean isSet(int index) {
-		return get(index);
+	public final boolean get(int index) {
+		return isSet(index);
 	}
 
 
@@ -130,6 +188,16 @@
 		return str.toString();
 	}
 
+    public static final String toString(byte[] array) {
+        StringBuffer str = new StringBuffer(array.length * 8 *2  + 1);
+        str.append(&quot;|&quot;);
+        for (int i = 0; i &lt; (array.length*8); i++) {
+            str.append(isSet(array,i) ? &quot;1&quot; : &quot;0&quot;);
+            str.append(&quot;|&quot;);
+        }
+        return str.toString();
+    }
+    
 
 	/**
 	 *  Returns backing array of bytes&lt;br&gt;
@@ -140,28 +208,107 @@
 	public final byte[] getByteArray() {
 		return bits;
 	}
+	 
+    /**
+     *  Performs serialization of the internal value into ByteBuffer 
+     *
+     *@param  buffer  Description of Parameter
+     *@since          October 29, 2002
+     */
+    public void serialize(ByteBuffer buffer) {
+         buffer.put(bits,0,lengthBytes);
+    }
 
-	   //this is for debugging only
-	   /*
-	   public static void main(String args[]){
-		   BitArray array=new BitArray(16);
-		   array.set(8);
-		   array.set(0);
-		   array.set(10);
-		   array.set(7);
-		   System.out.println(array.get(1));
-		   System.out.println(array.get(0));
-		   System.out.println(array.get(8));
-		   System.out.println(array.get(9));
-		   System.out.println(array.get(10));
-		   System.out.println(array);
-		   array.reset(10);
-		   array.set(1);
-		   array.reset(7);
-		   System.out.println(array.get(10));
-		   System.out.println(array);
-	   }
-	   */
+
+    /**
+     *  Performs deserialization of data
+     *
+     *@param  buffer  Description of Parameter
+     *@since          October 29, 2002
+     */
+    public void deserialize(ByteBuffer buffer) {
+        buffer.get(bits,0,lengthBytes);
+    }
+
+    
+    /**
+     * How many bytes is needed to store specified number
+     * of bits.
+     * 
+     * @param bits
+     * @return
+     * @since 18.1.2007
+     */
+    public final static int bitsLength2Bytes(int bits){
+        return ((bits - 1)&gt;&gt; 3) + 1;
+    }
+    
+    /**
+     * Sets specified bit in array of bytes - counting
+     * from left.
+     * The bit parameter is ZERO based.
+     * 
+     * @param bytes
+     * @param bit
+     * @since 18.1.2007
+     */
+    public final static void set(byte[] bytes,int bit){
+        bytes[bit &gt;&gt; 3] |= (byte) (1 &lt;&lt; (bit % 8));
+    }
+    
+    public final static void set(ByteBuffer bytes,int base,int bit){
+        final int position=bit &gt;&gt; 3 + bytes.position() + base ;
+        bytes.put(position, (byte)( bytes.get(position) | (1 &lt;&lt; (bit % 8))));
+    }
+    
+    /**
+     *  Gets status of specified bit in array of bytes - counting
+     * from left.
+     *  The bit parameter is ZERO based.
+     * 
+     * @param bytes
+     * @param bit
+     * @return  true if set otherwise false
+     * @since 18.1.2007
+     */
+    public final static boolean isSet(byte[] bytes,int bit){
+        return ((bytes[bit &gt;&gt; 3] &amp; ((byte) (1 &lt;&lt; (bit % 8)))) != 0 );
+    }
+    
+    public final static boolean isSet(ByteBuffer bytes,int base, int bit){
+        final int position=bit &gt;&gt; 3 + bytes.position() + base ;
+        return ((bytes.get(position) &amp; ((byte) (1 &lt;&lt; (bit % 8))))!= 0); 
+        
+    }
+    
+    /**
+     * Resets specified bit in array of bytes - counting
+     * from left.
+     *  The bit parameter is ZERO based.
+     * 
+     * @param bytes
+     * @param bit
+     * @since 18.1.2007
+     */
+    public final static void reset(byte[] bytes, int bit){
+        bytes[bit &gt;&gt; 3] &amp;= (~((byte) (1 &lt;&lt; (bit % 8))));
+    }
+  
+    public final static void reset(ByteBuffer bytes, int base, int bit){
+        final int position=bit &gt;&gt; 3 + bytes.position()+base;
+        bytes.put(position, (byte)( bytes.get(position) &amp; (~((1 &lt;&lt; (bit % 8))))));
+    }
+
+    /**
+     * How many bytes are used to store the number
+     * of bits this BitArray can represent
+     * 
+     * @return the lengthBytes
+     * @since 25.1.2007
+     */
+    public int getLengthBytes() {
+        return lengthBytes;
+    }   
 }
 /*
  *  End class BitArray

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/ByteBufferUtils.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/ByteBufferUtils.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/ByteBufferUtils.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -55,9 +55,7 @@
 	public static int flush(ByteBuffer buffer, WritableByteChannel writer)
 			throws IOException {
 		int write = 0;
-//		if (buffer.position() != 0) {
-			buffer.flip();
-//		}
+		buffer.flip();
 		write = writer.write(buffer);
 		buffer.clear();
 		return write;
@@ -81,7 +79,6 @@
 			buffer.compact();
 		}
 		read = reader.read(buffer);
-//		buffer.flip();
 		return read;
 	}
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/Compiler.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/Compiler.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/Compiler.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -53,6 +53,7 @@
     private boolean forceRecompile;
     private String classPath;
     private ByteArrayOutputStream compileOutputStream;
+    private ClassLoader classLoader;
     
     public Compiler(String srcFileName, boolean captureOutput, String destDirName) {
         this.srcFileName = srcFileName;
@@ -79,7 +80,7 @@
     public Compiler(String srcFile, boolean captureOutput) {
         this(srcFile, captureOutput, System.getProperty(&quot;java.io.tmpdir&quot;, &quot;.&quot;));
     }
-    
+
     public Compiler(String srcFile) {
         this(srcFile, false);
     }
@@ -172,9 +173,7 @@
     
     private String getClassPath() {
         if(classPath == null) {
-            //ClassLoader loader = Thread.currentThread().getContextClassLoader();
-            ClassLoader loader = getClass().getClassLoader();
-            classPath = ClassLoaderUtils.getClasspath(loader);
+            classPath = ClassLoaderUtils.getClasspath(getClassLoader());
         }
         return classPath;
     }
@@ -211,4 +210,16 @@
     public String getErrFileName() {
         return errFileName;
     }
+
+    public void setClassLoader(ClassLoader classLoader) {
+        this.classLoader = classLoader;
+    }
+
+    public ClassLoader getClassLoader() {
+        if(classLoader == null) {
+            //return Thread.currentThread().getContextClassLoader();
+            return getClass().getClassLoader();
+        }
+        return classLoader;
+    }
 }

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/DynamicJavaCode.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/DynamicJavaCode.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/DynamicJavaCode.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -53,10 +53,12 @@
 	private String className;
 	private String fileName;
 	private String compilerOutput;
-	
+	private ClassLoader classLoader;
+    
 	private boolean captureCompilerOutput = true; 
 	
-	public DynamicJavaCode(String srcCode) {
+	public DynamicJavaCode(String srcCode, ClassLoader classLoader) {
+        this.classLoader = classLoader;
 		this.srcCode = srcCode;
         this.srcPath = SRC_PATH + (SRC_PATH.endsWith(FILE_SEPARATOR) ? &quot;&quot; : FILE_SEPARATOR);
 		Matcher matcher = PATTERN.matcher(srcCode);
@@ -69,6 +71,10 @@
 		}
 	}
 
+    public DynamicJavaCode(String srcCode) {
+        this(srcCode, null);
+    }
+
 	private void saveSrc() {
 		long checkSumFile;
 		fileName = srcPath + className + &quot;.java&quot;;
@@ -93,6 +99,7 @@
 	
 	private void compile() {
 		Compiler compiler = new Compiler(fileName, captureCompilerOutput);
+        compiler.setClassLoader(classLoader);
 		int result = compiler.compile();
 		if (result != 0) {
 		    compilerOutput = compiler.getCapturedOutput();
@@ -130,8 +137,7 @@
 			throw new RuntimeException(ex);
 		}
 
-		URLClassLoader classLoader = new URLClassLoader(myURLs, Thread.currentThread().getContextClassLoader());
-		// URLClassLoader classLoader = Thread.currentThread().getContextClassLoader();
+        URLClassLoader classLoader = new URLClassLoader(myURLs, getClassLoader());
 		try {
 		    logger.debug(&quot;Loading Class: &quot; + className + &quot;...&quot;);
 			tClass = Class.forName(className, true, classLoader);
@@ -209,5 +215,17 @@
     public void setCaptureCompilerOutput(boolean captureCompilerOutput) {
         this.captureCompilerOutput = captureCompilerOutput;
     }
+
+    public void setClassLoader(ClassLoader classLoader) {
+        this.classLoader = classLoader;
+    }
+
+    public ClassLoader getClassLoader() {
+        if(classLoader == null) {
+            //return Thread.currentThread().getContextClassLoader();
+            return getClass().getClassLoader();
+        }
+        return classLoader;
+    }
 }
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/FileUtils.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/FileUtils.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/FileUtils.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -55,30 +55,26 @@
 	 * @return          The full path to file with ENV references resolved
 	 * @since           May 24, 2002
 	 */
-	public static String getFullPath(String fileURL) {
-		return fileURL;
-	}
+//	public static String getFullPath(String fileURL) {
+//		return fileURL;
+//	}
     
     /**
      * Creates URL object based on specified fileURL string. Handles
      * situations when &lt;code&gt;fileURL&lt;/code&gt; contains only path to file
      * &lt;i&gt;(without &quot;file:&quot; string)&lt;/i&gt;. 
      * 
+     * @param contextURL context URL for converting relative to absolute path (see TransformationGraph.getProjectURL()) 
      * @param fileURL   string containing file URL
      * @return  URL object or NULL if object can't be created (due to Malformed URL)
+     * @throws MalformedURLException  
      */
-    public static URL getFileURL(String fileURL){
-        URL url;
-        try{
-            url = new URL(fileURL);
-        }catch(MalformedURLException ex){
-            try{
-                url = new URL(&quot;file:&quot;+fileURL);
-            }catch(MalformedURLException ex1){
-                return null;
-            }
+    public static URL getFileURL(URL contextURL, String fileURL) throws MalformedURLException {
+        try {
+            return new URL(contextURL, fileURL);
+        } catch(MalformedURLException ex) {
+            return new URL(contextURL, &quot;file:&quot; + fileURL);
         }
-        return url;
     }
 
 
@@ -110,37 +106,28 @@
 
 	/**
 	 * Reads file specified by URL. The content is returned as String
+     * @param contextURL context URL for converting relative to absolute path (see TransformationGraph.getProjectURL()) 
 	 * @param fileURL URL specifying the location of file from which to read
 	 * @return
 	 */
-	public static String getStringFromURL(String fileURL){
+	public static String getStringFromURL(URL contextURL, String fileURL){
         URL url;
-		try{
-			url = new URL(fileURL); 
-		}catch(MalformedURLException e){
-			// try to patch the url
-			try {
-				url=new URL(&quot;file:&quot;+fileURL);
-			}catch(MalformedURLException ex){
-				throw new RuntimeException(&quot;Wrong URL of file specified: &quot;+ex.getMessage());
-			}
+		try {
+			url = FileUtils.getFileURL(contextURL, fileURL);
+		}catch(MalformedURLException ex){
+			throw new RuntimeException(&quot;Wrong URL of file specified: &quot;+ex.getMessage());
 		}
 
 		StringBuffer sb = new StringBuffer(2048);
-        
-		try
-        {
+		try {
             char[] charBuf=new char[256];
             BufferedReader in=new BufferedReader(new InputStreamReader(url.openStream()));
             int readNum;
             
-            while ((readNum=in.read(charBuf,0,charBuf.length)) != -1)
-            {
+            while ((readNum=in.read(charBuf,0,charBuf.length)) != -1) {
                 sb.append(charBuf,0,readNum);
             }
-        }
-        catch(IOException ex)
-        {
+        } catch(IOException ex) {
             throw new RuntimeException(&quot;Can't get string from file &quot; + fileURL + &quot; : &quot; + ex.getMessage());
         }
         return sb.toString();
@@ -154,11 +141,12 @@
      *  &lt;dd&gt;zip:&lt;url_to_zip_file&gt;#&lt;inzip_path_to_file&gt;&lt;/dd&gt;
      *  &lt;dd&gt;gzip:&lt;url_to_gzip_file&gt;&lt;/dd&gt;
      * &lt;/dl&gt;
+     * @param contextURL context URL for converting relative to absolute path (see TransformationGraph.getProjectURL()) 
      * @param input URL of file to read
      * @return
      * @throws IOException
      */
-    public static ReadableByteChannel getReadableChannel(String input) throws IOException {
+    public static ReadableByteChannel getReadableChannel(URL contextURL, String input) throws IOException {
         String strURL = input;
         String zipAnchor = null;
         URL url;
@@ -177,16 +165,7 @@
         }
         
         //open channel
-        try {
-            url = new URL(strURL); 
-        } catch(MalformedURLException e) {
-            // try to patch the url
-            try {
-                url = new URL(&quot;file:&quot; + strURL);
-            } catch(MalformedURLException ex) {
-                throw new IOException(&quot;Wrong URL of file specified: &quot; + ex.getMessage());
-            }
-        }
+        url = FileUtils.getFileURL(contextURL, strURL); 
 
         //resolve url format for zip files
         if(input.startsWith(&quot;zip:&quot;)) {
@@ -226,12 +205,13 @@
      *  &lt;dd&gt;zip:&lt;url_to_zip_file&gt;#&lt;inzip_path_to_file&gt;&lt;/dd&gt;
      *  &lt;dd&gt;gzip:&lt;url_to_gzip_file&gt;&lt;/dd&gt;
      * &lt;/dl&gt;
+     * @param contextURL context URL for converting relative to absolute path (see TransformationGraph.getProjectURL()) 
 	 * @param input
 	 * @param appendData
 	 * @return
 	 * @throws IOException
 	 */
-	public static WritableByteChannel getWritableChannel(String input, boolean appendData) throws IOException {
+	public static WritableByteChannel getWritableChannel(URL contextURL, String input, boolean appendData) throws IOException {
         String strURL = input;
         String zipAnchor = null;
         OutputStream os;
@@ -252,16 +232,7 @@
 		if(!strURL.startsWith(&quot;ftp&quot;)) {
 			os = new FileOutputStream(strURL, appendData);
 		} else {
-			try {
-				url = new URL(strURL); 
-			} catch(MalformedURLException e) {
-				// try to patch the url
-				try {
-					url = new URL(&quot;file:&quot; + strURL);
-				} catch(MalformedURLException ex) {
-					throw new IOException(&quot;Wrong URL of file specified: &quot; + ex.getMessage());
-				}
-			}
+		    url = FileUtils.getFileURL(contextURL, strURL); 
 			os = url.openConnection().getOutputStream();
 		}
 		//resolve url format for zip files

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileReader.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileReader.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileReader.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -20,6 +20,7 @@
 package org.jetel.util;
 
 import java.io.IOException;
+import java.net.URL;
 import java.nio.channels.ReadableByteChannel;
 import java.util.Iterator;
 
@@ -53,6 +54,7 @@
     private Log logger = defaultLogger;
 
 	private Parser parser;
+    private URL contextURL;
     private String fileURL;
 	private Iterator&lt;String&gt; filenameItor;
     private int skip;
@@ -67,8 +69,9 @@
 	 * @param parser Parser to be used to obtain records from input files.
 	 * @param fileURL Specification of input file(s)
 	 */
-	public MultiFileReader(Parser parser, String fileURL) {
+	public MultiFileReader(Parser parser, URL contextURL, String fileURL) {
 		this.parser = parser;
+        this.contextURL = contextURL;
 		this.fileURL = fileURL;
 	}
 
@@ -131,7 +134,7 @@
 			filename = filenameItor.next();
 			logger.debug(&quot;Opening input file &quot; + filename);
 			try {
-				stream = FileUtils.getReadableChannel(filename);
+				stream = FileUtils.getReadableChannel(contextURL, filename);
 				logger.debug(&quot;Reading input file &quot; + filename);
 				parser.setDataSource(stream);
 				if(fileSkip &gt; 0) parser.skip(fileSkip);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileWriter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileWriter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/MultiFileWriter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -22,6 +22,7 @@
 import java.io.FileNotFoundException;
 import java.io.IOException;
 import java.io.UnsupportedEncodingException;
+import java.net.URL;
 import java.nio.ByteBuffer;
 import java.nio.channels.WritableByteChannel;
 import java.util.Iterator;
@@ -55,7 +56,7 @@
     private Log logger = defaultLogger;
 
     private Formatter formatter;
-    private DataRecordMetadata metadata;
+    private URL contextURL;
     private String fileURL;
     private String charset;
     private int recordsPerFile;
@@ -73,8 +74,9 @@
      * @param formatter formatter is used for incoming records formatting
      * @param fileURL target file(s) definition
      */
-    public MultiFileWriter(Formatter formatter, String fileURL) {
+    public MultiFileWriter(Formatter formatter, URL contextURL, String fileURL) {
         this.formatter = formatter;
+        this.contextURL = contextURL;
         this.fileURL = fileURL;
     }
     
@@ -84,7 +86,6 @@
      * @throws ComponentNotReadyException 
      */
     public void init(DataRecordMetadata metadata) throws ComponentNotReadyException {
-        this.metadata = metadata;
         fileNames = new MultiOutFile(fileURL);
         formatter.init(metadata);
         try {
@@ -109,7 +110,7 @@
         if(byteChannel != null) {
             writeFooter();
         }
-        byteChannel = FileUtils.getWritableChannel(fileNames.next(), appendData);
+        byteChannel = FileUtils.getWritableChannel(contextURL, fileNames.next(), appendData);
         //write header
         writeHeader();
         formatter.setDataTarget(byteChannel);

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/StringUtils.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/StringUtils.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/src/org/jetel/util/StringUtils.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -46,7 +46,7 @@
 	 *      text representation (i.e.\n -&gt; &quot;\n&quot; )
 	 * @since                 July 25, 2002
 	 */
-	public static String specCharToString(String controlString) {
+	public static String specCharToString(CharSequence controlString) {
 		StringBuffer copy = new StringBuffer();
 		char character;
 		for (int i = 0; i &lt; controlString.length(); i++) {
@@ -83,8 +83,8 @@
 	 * @return                String with control characters
 	 * @since                 July 25, 2002
 	 */
-	public static String stringToSpecChar(String controlString) {
-		if(controlString == null) {
+	public static String stringToSpecChar(CharSequence controlString) {
+		if(isEmpty(controlString)) {
 			return null;
 		}
 		StringBuffer copy = new StringBuffer();
@@ -429,7 +429,7 @@
 		return stringArraytoString(strings,' ');
 	} 
   
-    public static boolean isEmpty(String s) {
+    public static boolean isEmpty(CharSequence s) {
         return s == null || s.length() == 0;
     }
 

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DataTestSuite.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DataTestSuite.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DataTestSuite.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -38,7 +38,6 @@
 		suite.addTest(new TestSuite(org.jetel.data.NumericDataFieldTest.class));
 		suite.addTest(new TestSuite(org.jetel.data.StringDataFieldTest.class));
 		suite.addTest(new TestSuite(org.jetel.data.FixLenDataParser2Test.class));
-		suite.addTest(new TestSuite(org.jetel.data.OneRecordPerLinePolicyTest.class));
 		suite.addTest(new TestSuite(org.jetel.data.FixLenDataFormatterTest.class));
 		return suite;
 	

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DateDataFieldTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DateDataFieldTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/DateDataFieldTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -57,7 +57,7 @@
 
 	calendar = new GregorianCalendar(2002,6,10);
 	trialTime1 = null;
-	trialTime1 = calendar.getTime(); 
+//	trialTime1 = calendar.getTime(); 
 	DataFieldMetadata delimFieldMeta1 = new DataFieldMetadata(&quot;Field1&quot;,'D',&quot;;&quot;);
 	delimFieldMeta1.setFormatStr(&quot;MM/dd/yyyy&quot;);
 	delimFieldMeta1.setDefaultValueStr(&quot;03/31/2100&quot;);
@@ -231,6 +231,11 @@
 		trialTime2 = calendar2.getTime(); 
 		aDateDataField4.setValue(trialTime2);
 		assertFalse(aDateDataField1.equals(aDateDataField4));
+		
+		assertTrue(aDateDataField3.isNull());
+		aDateDataField3.setToDefaultValue();
+		assertFalse(aDateDataField3.isNull());
+		assertEquals(new GregorianCalendar(2100,02,31).getTime(), aDateDataField3.getValue());
 	}
 
 	/**

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/IntegerDataFieldTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/IntegerDataFieldTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/IntegerDataFieldTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -165,7 +165,14 @@
 		try {
 			anIntegerDataField1.fromString(&quot;123.234&quot;);
 			fail(&quot;Should raise an BadDataFormatException&quot;);
-		} catch (BadDataFormatException e){	}
+		} catch (BadDataFormatException e){
+		}
+
+		try {
+			anIntegerDataField1.fromString(&quot;r123&quot;);
+			fail(&quot;Should raise an BadDataFormatException&quot;);
+		} catch (BadDataFormatException e){
+		}
 	}
 	
 	

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/NumericDataFieldTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/NumericDataFieldTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/NumericDataFieldTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -149,8 +149,8 @@
 	 *
 	 */
 	public void test_fromString() {
-		aNumericDataField1.fromString(&quot;123&quot;);
-		assertEquals(aNumericDataField1.getInt(),123);
+		aNumericDataField1.fromString(&quot;123.43&quot;);
+		assertEquals(aNumericDataField1.getDouble(),123.43);
 	
 		
 		aNumericDataField1.fromString(null);
@@ -167,7 +167,8 @@
 		} catch (BadDataFormatException e){	}
 	
 		try {
-			aNumericDataField1.fromString(&quot;r123.43&quot;);
+			aNumericDataField1.fromString(&quot;r123&quot;);
+			System.out.println(aNumericDataField1.getDouble());
 			fail(&quot;Should raise an BadDataFormatException&quot;);
 		} catch (BadDataFormatException e){	}
 	}

Deleted: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/OneRecordPerLinePolicyTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/OneRecordPerLinePolicyTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/OneRecordPerLinePolicyTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,195 +0,0 @@
-/*
- *  jETeL/Clover - Java based ETL application framework.
- *  Created on May 6, 2003
- *  Copyright (C) 2003, 2002  David Pavlis, Wes Maciorowski
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-
-package org.jetel.data;
-
-import java.io.BufferedReader;
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.FileNotFoundException;
-import java.io.FileOutputStream;
-import java.io.IOException;
-
-import java.nio.channels.Channels;
-import org.jetel.data.DataRecord;
-import org.jetel.data.formatter.FixLenDataFormatter;
-import org.jetel.data.parser.SQLDataParser;
-import org.jetel.data.Defaults;
-
-import org.jetel.database.DBConnection;
-import org.jetel.exception.BadDataFormatException;
-import org.jetel.exception.ComponentNotReadyException;
-import org.jetel.metadata.DataRecordMetadata;
-import org.jetel.metadata.DataRecordMetadataXMLReaderWriter;
-
-import junit.framework.TestCase;
-
-/**
- * @author maciorowski
- *
- */
-public class OneRecordPerLinePolicyTest  extends TestCase {
-private SQLDataParser aParser2 = null;
-private FixLenDataFormatter aFixLenDataFormatter= null;
-private DataRecord record;
-private String testFile1 = null;	
-
-protected void setUp() { 
-	DataRecordMetadata metadata = null;
-	DataRecordMetadataXMLReaderWriter xmlReader = new DataRecordMetadataXMLReaderWriter();
-	DBConnection aDBConnection = null;
-
-	testFile1 = &quot;data\\out\\test1.txt&quot;;	
-	File aFile=new File(testFile1);
-	 if(!aFile.exists()) {
-		new File(aFile.getParent()).mkdirs();
-		try {
-			aFile.createNewFile();
-		} catch (IOException e3) {
-			e3.printStackTrace();
-		}
-	 }
-				
-	try {
-		metadata = xmlReader.read(new FileInputStream(&quot;config\\test\\rec_def\\db_null_def_rec.xml&quot;));
-		aDBConnection = new DBConnection(&quot;&quot;, &quot;config\\test\\msaccess.clover_test.txt&quot;);
-	} catch(FileNotFoundException e){
-		e.printStackTrace();
-	}
-
-	record = new DataRecord(metadata);
-	record.init();
-	
-	aParser2 = new SQLDataParser(&quot;connection&quot;,&quot;SELECT * FROM bad&quot;);
-	try {
-		aParser2.open(aDBConnection,metadata);
-		aParser2.initSQLDataMap(record);
-	} catch (ComponentNotReadyException e1) {
-		e1.printStackTrace();
-	}
-	aFixLenDataFormatter = new FixLenDataFormatter();
-	try {
-		aFixLenDataFormatter.open(new FileOutputStream(testFile1),metadata);
-	} catch (FileNotFoundException e2) {
-		e2.printStackTrace();
-	}
-}
-	
-   protected void tearDown() {
-	   aParser2.close();
-	   aParser2 = null;
-	   record  = null;
-		aFixLenDataFormatter = null;
-	   //remove testFile if any
-	   File aFile=new File(testFile1);
-		if(aFile.exists()) {
-			aFile.delete();
-		}
-   }
-
-public void test_FixLenDataFormatter_false() {
-	int recCount = 0;
-	try{
-		while((record=aParser2.getNext(record))!=null){
-			aFixLenDataFormatter.write(record);
-		}
-		aFixLenDataFormatter.flush();
-		aFixLenDataFormatter.close();
-	} catch (BadDataFormatException e){	
-		fail(&quot;Should not raise an BadDataFormatException&quot;);
-		e.printStackTrace();
-	} catch (Exception ee){
-		fail(&quot;Should not throw Exception&quot;);
-		ee.printStackTrace();
-	}
-	
-	try {
-		FileInputStream fis = new FileInputStream(testFile1);
-		BufferedReader reader = null;
-		reader = new BufferedReader(Channels.newReader( (fis).getChannel(), Defaults.DataParser.DEFAULT_CHARSET_DECODER ) );
-
-		String line = null;
-		line = reader.readLine();
-		while(line != null ) {	//skip blank lines
-			recCount++;
-			line = reader.readLine();
-		}
-
-		if((line) == null) {  //end of file been reached
-			reader.close();
-		}
-
-	} catch (FileNotFoundException e1) {
-		fail(&quot;Should not throw Exception - missing test data file&quot;);
-		e1.printStackTrace();
-	} catch (IOException e) {
-		fail(&quot;Should not throw Exception - IOException&quot;);
-		e.printStackTrace();
-	}
-	//should have only one line
-   assertEquals(1,recCount);
-}
-
-public void test_FixLenDataFormatter_true() {
-	int recCount = 0;
-	
-	aFixLenDataFormatter.setOneRecordPerLinePolicy(true);
-	try{
-		while((record=aParser2.getNext(record))!=null){
-			aFixLenDataFormatter.write(record);
-		}
-		aFixLenDataFormatter.flush();
-		aFixLenDataFormatter.close();
-	} catch (BadDataFormatException e){	
-		fail(&quot;Should not raise an BadDataFormatException&quot;);
-		e.printStackTrace();
-	} catch (Exception ee){
-		fail(&quot;Should not throw Exception&quot;);
-		ee.printStackTrace();
-	}
-	
-	try {
-		FileInputStream fis = new FileInputStream(testFile1);
-		BufferedReader reader = null;
-		reader = new BufferedReader(Channels.newReader( (fis).getChannel(), Defaults.DataParser.DEFAULT_CHARSET_DECODER ) );
-
-		String line = null;
-		line = reader.readLine();
-		while(line != null ) {	//skip blank lines
-			recCount++;
-			line = reader.readLine();
-		}
-
-		if((line) == null) {  //end of file been reached
-			reader.close();
-		}
-
-	} catch (FileNotFoundException e1) {
-		fail(&quot;Should not throw Exception - missing test data file&quot;);
-		e1.printStackTrace();
-	} catch (IOException e) {
-		fail(&quot;Should not throw Exception - IOException&quot;);
-		e.printStackTrace();
-	}
-	//should have 3 lines; one line for each record
-   assertEquals(3,recCount);
-}
-	
-
-}

Deleted: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/SQLDataParserTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/SQLDataParserTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/SQLDataParserTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,110 +0,0 @@
-/*
- *  jETeL/Clover - Java based ETL application framework.
- *  Created on Apr 28, 2003
- *  Copyright (C) 2003, 2002  David Pavlis, Wes Maciorowski
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-
-package org.jetel.data;
-
-import java.io.FileInputStream;
-import java.io.FileNotFoundException;
-
-import org.jetel.data.DataRecord;
-import org.jetel.data.parser.SQLDataParser;
-import org.jetel.database.DBConnection;
-import org.jetel.exception.BadDataFormatException;
-import org.jetel.exception.ComponentNotReadyException;
-import org.jetel.metadata.DataRecordMetadata;
-import org.jetel.metadata.DataRecordMetadataXMLReaderWriter;
-
-import junit.framework.TestCase;
-
-/**
- * @author maciorowski
- *
- */
-public class SQLDataParserTest  extends TestCase {
-private SQLDataParser aParser2 = null;
-private DataRecord record;
-	
-protected void setUp() { 
-	DataRecordMetadata metadata = null;
-	DataRecordMetadataXMLReaderWriter xmlReader = new DataRecordMetadataXMLReaderWriter();
-	DBConnection aDBConnection = null;
-				
-	try {
-		metadata = xmlReader.read(new FileInputStream(&quot;config\\test\\rec_def\\db_null_def_rec.xml&quot;));
-		aDBConnection = new DBConnection(&quot;&quot;, &quot;config\\test\\msaccess.clover_test.txt&quot;);
-	} catch(FileNotFoundException e){
-		e.printStackTrace();
-	}
-	
-	record = new DataRecord(metadata);
-	record.init();
-
-	aParser2 = new SQLDataParser(&quot;connection&quot;,&quot;SELECT * FROM bad&quot;);
-	try {
-		aParser2.open(aDBConnection,metadata);
-		aParser2.initSQLDataMap(record);
-	} catch (ComponentNotReadyException e1) {
-		e1.printStackTrace();
-	}
-}
-	
-   protected void tearDown() {
-	   aParser2.close();
-	   aParser2 = null;
-	   record  = null;
-   }
-
-public void test_parsing() {
-// the content of the test file
-//	  N/AStone          01/11/93
-//	-15.5          112  11/03/02
-//	 -0.7Bone Broo    99        
-	int recCount = 0;
-	try{
-		while((record=aParser2.getNext(record))!=null){
-			if(recCount==0) {
-				assertEquals(record.getField(0).toString(),&quot;1.0&quot;);
-				assertTrue(record.getField(1).isNull());
-				assertEquals(record.getField(2).toString(),&quot;101&quot;);
-				assertEquals(record.getField(3).toString(),&quot;1993-01-11 00:00:00&quot;);
-			} else if(recCount==1) {
-				assertEquals(record.getField(0).toString(),&quot;-15.5&quot;);
-				assertTrue(record.getField(3).isNull());
-				assertEquals(record.getField(2).toString(),&quot;112&quot;);
-				assertEquals(record.getField(1).toString(),&quot;Brook&quot;);
-			} else if(recCount==2) {
-				assertTrue(record.getField(0).isNull());
-				assertEquals(record.getField(1).toString(),&quot;Bone Broo&quot;);
-				assertTrue(record.getField(2).isNull());
-				assertEquals(record.getField(3).toString(),&quot;2003-01-01 00:00:00&quot;);
-			}
-			recCount++;
-		}
-	} catch (BadDataFormatException e){	
-		fail(&quot;Should not raise an BadDataFormatException&quot;);
-		e.printStackTrace();
-	} catch (Exception ee){
-		fail(&quot;Should not throw Exception&quot;);
-		ee.printStackTrace();
-	}
-   assertEquals(3,recCount);
-}
-	
-
-}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/primitive/DecimalNumericTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/primitive/DecimalNumericTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/data/primitive/DecimalNumericTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -151,7 +151,9 @@
 			}else{
 				System.out.println(&quot;Test for getInt skipped&quot;);
 			}
-			if (!aFloat.isNaN()) assertEquals(new Double(value),new Double(aFloat.getDouble()));
+			if (!aFloat.isNaN()) {
+				assertEquals(new Double(value),new Double(aFloat.getDouble()));
+			}
 			System.out.println(&quot;Test for getDouble passed (isNaN=&quot;+anInt.isNaN()+&quot;)&quot;);
 			if (Long.MIN_VALUE&lt;value &amp;&amp; value&lt;Long.MAX_VALUE) {
 				assertEquals(new Float(value).longValue(),aFloat.getLong());
@@ -263,7 +265,9 @@
 			}else{
 				System.out.println(&quot;Test for getInt skipped&quot;);
 			}
-			if (!aDefault.isNaN()) assertEquals(new Double(d_value),new Double(aDefault.getDouble()));
+			if (!aDefault.isNaN()) {
+				assertEquals(new Double(d_value),new Double(aDefault.getDouble()));
+			}
 			System.out.println(&quot;Test for getDouble passed (isNaN=&quot;+anInt.isNaN()+&quot;)&quot;);
 			if (Long.MIN_VALUE&lt;value &amp;&amp; value&lt;Long.MAX_VALUE) {
 				assertEquals(new Double(d_value).longValue(),aDefault.getLong());
@@ -482,7 +486,7 @@
 
 	public void test_fromString(){
 		aDouble.fromString(&quot;123.45&quot;,null);
-		assertEquals(new Double(123.45),new Double(aDouble.getDouble()));
+		assertEquals(new Double(123),new Double(aDouble.getDouble()));
 		aDouble=DecimalFactory.getDecimal(10,5);
 		aDouble.fromString(&quot;.12345&quot;,null);
 		assertEquals(new Double(0.12345),new Double(aDouble.getDouble()));

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_DelimitedDataParserNIO_Test.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_DelimitedDataParserNIO_Test.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_DelimitedDataParserNIO_Test.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -25,10 +25,9 @@
 import junit.framework.TestCase;
 
 import org.jetel.data.DataRecord;
-import org.jetel.data.parser.DelimitedDataParserNIO;
+import org.jetel.data.Defaults;
+import org.jetel.data.parser.DelimitedDataParser;
 import org.jetel.exception.BadDataFormatException;
-import org.jetel.exception.BadDataFormatExceptionHandler;
-import org.jetel.exception.BadDataFormatExceptionHandlerFactory;
 import org.jetel.metadata.DataRecordMetadata;
 import org.jetel.metadata.DataRecordMetadataXMLReaderWriter;
 
@@ -37,8 +36,8 @@
  *
  */
 public class BadDataFormatExceptionHandler_DelimitedDataParserNIO_Test  extends TestCase {
-	private DelimitedDataParserNIO aParser = null;
-	private DelimitedDataParserNIO aParser2 = null;
+	private DelimitedDataParser aParser = null;
+	private DelimitedDataParser aParser2 = null;
 	private DataRecord record;
 	private FileInputStream in = null;
 	private FileInputStream in2 = null;
@@ -48,16 +47,18 @@
 		DataRecordMetadataXMLReaderWriter xmlReader = new DataRecordMetadataXMLReaderWriter();
 			
 		try {
-			metadata = xmlReader.read(new FileInputStream(&quot;config\\test\\rec_def\\DL_null_def_rec.xml&quot;));
-			in = new FileInputStream(&quot;data\\in\\good\\DL28_NL.txt&quot;);
-			in2 = new FileInputStream(&quot;data\\in\\bad\\DL_NL_nulls.txt&quot;);
+			metadata = xmlReader.read(new FileInputStream(&quot;config/test/rec_def/DL_null_def_rec.xml&quot;));
+			in = new FileInputStream(&quot;data/in/good/DL28_NL.txt&quot;);
+			in2 = new FileInputStream(&quot;data/in/bad/DL_NL_nulls.txt&quot;);
 		} catch(FileNotFoundException e){
 			e.printStackTrace();
 		}
+		
+		Defaults.init();
 	
-		aParser2 = new DelimitedDataParserNIO();
+		aParser2 = new DelimitedDataParser();
 
-		aParser = new DelimitedDataParserNIO();
+		aParser = new DelimitedDataParser();
 		record = new DataRecord(metadata);
 		record.init();
 	}
@@ -81,10 +82,14 @@
 	 */
 	
 	public void test_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		AbstractParserExceptionHandler aHandler = null;
 
 		// test no handler ------------------------------------
-		aParser.open(in,metadata);
+		try {
+			aParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser.setDataSource(in);
 		try{
 			while((record=aParser.getNext(record))!=null){}
 		} catch (BadDataFormatException e){	
@@ -104,11 +109,15 @@
 	 */
 	
 	public void test_strict_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test strict handler ------------------------------------
-		aParser.open(in,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.STRICT);
-		aParser.addBDFHandler(aHandler);
+		try {
+			aParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser.setDataSource(in);
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.STRICT);
+		aParser.setExceptionHandler(aHandler);
 		try{
 			while((record=aParser.getNext(record))!=null){}
 		} catch (BadDataFormatException e){	
@@ -128,11 +137,16 @@
 	 */
 	
 	public void test_controlled_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test controlled handler ------------------------------------
-		aParser.open(in,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.CONTROLLED);
-		aParser.addBDFHandler(aHandler);
+		try {
+			aParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser.setDataSource(in);
+
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.CONTROLLED);
+		aParser.setExceptionHandler(aHandler);
 		
 //		1.0Stone    101   01/11/93
 //	  -15.5  Brook   112  11/03/02
@@ -177,11 +191,16 @@
 	 */
 	
 	public void test_lenient_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test lenient handler ------------------------------------
-		aParser.open(in,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.LENIENT);
-		aParser.addBDFHandler(aHandler);
+		try {
+			aParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser.setDataSource(in);
+
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.LENIENT);
+		aParser.setExceptionHandler(aHandler);
 		
 //		1.0Stone    101   01/11/93
 //	  -15.5  Brook   112  11/03/02
@@ -224,10 +243,14 @@
 	 */
 	
 	public void test_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		boolean failed = false;
 		// test no handler ------------------------------------
-		aParser2.open(in2,metadata);
+		try {
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser2.setDataSource(in2);
 		try{
 			while((record=aParser2.getNext(record))!=null){
 				fail(&quot;Should throw Exception&quot;);
@@ -252,12 +275,16 @@
 	 */
 	
 	public void test_strict_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 
 		// test strict handler ------------------------------------
-		aParser2.open(in2,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.STRICT);
-		aParser2.addBDFHandler(aHandler);
+		try {
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser2.setDataSource(in2);
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.STRICT);
+		aParser2.setExceptionHandler(aHandler);
 		int recCount = 0;
 		try{
 			while((record=aParser2.getNext(record))!=null){
@@ -280,12 +307,16 @@
 	 */
 	
 	public void test_controlled_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 
 		// test controlled handler ------------------------------------
-		aParser2.open(in2,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.CONTROLLED);
-		aParser2.addBDFHandler(aHandler);
+		try {
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser2.setDataSource(in2);
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.CONTROLLED);
+		aParser2.setExceptionHandler(aHandler);
 		int recCount = 0;
 		try{
 			while((record=aParser2.getNext(record))!=null){
@@ -298,7 +329,7 @@
 			fail(&quot;Should not throw Exception&quot;);
 			ee.printStackTrace();
 		}
-		assertEquals(2,recCount);  //may need to be revised
+		assertEquals(3,recCount);  //may need to be revised
 		//depending how we implement nullable property
 		aParser2.close();
 
@@ -311,11 +342,15 @@
 	 */
 	
 	public void test_lenient_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test lenient handler ------------------------------------
-		aParser2.open(in2,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.LENIENT);
-		aParser2.addBDFHandler(aHandler);
+		try {
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser2.setDataSource(in2);
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.CONTROLLED);
+		aParser2.setExceptionHandler(aHandler);
 		int recCount = 0;
 		
 // the content of the test file

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_FixLenDataParser2_Test.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_FixLenDataParser2_Test.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_FixLenDataParser2_Test.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -19,14 +19,15 @@
 
 package org.jetel.exception;
 
+import java.io.ByteArrayInputStream;
 import java.io.FileInputStream;
 import java.io.FileNotFoundException;
 
 import org.jetel.data.DataRecord;
-import org.jetel.data.parser.FixLenDataParser2;
+import org.jetel.data.Defaults;
+import org.jetel.data.parser.FixLenCharDataParser;
+import org.jetel.data.parser.FixLenDataParser;
 import org.jetel.exception.BadDataFormatException;
-import org.jetel.exception.BadDataFormatExceptionHandler;
-import org.jetel.exception.BadDataFormatExceptionHandlerFactory;
 import org.jetel.metadata.DataRecordMetadata;
 import org.jetel.metadata.DataRecordMetadataXMLReaderWriter;
 
@@ -37,8 +38,8 @@
  *
  */
 public class BadDataFormatExceptionHandler_FixLenDataParser2_Test extends TestCase {
-	private FixLenDataParser2 aFixLenDataParser2 = null;
-	private FixLenDataParser2 aParser2 = null;
+	private FixLenDataParser aFixLenDataParser = null;
+	private FixLenDataParser aParser2 = null;
 	private DataRecord record;
 	private FileInputStream in = null;
 	private FileInputStream in2 = null;
@@ -48,24 +49,26 @@
 		DataRecordMetadataXMLReaderWriter xmlReader = new DataRecordMetadataXMLReaderWriter();
 			
 		try {
-			//metadata = xmlReader.read(new FileInputStream(&quot;config\\test\\rec_def\\FL28_rec.xml&quot;));
-			metadata = xmlReader.read(new FileInputStream(&quot;config\\test\\rec_def\\FL28_null_def_rec.xml&quot;));
-			in = new FileInputStream(&quot;data\\in\\good\\FL28_NL.txt&quot;);
-			in2 = new FileInputStream(&quot;data\\in\\bad\\FL28_NL_nulls.txt&quot;);
+			//metadata = xmlReader.read(new FileInputStream(&quot;config/test/rec_def/FL28_rec.xml&quot;));
+			metadata = xmlReader.read(new FileInputStream(&quot;config/test/rec_def/FL28_null_def_rec.xml&quot;));
+			in = new FileInputStream(&quot;data/in/good/FL28_NL.txt&quot;);
+			in2 = new FileInputStream(&quot;data/in/bad/FL28_NL_nulls.txt&quot;);
 		} catch(FileNotFoundException e){
 			e.printStackTrace();
 		}
+		
+		Defaults.init();
 	
-		aParser2 = new FixLenDataParser2();
+		aParser2 = new FixLenCharDataParser();
 
-		aFixLenDataParser2 = new FixLenDataParser2();
+		aFixLenDataParser = new FixLenCharDataParser();
 		record = new DataRecord(metadata);
 		record.init();
 	}
 	
 	protected void tearDown() {
-		aFixLenDataParser2.close();
-		aFixLenDataParser2 = null;
+		aFixLenDataParser.close();
+		aFixLenDataParser = null;
 
 		aParser2.close();
 		aParser2 = null;
@@ -82,20 +85,24 @@
 	 */
 	
 	public void test_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 
 		// test no handler ------------------------------------
-		aFixLenDataParser2.open(in,metadata);
+		try {
+			aFixLenDataParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aFixLenDataParser.setDataSource(in);
 		try{
-			while((record=aFixLenDataParser2.getNext(record))!=null){}
+			while((record=aFixLenDataParser.getNext(record))!=null){}
 		} catch (BadDataFormatException e){	
 			fail(&quot;Should not raise an BadDataFormatException&quot;);
 			e.printStackTrace();
 		} catch (Exception ee){
+			ee.printStackTrace();
 			fail(&quot;Should not throw Exception&quot;);
-			ee.printStackTrace();
 		}
-		aFixLenDataParser2.close();
+		aFixLenDataParser.close();
 
 	}
 	
@@ -105,13 +112,18 @@
 	 */
 	
 	public void test_strict_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test strict handler ------------------------------------
-		aFixLenDataParser2.open(in,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.STRICT);
-		aFixLenDataParser2.addBDFHandler(aHandler);
+				try {
+			aFixLenDataParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aFixLenDataParser.setDataSource(in);
+
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.STRICT);
+		aFixLenDataParser.setExceptionHandler(aHandler);
 		try{
-			while((record=aFixLenDataParser2.getNext(record))!=null){}
+			while((record=aFixLenDataParser.getNext(record))!=null){}
 		} catch (BadDataFormatException e){	
 			fail(&quot;Should not raise an BadDataFormatException&quot;);
 			e.printStackTrace();
@@ -119,7 +131,7 @@
 			fail(&quot;Should not throw Exception&quot;);
 			ee.printStackTrace();
 		}
-		aFixLenDataParser2.close();
+		aFixLenDataParser.close();
 		 
 	}
 	
@@ -129,18 +141,26 @@
 	 */
 	
 	public void test_controlled_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test controlled handler ------------------------------------
-		aFixLenDataParser2.open(in,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.CONTROLLED);
-		aFixLenDataParser2.addBDFHandler(aHandler);
+				try {
+			aFixLenDataParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aFixLenDataParser.setDataSource(new ByteArrayInputStream(new String(&quot;&quot; +
+				&quot;		1.0Stone    101   01/11/93&quot; +
+				&quot;-15.5Brook    112   11/03/02&quot; +
+				&quot;	-0.7Bone Broo99    01/01/03&quot;).getBytes()));
+
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.CONTROLLED);
+		aFixLenDataParser.setExceptionHandler(aHandler);
 		
 //		1.0Stone    101   01/11/93
-//	  -15.5  Brook   112  11/03/02
+//	  -15.5Brook   11211/03/02
 //	   -0.7Bone Broo    9901/01/03
 		int recCount = 0;
 		try{
-			while((record=aFixLenDataParser2.getNext(record))!=null){
+			while((record=aFixLenDataParser.getNext(record))!=null){
 				if(recCount==0) {
 					assertEquals(record.getField(0).toString(),&quot;1.0&quot;);
 					assertEquals(record.getField(1).toString(),&quot;Stone&quot;);
@@ -162,13 +182,13 @@
 			assertEquals(3,recCount);		
 			
 		} catch (BadDataFormatException e){	
+			e.printStackTrace();
 			fail(&quot;Should not raise an BadDataFormatException&quot;);
-			e.printStackTrace();
 		} catch (Exception ee){
 			fail(&quot;Should not throw Exception&quot;);
 			ee.printStackTrace();
 		}
-		aFixLenDataParser2.close();
+		aFixLenDataParser.close();
 
 	}
 	
@@ -178,18 +198,26 @@
 	 */
 	
 	public void test_lenient_goodFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test lenient handler ------------------------------------
-		aFixLenDataParser2.open(in,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.LENIENT);
-		aFixLenDataParser2.addBDFHandler(aHandler);
+				try {
+			aFixLenDataParser.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aFixLenDataParser.setDataSource(new ByteArrayInputStream(new String(
+				&quot;		1.0Stone    101   01/11/93&quot; +
+				&quot;-15.5Brook    112   11/03/02&quot; +
+				&quot;	-0.7Bone Broo    9901/01/03&quot;).getBytes()));
+
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.LENIENT);
+		aFixLenDataParser.setExceptionHandler(aHandler);
 		
 //		1.0Stone    101   01/11/93
 //	  -15.5  Brook   112  11/03/02
 //	   -0.7Bone Broo    9901/01/03
  		int recCount = 0;
 		try{
-			while((record=aFixLenDataParser2.getNext(record))!=null){
+			while((record=aFixLenDataParser.getNext(record))!=null){
 				if(recCount==0) {
 					assertEquals(record.getField(0).toString(),&quot;1.0&quot;);
 					assertEquals(record.getField(1).toString(),&quot;Stone&quot;);
@@ -225,11 +253,15 @@
 	 */
 	
 	public void test_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		boolean failed = false;
 		// test no handler ------------------------------------
-		aParser2.open(in2,metadata);
 		try{
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+	aParser2.setDataSource(in2);
+		try{
 			while((record=aParser2.getNext(record))!=null){
 				fail(&quot;Should throw Exception&quot;);
 			}
@@ -253,12 +285,16 @@
 	 */
 	
 	public void test_strict_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 
 		// test strict handler ------------------------------------
-		aParser2.open(in2,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.STRICT);
-		aParser2.addBDFHandler(aHandler);
+		try{
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser2.setDataSource(in2);
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.STRICT);
+		aParser2.setExceptionHandler(aHandler);
 		int recCount = 0;
 		try{
 			while((record=aParser2.getNext(record))!=null){
@@ -281,12 +317,16 @@
 	 */
 	
 	public void test_controlled_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 
 		// test controlled handler ------------------------------------
-		aParser2.open(in2,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.CONTROLLED);
-		aParser2.addBDFHandler(aHandler);
+		try {
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser2.setDataSource(in2);
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.CONTROLLED);
+		aParser2.setExceptionHandler(aHandler);
 		int recCount = 0;
 		try{
 			while((record=aParser2.getNext(record))!=null){
@@ -299,7 +339,7 @@
 			fail(&quot;Should not throw Exception&quot;);
 			ee.printStackTrace();
 		}
-		assertEquals(2,recCount);  //may need to be revised
+		assertEquals(3,recCount);  //may need to be revised
 		//depending how we implement nullable property
 		aParser2.close();
 
@@ -312,11 +352,15 @@
 	 */
 	
 	public void test_lenient_badFile() {
-		BadDataFormatExceptionHandler aHandler = null;
+		IParserExceptionHandler aHandler = null;
 		// test lenient handler ------------------------------------
-		aParser2.open(in2,metadata);
-		aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.LENIENT);
-		aParser2.addBDFHandler(aHandler);
+		try {
+			aParser2.init(metadata);
+		} catch (ComponentNotReadyException e1) {
+		}
+		aParser2.setDataSource(in2);
+		aHandler = ParserExceptionHandlerFactory.getHandler(PolicyType.LENIENT);
+		aParser2.setExceptionHandler(aHandler);
 		int recCount = 0;
 		
 // the content of the test file

Deleted: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_SQLDataParser_Test.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_SQLDataParser_Test.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/BadDataFormatExceptionHandler_SQLDataParser_Test.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,332 +0,0 @@
-/*
- *  jETeL/Clover - Java based ETL application framework.
- *  Created on Apr 28, 2003
- *  Copyright (C) 2003, 2002  David Pavlis, Wes Maciorowski
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-
-package org.jetel.exception;
-
-import java.io.FileInputStream;
-import java.io.FileNotFoundException;
-
-import org.jetel.data.DataRecord;
-import org.jetel.data.parser.SQLDataParser;
-import org.jetel.database.DBConnection;
-import org.jetel.exception.BadDataFormatException;
-import org.jetel.exception.BadDataFormatExceptionHandler;
-import org.jetel.exception.BadDataFormatExceptionHandlerFactory;
-import org.jetel.exception.ComponentNotReadyException;
-import org.jetel.metadata.DataRecordMetadata;
-import org.jetel.metadata.DataRecordMetadataXMLReaderWriter;
-
-import junit.framework.TestCase;
-
-/**
- * @author maciorowski
- *
- */
-public class BadDataFormatExceptionHandler_SQLDataParser_Test  extends TestCase {
- private SQLDataParser aParser1 = null;
- private SQLDataParser aParser2 = null;
- private DataRecord record;
- private DataRecordMetadata metadata = null;
-	
- protected void setUp() { 
-	DBConnection aDBConnection = null;
-	 DataRecordMetadataXMLReaderWriter xmlReader = new DataRecordMetadataXMLReaderWriter();
-			
-	 try {
-		metadata = xmlReader.read(new FileInputStream(&quot;config\\test\\rec_def\\db_def_rec.xml&quot;));
-		aDBConnection = new DBConnection(&quot;&quot;, &quot;config\\test\\msaccess.clover_test.txt&quot;);
-	 } catch(FileNotFoundException e){
-		 e.printStackTrace();
-	 }
-	
-	aParser2 = new SQLDataParser(&quot;connection&quot;,&quot;SELECT * FROM bad&quot;);
-
-	aParser1 = new SQLDataParser(&quot;connection&quot;,&quot;SELECT * FROM good&quot;);
-	try {
-		aParser1.open(aDBConnection,metadata);
-		aParser2.open(aDBConnection,metadata);
-	} catch (ComponentNotReadyException e1) {
-		e1.printStackTrace();
-	}
-	 record = new DataRecord(metadata);
-	 record.init();
-	 aParser1.initSQLDataMap(record);
-	 aParser2.initSQLDataMap(record);
- }
-	
- protected void tearDown() {
-	 aParser1.close();
-	 aParser1 = null;
-
-	 aParser2.close();
-	 aParser2 = null;
-	 record  = null;
-		
-	 metadata = null;
- }
-	
- /**
-  *  Test for @link for a well formatted data source.
-  *  No handler
-  */
-	
- public void test_goodFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-
-	 // test no handler ------------------------------------
-	 try{
-		 while((record=aParser1.getNext(record))!=null){}
-	 } catch (BadDataFormatException e){	
-		 fail(&quot;Should not raise an BadDataFormatException&quot;);
-		 e.printStackTrace();
-	 } catch (Exception ee){
-		 fail(&quot;Should not throw Exception&quot;);
-		 ee.printStackTrace();
-	 }
-
- }
-	
- /**
-  *  Test for @link for a well formatted data source.
-  *  strict handler
-  */
-	
- public void test_strict_goodFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-	 // test strict handler ------------------------------------
-	 aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.STRICT);
-	 aParser1.addBDFHandler(aHandler);
-	 try{
-		 while((record=aParser1.getNext(record))!=null){}
-	 } catch (BadDataFormatException e){	
-		 fail(&quot;Should not raise an BadDataFormatException&quot;);
-		 e.printStackTrace();
-	 } catch (Exception ee){
-		 fail(&quot;Should not throw Exception&quot;);
-		 ee.printStackTrace();
-	 }
-		 
- }
-	
- /**
-  *  Test for @link for a well formatted data source.
-  *  controlled handler
-  */
-	
- public void test_controlled_goodFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-	 // test controlled handler ------------------------------------
-	 aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.CONTROLLED);
-	 aParser1.addBDFHandler(aHandler);
-		
-	 int recCount = 0;
-	 try{
-		 while((record=aParser1.getNext(record))!=null){
-			 if(recCount==0) {
-				 assertEquals(record.getField(0).toString(),&quot;1.0&quot;);
-				 assertEquals(record.getField(1).toString(),&quot;Stone&quot;);
-				 assertEquals(record.getField(2).toString(),&quot;101&quot;);
-				 assertEquals(record.getField(3).toString(),&quot;1993-01-11 00:00:00&quot;);
-			 } else if(recCount==1) {
-				 assertEquals(record.getField(0).toString(),&quot;-15.5&quot;);
-				 assertEquals(record.getField(1).toString(),&quot;Brook&quot;);
-				 assertEquals(record.getField(2).toString(),&quot;112&quot;);
-				 assertEquals(record.getField(3).toString(),&quot;2002-11-03 00:00:00&quot;);
-			 } else if(recCount==2) {
-				 assertEquals(record.getField(0).toString(),&quot;-0.7&quot;);
-				 assertEquals(record.getField(1).toString(),&quot;Bone Broo&quot;);
-				 assertEquals(record.getField(2).toString(),&quot;99&quot;);
-				 assertEquals(record.getField(3).toString(),&quot;2003-01-01 00:00:00&quot;);
-			 }
-			 recCount++;
-		 }
-		 assertEquals(3,recCount);		
-			
-	 } catch (BadDataFormatException e){	
-		 fail(&quot;Should not raise an BadDataFormatException&quot;);
-		 e.printStackTrace();
-	 } catch (Exception ee){
-		 fail(&quot;Should not throw Exception&quot;);
-		 ee.printStackTrace();
-	 }
-
- }
-	
- /**
-  *  Test for @link for a well formatted data source.
-  *  lenient handler
-  */
-	
- public void test_lenient_goodFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-	 // test lenient handler ------------------------------------
-	 aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.LENIENT);
-	 aParser1.addBDFHandler(aHandler);
-		
-	 int recCount = 0;
-	 try{
-		 while((record=aParser1.getNext(record))!=null){
-			 if(recCount==0) {
-				 assertEquals(record.getField(0).toString(),&quot;1.0&quot;);
-				 assertEquals(record.getField(1).toString(),&quot;Stone&quot;);
-				 assertEquals(record.getField(2).toString(),&quot;101&quot;);
-				 assertEquals(record.getField(3).toString(),&quot;1993-01-11 00:00:00&quot;);
-			 } else if(recCount==1) {
-				 assertEquals(record.getField(0).toString(),&quot;-15.5&quot;);
-				 assertEquals(record.getField(1).toString(),&quot;Brook&quot;);
-				 assertEquals(record.getField(2).toString(),&quot;112&quot;);
-				 assertEquals(record.getField(3).toString(),&quot;2002-11-03 00:00:00&quot;);
-			 } else if(recCount==2) {
-				 assertEquals(record.getField(0).toString(),&quot;-0.7&quot;);
-				 assertEquals(record.getField(1).toString(),&quot;Bone Broo&quot;);
-				 assertEquals(record.getField(2).toString(),&quot;99&quot;);
-				 assertEquals(record.getField(3).toString(),&quot;2003-01-01 00:00:00&quot;);
-			 }
-			 recCount++;
-		 }
-		 assertEquals(3,recCount);
-	 } catch (BadDataFormatException e){	
-		 fail(&quot;Should not raise an BadDataFormatException&quot;);
-		 e.printStackTrace();
-	 } catch (Exception ee){
-		 fail(&quot;Should not throw Exception&quot;);
-		 ee.printStackTrace();
-	 }
- }
-	
-
- /**
-  *  Test for a data source with poorly formatted fields.
-  *  No handler.
-  */
-	
- public void test_badFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-	 boolean failed = false;
-	 // test no handler ------------------------------------
-	 try{
-		 while((record=aParser2.getNext(record))!=null){
-			 fail(&quot;Should throw Exception&quot;);
-		 }
-	 } catch (BadDataFormatException e){	
-		 fail(&quot;Should not raise an BadDataFormatException&quot;);
-		 e.printStackTrace();
-	 } catch (RuntimeException re) {
-		 failed = true;
-	 } catch (Exception ee){
-		 ee.printStackTrace();
-	 }
-	 if(!failed)
-		 fail(&quot;Should raise an RuntimeException&quot;);
- }
-	
-
- /**
-  *  Test for a data source with poorly formatted fields.
-  *  No handler.
-  */
-	
- public void test_strict_badFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-
-	 // test strict handler ------------------------------------
-	 aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.STRICT);
-	 aParser2.addBDFHandler(aHandler);
-	 int recCount = 0;
-	 try{
-		 while((record=aParser2.getNext(record))!=null){
-			 recCount++;
-		 }
-		 fail(&quot;Should raise an BadDataFormatException&quot;);
-	 } catch (BadDataFormatException e){	
-	 } catch (Exception ee){
-		 fail(&quot;Should not throw Exception&quot;);
-		 ee.printStackTrace();
-	 }
-	 assertEquals(0,recCount);
- }
-	
-
- /**
-  *  Test for a data source with poorly formatted fields.
-  *  controlled handler.
-  */
-	
- public void test_controlled_badFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-
-	 // test controlled handler ------------------------------------
-	 aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.CONTROLLED);
-	 aParser2.addBDFHandler(aHandler);
-	 int recCount = 0;
-	 try{
-		 while((record=aParser2.getNext(record))!=null){
-			 recCount++;
-		 }
-	 } catch (BadDataFormatException e){	
-		 fail(&quot;Should not raise an BadDataFormatException&quot;);
-		 e.printStackTrace();
-	 } catch (Exception ee){
-		 fail(&quot;Should not throw Exception&quot;);
-		 ee.printStackTrace();
-	 }
-	 assertEquals(0,recCount);  //may need to be revised
-	 //depending how we implement nullable property
-
- }
-	
-
- /**
-  *  Test for a data source with poorly formatted fields.
-  *  lenient handler.
-  */
-	
- public void test_lenient_badFile() {
-	 BadDataFormatExceptionHandler aHandler = null;
-	 // test lenient handler ------------------------------------
-	 aHandler = BadDataFormatExceptionHandlerFactory.getHandler(BadDataFormatExceptionHandler.LENIENT);
-	 aParser2.addBDFHandler(aHandler);
-	 int recCount = 0;
-		
-	 try{
-		 while((record=aParser2.getNext(record))!=null){
-			 if(recCount==0) {
-				 assertEquals(&quot;No Name&quot;,record.getField(1).toString());
-				 assertEquals(&quot;101&quot;,record.getField(2).toString());
-			 } else if(recCount==1) {
-				 assertEquals(&quot;Brook&quot;,record.getField(1).toString());
-				 assertEquals(&quot;2000-01-01 00:00:00&quot;,record.getField(3).toString());
-			 } else if(recCount==2) {
-				assertEquals(&quot;0.0&quot;,record.getField(0).toString());
-				assertEquals(&quot;5&quot;,record.getField(2).toString());
-			 }
-			 recCount++;
-		 }
-		 assertEquals(3,recCount);
-	 } catch (BadDataFormatException e){	
-		 fail(&quot;Should not raise an BadDataFormatException&quot;);
-		 e.printStackTrace();
-	 } catch (Exception ee){
-		 fail(&quot;Should not throw Exception&quot;);
-		 ee.printStackTrace();
-	 }
- }
-
-
-}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/ExceptionTestSuite.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/ExceptionTestSuite.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/exception/ExceptionTestSuite.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -32,7 +32,6 @@
 	TestSuite suite= new TestSuite(&quot;All org.jetel.exception Tests&quot;);
 	suite.addTest(new TestSuite(org.jetel.exception.BadDataFormatExceptionHandler_FixLenDataParser2_Test.class));
 	suite.addTest(new TestSuite(org.jetel.exception.BadDataFormatExceptionHandler_DelimitedDataParserNIO_Test.class));
-	suite.addTest(new TestSuite(org.jetel.exception.BadDataFormatExceptionHandler_SQLDataParser_Test.class));
 		
 	return suite;
 }

Deleted: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/graph/DirectEdgeTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/graph/DirectEdgeTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/graph/DirectEdgeTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,189 +0,0 @@
-/*
- *  jETeL/Clover - Java based ETL application framework.
- *  Created on Jan 24, 2005
- *  Copyright (C) 2002-2005  David Pavlis, Wes Maciorowski
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-
-package org.jetel.graph;
-
-import java.io.IOException;
-import junit.framework.TestCase;
-
-import org.jetel.data.DataRecord;
-import org.jetel.graph.DirectEdge;
-import org.jetel.graph.Edge;
-import org.jetel.metadata.DataFieldMetadata;
-import org.jetel.metadata.DataRecordMetadata;
-
-public class DirectEdgeTest extends TestCase {
-	private DataRecordMetadata aDelimitedDataRecordMetadata;
-	private DirectEdge edge;
-	
-	public DirectEdgeTest(String name){
-	    super(name);
-	}
-	
-	protected void setUp() { 
-		aDelimitedDataRecordMetadata = new DataRecordMetadata(&quot;record2&quot;,DataRecordMetadata.DELIMITED_RECORD);
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field1&quot;,DataFieldMetadata.BYTE_FIELD,&quot;:&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field3&quot;,DataFieldMetadata.INTEGER_FIELD,(short)23));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-
-		edge=new DirectEdge(new Edge(&quot;testEdge&quot;,aDelimitedDataRecordMetadata));
-		try{
-		    edge.init();
-		}catch(IOException ex){
-		    throw new RuntimeException(ex);
-		}
-	}
-
-	protected void tearDown() {
-		aDelimitedDataRecordMetadata = null;
-		edge=null;
-	}
-
-
-	/**
-	 *  Test for @link org.jetel.graph.DirectEdge
-	 *
-	 */
-	public void test_1_sendData() {
-	    final int NUM_REC=1;
-	    DataRecord record=new DataRecord(aDelimitedDataRecordMetadata);
-	    record.init();
-	    
-		assertTrue(edge.isOpen());
-		assertFalse(edge.hasData());
-	
-		try{
-		for (int i=0;i&lt;NUM_REC;i++){
-		    edge.writeRecord(record);
-		}
-		}catch(Exception ex){
-		    throw new RuntimeException(ex);
-		}
-		assertTrue(edge.hasData());
-		try{
-		    assertNotNull(edge.readRecord(record));
-		}catch(Exception ex){
-		    throw new RuntimeException(ex);
-		}
-	}
-	
-	public void test_2_sendData() {
-	    ProducerThread thread1;
-	    ConsumerThread thread2;
-	    
-	    final DataRecord record1=new DataRecord(aDelimitedDataRecordMetadata);
-	    final DataRecord record2=new DataRecord(aDelimitedDataRecordMetadata);
-	    record2.init();
-	    record1.init();
-	    edge.open();
-	    assertTrue(edge.isOpen());
-		assertFalse(edge.hasData());
-		
-		thread1=new ProducerThread(record1,edge);
-		thread2=new ConsumerThread(record2,edge);
-		
-		// ROUND 1 - MAX, MIN priority
-		thread1.setPriority(Thread.MAX_PRIORITY);
-		thread2.setPriority(Thread.MIN_PRIORITY);
-		thread1.start();
-		thread2.start();
-		try{
-		thread1.join();
-		thread2.join();
-		}
-		catch(Exception ex){
-		    
-		}
-		
-		assertEquals(ProducerThread.NUM_REC,thread2.getCounter());
-		
-		// ROUND 2 - MIN , MAX priority
-		edge.open();
-	    assertTrue(edge.isOpen());
-		assertFalse(edge.hasData());
-		thread1=new ProducerThread(record1,edge);
-		thread2=new ConsumerThread(record2,edge);
-		thread1.setPriority(Thread.MIN_PRIORITY);
-		thread2.setPriority(Thread.MAX_PRIORITY);
-		
-		thread1.start();
-		thread2.start();
-		try{
-		thread1.join();
-		thread2.join();
-		}
-		catch(Exception ex){
-		    
-		}
-		
-		assertEquals(ProducerThread.NUM_REC,thread2.getCounter());
-		
-	}
-	
-	
-	private static class ProducerThread extends Thread {
-	    public static final int NUM_REC=999999;
-	    DataRecord record;
-	    DirectEdge edge;
-	    
-	    ProducerThread(DataRecord record, DirectEdge edge){
-	        this.record=record;
-	        this.edge=edge;
-	    }
-	    
-	    public void run(){
-	        for (int i=0;i&lt;NUM_REC;i++){
-	            try{
-	                edge.writeRecord(record);
-	                //System.out.println(&quot;&gt;&gt; SENT RECORD ***&quot;);
-	            }catch(Exception ex){
-	            }
-	        }
-	        edge.close();
-	    }
-	} 
-	
-	private static class ConsumerThread extends Thread {
-	    DataRecord record;
-	    DirectEdge edge;
-	    int counter;
-	    
-	    ConsumerThread(DataRecord record, DirectEdge edge){
-	        this.record=record;
-	        this.edge=edge;
-	    }
-	    
-	    public void run(){
-	        counter=0;
-	        try{
-	            while(edge.readRecord(record)!=null){
-	                counter++;
-	                //System.out.println(&quot;&lt;&lt; GOT RECORD ***&quot;);
-	            }
-	        }catch(Exception ex){
-	        }
-	    }
-	    
-	    public int getCounter(){
-	        return counter;
-	    }
-	}
-}
\ No newline at end of file

Copied: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/graph/EdgeTest.java (from rev 2346, trunk/cloveretl.engine/test/org/jetel/graph/EdgeTest.java)

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/interpreter/TestInterpreter.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/interpreter/TestInterpreter.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/interpreter/TestInterpreter.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -39,12 +39,13 @@
 import org.jetel.data.primitive.DecimalFactory;
 import org.jetel.data.primitive.Numeric;
 import org.jetel.data.sequence.Sequence;
+import org.jetel.data.sequence.SequenceFactory;
 import org.jetel.graph.TransformationGraph;
 import org.jetel.interpreter.node.CLVFStart;
 import org.jetel.interpreter.node.CLVFStartExpression;
+import org.jetel.main.runGraph;
 import org.jetel.metadata.DataFieldMetadata;
 import org.jetel.metadata.DataRecordMetadata;
-import org.jetel.sequence.PrimitiveSequence;
 
 
 import org.apache.commons.logging.Log;
@@ -63,7 +64,7 @@
     TransformationGraph graph;
 	
 	protected void setUp() {
-	    Defaults.init();
+	    runGraph.initEngine(null, null);
 	    
         graph=new TransformationGraph();
         
@@ -119,7 +120,8 @@
 		SetVal.setInt(record,4,-999);
 		record1.getField(&quot;Value&quot;).setNull(true);
         
-        Sequence seq = new PrimitiveSequence(&quot;test&quot;,graph,&quot;test&quot;);
+        Sequence seq = SequenceFactory.createSequence(graph, &quot;PRIMITIVE_SEQUENCE&quot;, 
+        		new Object[]{&quot;test&quot;,graph,&quot;test&quot;}, new Class[]{String.class,TransformationGraph.class,String.class});
         graph.addSequence(&quot;test&quot;, seq);
 	}
 	
@@ -534,8 +536,8 @@
 		      assertEquals(&quot;dplusd1&quot;,new Double(0.1000),new Double(((Decimal)result[12]).getDouble()));
 		      assertEquals(&quot;dplusj&quot;,new Double(100.1),new Double(((Decimal)result[13]).getDouble()));
 		      assertEquals(&quot;dplusn&quot;,new Double(10.1),new Double(((Decimal)result[14]).getDouble()));
-		      assertEquals(&quot;spluss1&quot;,&quot;hello world&quot;,(((StringBuffer)result[17]).toString()));
-		      assertEquals(&quot;splusm1&quot;,&quot;hello0.0010&quot;,(((StringBuffer)result[18]).toString()));
+		      assertEquals(&quot;spluss1&quot;,&quot;hello world&quot;,(((StringBuilder)result[17]).toString()));
+		      assertEquals(&quot;splusm1&quot;,&quot;hello0.0010&quot;,(((StringBuilder)result[18]).toString()));
 		      assertEquals(&quot;dateplus&quot;,new GregorianCalendar(2004,01,9,15,00,30).getTime(),(Date)result[20]);
 
 		} catch (ParseException e) {
@@ -1230,7 +1232,7 @@
 		      
 		      Object[] result = executor.stack.globalVarSlot;
 		      assertEquals(3,((CloverInteger)result[1]).getInt());
-		      assertEquals(&quot;April&quot;,((StringBuffer)result[2]).toString());
+		      assertEquals(&quot;April&quot;,((StringBuilder)result[2]).toString());
 		      assertEquals(true,((Boolean)result[4]).booleanValue());
 		      
 		} catch (ParseException e) {
@@ -1605,22 +1607,22 @@
 		      parseTree.dump(&quot;&quot;);
 		      
 		      Object[] result = executor.stack.globalVarSlot;
-		      assertEquals(&quot;subs&quot;,&quot;ello &quot;,((StringBuffer)result[2]).toString());
-		      assertEquals(&quot;upper&quot;,&quot;ELLO &quot;,((StringBuffer)result[3]).toString());
-		      assertEquals(&quot;lower&quot;,&quot;ello hi   &quot;,((StringBuffer)result[4]).toString());
-		      assertEquals(&quot;t(=trim)&quot;,&quot;im  ello hi&quot;,((StringBuffer)result[5]).toString());
+		      assertEquals(&quot;subs&quot;,&quot;ello &quot;,((StringBuilder)result[2]).toString());
+		      assertEquals(&quot;upper&quot;,&quot;ELLO &quot;,((StringBuilder)result[3]).toString());
+		      assertEquals(&quot;lower&quot;,&quot;ello hi   &quot;,((StringBuilder)result[4]).toString());
+		      assertEquals(&quot;t(=trim)&quot;,&quot;im  ello hi&quot;,((StringBuilder)result[5]).toString());
 		      assertEquals(&quot;l(=length)&quot;,5,((Decimal)result[6]).getInt());
-		      assertEquals(&quot;c(=concat)&quot;,&quot;ello hi   ELLO 2,today is &quot;+new Date(),((StringBuffer)result[7]).toString());
+		      assertEquals(&quot;c(=concat)&quot;,&quot;ello hi   ELLO 2,today is &quot;+new Date(),((StringBuilder)result[7]).toString());
 //		      assertEquals(&quot;datum&quot;,record.getField(&quot;Born&quot;).getValue(),(Date)result[8]);
-		      assertEquals(&quot;ddiff&quot;,-1,((CloverLong)result[10]).getLong());
+		      assertEquals(&quot;ddiff&quot;,-2,((CloverLong)result[10]).getLong());
 		      assertEquals(&quot;isn&quot;,false,((Boolean)result[12]).booleanValue());
 		      assertEquals(&quot;s1&quot;,new CloverDouble(6),(CloverDouble)result[13]);
-		      assertEquals(&quot;rep&quot;,&quot;etto hi   EttO 2,today is &quot;+new Date(),((StringBuffer)result[14]).toString());
+		      assertEquals(&quot;rep&quot;,&quot;etto hi   EttO 2,today is &quot;+new Date(),((StringBuilder)result[14]).toString());
 		      assertEquals(&quot;stn&quot;,0.25125,((Decimal)result[15]).getDouble());
-		      assertEquals(&quot;nts&quot;,&quot;22&quot;,((StringBuffer)result[16]).toString());
+		      assertEquals(&quot;nts&quot;,&quot;22&quot;,((StringBuilder)result[16]).toString());
 		      assertEquals(&quot;dtn&quot;,11.0,((Decimal)result[18]).getDouble());
 		      assertEquals(&quot;ii&quot;,21,((CloverInteger)result[19]).getInt());
-		      assertEquals(&quot;dts&quot;,&quot;02.12.24&quot;,((StringBuffer)result[21]).toString());
+		      assertEquals(&quot;dts&quot;,&quot;02.12.24&quot;,((StringBuilder)result[21]).toString());
 		      
 		} catch (ParseException e) {
 		    	System.err.println(e.getMessage());

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -52,17 +52,17 @@
 	public void test_1_getField() {
 		DataFieldMetadata aDataFieldMetadata = null;
 
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.BYTE_FIELD,&quot;:&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,(short)23));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field1&quot;,DataFieldMetadata.BYTE_FIELD,&quot;:&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field3&quot;,DataFieldMetadata.INTEGER_FIELD,(short)23));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
 		assertEquals(5, aDelimitedDataRecordMetadata.getNumFields());
 		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(1);
 		if (aDataFieldMetadata==null) System.out.println(&quot;NULL returned!&quot;);
 		assertEquals(DataFieldMetadata.BYTE_FIELD, aDataFieldMetadata.getType() );
 		assertEquals(&quot;:&quot;, aDataFieldMetadata.getDelimiter() );
-		assertEquals(&quot;Field 1&quot;, aDataFieldMetadata.getName());
+		assertEquals(&quot;Field1&quot;, aDataFieldMetadata.getName());
 		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(3);
 		assertEquals((short)23, aDataFieldMetadata.getSize() );
 	}
@@ -74,16 +74,16 @@
 	public void test_2_getField() {
 		DataFieldMetadata aDataFieldMetadata = null;
 
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.BYTE_FIELD,&quot;:&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,(short)23));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(&quot;Field 1&quot;);
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field1&quot;,DataFieldMetadata.BYTE_FIELD,&quot;:&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field3&quot;,DataFieldMetadata.INTEGER_FIELD,(short)23));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(&quot;Field1&quot;);
 		assertEquals(DataFieldMetadata.BYTE_FIELD, aDataFieldMetadata.getType() );
 		assertEquals(&quot;:&quot;, aDataFieldMetadata.getDelimiter() );
-		assertEquals(&quot;Field 1&quot;, aDataFieldMetadata.getName());
-		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(&quot;Field 3&quot;);
+		assertEquals(&quot;Field1&quot;, aDataFieldMetadata.getName());
+		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(&quot;Field3&quot;);
 		assertEquals((short)23, aDataFieldMetadata.getSize() );
 	}
 
@@ -92,16 +92,16 @@
 	 *
 	 */
 	public void test_getFieldPosition() {
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		assertEquals(0, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field 0&quot;));
-		assertEquals(1, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field 1&quot;));
-		assertEquals(2, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field 2&quot;));
-		assertEquals(3, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field 3&quot;));
-		assertEquals(4, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field 4&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		assertEquals(0, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field0&quot;));
+		assertEquals(1, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field1&quot;));
+		assertEquals(2, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field2&quot;));
+		assertEquals(3, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field3&quot;));
+		assertEquals(4, aDelimitedDataRecordMetadata.getFieldPosition(&quot;Field4&quot;));
 	}
 
 	/**
@@ -109,11 +109,11 @@
 	 *
 	 */
 	public void test_addField() {
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
 		assertEquals(5, aDelimitedDataRecordMetadata.getNumFields());
 	}
 
@@ -123,15 +123,15 @@
 	 */
 	public void test_1_delField() {
 		DataFieldMetadata aDataFieldMetadata = null;
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
 		aDelimitedDataRecordMetadata.delField((short)2);
 		assertEquals(4, aDelimitedDataRecordMetadata.getNumFields());
 		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(2);
-		assertNotSame(&quot;Field 1&quot;, aDataFieldMetadata.getName());
+		assertNotSame(&quot;Field1&quot;, aDataFieldMetadata.getName());
 	}
 
 
@@ -141,14 +141,14 @@
 	 */
 	public void test_2_delField() {
 		DataFieldMetadata aDataFieldMetadata = null;
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.delField(&quot;Field 4&quot;);
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field1&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field4&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
+		aDelimitedDataRecordMetadata.delField(&quot;Field4&quot;);
 		assertEquals(4, aDelimitedDataRecordMetadata.getNumFields());
 		aDataFieldMetadata  = aDelimitedDataRecordMetadata.getField(3);
-		assertNotSame(&quot;Field 3&quot;, aDataFieldMetadata.getName());
+		assertEquals(&quot;Field3&quot;, aDataFieldMetadata.getName());
 	}
 }
\ No newline at end of file

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataXMLReaderWriterTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataXMLReaderWriterTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/metadata/DataRecordMetadataXMLReaderWriterTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -53,18 +53,18 @@
 		aDelimitedDataRecordMetadata.addField(aDataFieldMetadata);
 
 		aDataFieldMetadata = new DataFieldMetadata(&quot;Field_0&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;);
-		aDataFieldMetadata.setCodeStr(&quot;return Math.abs(-5);&quot;);
+//		aDataFieldMetadata.setCodeStr(&quot;return Math.abs(-5);&quot;);
 		aDelimitedDataRecordMetadata.addField(aDataFieldMetadata);
 		aDataFieldMetadata = new DataFieldMetadata(&quot;Field_1&quot;,DataFieldMetadata.STRING_FIELD,&quot;:&quot;);
 		aDelimitedDataRecordMetadata.addField(aDataFieldMetadata);
 		aDataFieldMetadata = new DataFieldMetadata(&quot;Field_2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;,&quot;);
-		aDataFieldMetadata.setCodeStr(&quot;return 7;&quot;);
+//		aDataFieldMetadata.setCodeStr(&quot;return 7;&quot;);
 		aDelimitedDataRecordMetadata.addField(aDataFieldMetadata);
 		aDataFieldMetadata = new DataFieldMetadata(&quot;Field_3&quot;,DataFieldMetadata.NUMERIC_FIELD,&quot;\n&quot;);
-		aDataFieldMetadata.setCodeStr(&quot;return [record1].[field1]/[record2].[field2];&quot;);
+//		aDataFieldMetadata.setCodeStr(&quot;return [record1].[field1]/[record2].[field2];&quot;);
 		aDelimitedDataRecordMetadata.addField(aDataFieldMetadata);
 
-		testFile1 = &quot;data\\out\\test1.txt&quot;;	
+		testFile1 = &quot;data/out/test1.txt&quot;;	
 		File aFile=new File(testFile1);
 		 if(!aFile.exists()) {
 			new File(aFile.getParent()).mkdirs();
@@ -111,35 +111,35 @@
 			assertEquals(null,aDataFieldMetadata.getDefaultValue());
 			assertEquals(null,aDataFieldMetadata.getFormatStr());
 			assertEquals(DataFieldMetadata.INTEGER_FIELD,aDataFieldMetadata.getType());
-			assertEquals(null,aDataFieldMetadata.getCodeStr());
+//			assertEquals(null,aDataFieldMetadata.getCodeStr());
 			
 			aDataFieldMetadata = aDelimitedDataRecordMetadata.getField(&quot;Field_0&quot;);
 			assertEquals(&quot;;&quot;,aDataFieldMetadata.getDelimiter());
 			assertEquals(null,aDataFieldMetadata.getDefaultValue());
 			assertEquals(null,aDataFieldMetadata.getFormatStr());
 			assertEquals(DataFieldMetadata.INTEGER_FIELD,aDataFieldMetadata.getType());
-			assertEquals(&quot;return Math.abs(-5);&quot;,aDataFieldMetadata.getCodeStr().replace('\n',' ').replace('\t',' ').trim());
+//			assertEquals(&quot;return Math.abs(-5);&quot;,aDataFieldMetadata.getCodeStr().replace('\n',' ').replace('\t',' ').trim());
 
 			aDataFieldMetadata = aDelimitedDataRecordMetadata.getField(&quot;Field_1&quot;);
 			assertEquals(&quot;:&quot;,aDataFieldMetadata.getDelimiter());
 			assertEquals(null,aDataFieldMetadata.getDefaultValue());
 			assertEquals(null,aDataFieldMetadata.getFormatStr());
 			assertEquals(DataFieldMetadata.STRING_FIELD,aDataFieldMetadata.getType());
-			assertEquals(null,aDataFieldMetadata.getCodeStr());
+//			assertEquals(null,aDataFieldMetadata.getCodeStr());
 
 			aDataFieldMetadata = aDelimitedDataRecordMetadata.getField(&quot;Field_2&quot;);
 			assertEquals(&quot;,&quot;,aDataFieldMetadata.getDelimiter());
 			assertEquals(null,aDataFieldMetadata.getDefaultValue());
 			assertEquals(null,aDataFieldMetadata.getFormatStr());
 			assertEquals(DataFieldMetadata.INTEGER_FIELD,aDataFieldMetadata.getType());
-			assertEquals(&quot;return 7;&quot;,aDataFieldMetadata.getCodeStr().replace('\n',' ').replace('\t',' ').trim());
+//			assertEquals(&quot;return 7;&quot;,aDataFieldMetadata.getCodeStr().replace('\n',' ').replace('\t',' ').trim());
 
 			aDataFieldMetadata = aDelimitedDataRecordMetadata.getField(&quot;Field_3&quot;);
 			assertEquals(&quot;\n&quot;,aDataFieldMetadata.getDelimiter());
 			assertEquals(null,aDataFieldMetadata.getDefaultValue());
 			assertEquals(null,aDataFieldMetadata.getFormatStr());
 			assertEquals(DataFieldMetadata.NUMERIC_FIELD,aDataFieldMetadata.getType());
-			assertEquals(&quot;return [record1].[field1]/[record2].[field2];&quot;,aDataFieldMetadata.getCodeStr().replace('\n',' ').replace('\t',' ').trim());
+//			assertEquals(&quot;return [record1].[field1]/[record2].[field2];&quot;,aDataFieldMetadata.getCodeStr().replace('\n',' ').replace('\t',' ').trim());
 		} catch (FileNotFoundException e) {
 			// TODO Auto-generated catch block
 			e.printStackTrace();

Deleted: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/ClassBuilderTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/ClassBuilderTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/ClassBuilderTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,52 +0,0 @@
-/*
- * Created on May 31, 2003
- *
- *  jETeL/Clover - Java based ETL application framework.
- *  Copyright (C) 2002  David Pavlis
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-package org.jetel.util;
-
-import junit.framework.TestCase;
-
-/**
- * @author Wes Maciorowski
- * @version 1.0
- * 
- * JUnit tests for org.jetel.util.ClassBuilder class.
- */
-public class ClassBuilderTest  extends TestCase  {
-
-	protected void setUp() {
-	}
-
-	protected void tearDown() {
-	}
-
-	/**
-	 *  Test for @link org.jetel.util.ClassBuilder.ClassBuilder(DataRecord record, DataRecordMetadata[] arrayDataRecordMetadata)
-	 *
-	 */
-
-	public void testConstructor() {}
-
-	/**
-	 *  Test for @link int[][]  org.jetel.util.ClassBuilder.constructMethod(String tmpCode)
-	 *
-	 */
-
-	public void testConstructMethod() {}
-	
-}

Deleted: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CodeParserTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CodeParserTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CodeParserTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,99 +0,0 @@
-/*
- * Created on Jun 4, 2003
- *
- * To change the template for this generated file go to
- * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments
- */
-package org.jetel.util;
-
-import org.jetel.data.DataRecord;
-import org.jetel.metadata.DataFieldMetadata;
-import org.jetel.metadata.DataRecordMetadata;
-import org.jetel.util.ClassBuilder;
-
-import junit.framework.TestCase;
-
-/**
- * @author Wes Maciorowski
- * @version 1.0
- * 
- * JUnit tests for org.jetel.util.CodeParser class.
- */
-public class CodeParserTest extends TestCase  {
-	StringBuffer test0 = null;
-	StringBuffer test1 = null;
-	StringBuffer test2 = null;
-	StringBuffer test3 = null;
-	StringBuffer test4 = null;
-	ClassBuilder aClassBuilder = null;
-
-	protected void setUp() {
-		//lets create 5 test cases
-		
-		// no record references in the code
-		
-		// input record reference in the code
-		
-		// reference to another field in the code
-		
-		// input record reference and reference to another field in the code
-
-		// input record reference and reference to another field in the code
-		// plus incorrect refs
-		
-		DataFieldMetadata aDataFieldMetadata = null;
-
-		DataRecordMetadata atestRecordMetadata = new DataRecordMetadata(&quot;test&quot;,DataRecordMetadata.FIXEDLEN_RECORD);
-		aDataFieldMetadata = new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.STRING_FIELD,(short)20);
-		aDataFieldMetadata.setCodeStr(test0.toString());
-		aDataFieldMetadata = new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.NUMERIC_FIELD,(short)1);
-		aDataFieldMetadata.setCodeStr(test0.toString());
-		aDataFieldMetadata = new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,(short)5);
-		aDataFieldMetadata.setCodeStr(test0.toString());
-		aDataFieldMetadata = new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.NUMERIC_FIELD,(short)5);
-		aDataFieldMetadata.setCodeStr(test0.toString());
-		aDataFieldMetadata = new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.NUMERIC_FIELD,(short)5);
-		aDataFieldMetadata.setCodeStr(test0.toString());
-
-		atestRecordMetadata.addField(aDataFieldMetadata);
-
-
-		// lets create out test data record
-		DataRecord record = new DataRecord(atestRecordMetadata);
-		
-		// lets create 2 input records
-		DataRecordMetadata[] arrayDataRecordMetadata = null;
-		arrayDataRecordMetadata = new DataRecordMetadata[2];
-		
-		DataRecordMetadata aFixedDataRecordMetadata = new DataRecordMetadata(&quot;record1&quot;,DataRecordMetadata.FIXEDLEN_RECORD);
-		aFixedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.STRING_FIELD,(short)20));
-		aFixedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.BYTE_FIELD,(short)1));
-		aFixedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,(short)5));
-		aFixedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,(short)5));
-		aFixedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.NUMERIC_FIELD,(short)10));
-
-		DataRecordMetadata aDelimitedDataRecordMetadata = new DataRecordMetadata(&quot;record2&quot;,DataRecordMetadata.DELIMITED_RECORD);
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 0&quot;,DataFieldMetadata.STRING_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 1&quot;,DataFieldMetadata.BYTE_FIELD,&quot;:&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 2&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 3&quot;,DataFieldMetadata.INTEGER_FIELD,&quot;;&quot;));
-		aDelimitedDataRecordMetadata.addField(new DataFieldMetadata(&quot;Field 4&quot;,DataFieldMetadata.NUMERIC_FIELD,&quot;;&quot;));
-		
-		arrayDataRecordMetadata[0] = aFixedDataRecordMetadata;
-		arrayDataRecordMetadata[1] = aDelimitedDataRecordMetadata;
-		
-		aClassBuilder = new ClassBuilder(record,arrayDataRecordMetadata);
-	}
-
-	protected void tearDown() {
-	}
-
-
-	/**
-	 *  Test for @link int[][]  org.jetel.util.CodeParser.parse()
-	 *
-	 */
-
-	public void testparse() {}
-	
-}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CompileTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CompileTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CompileTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -25,7 +25,7 @@
 import java.io.IOException;
 
 import org.jetel.exception.ClassCompilationException;
-import org.jetel.util.Compile;
+import org.jetel.util.Compiler;
 
 import junit.framework.TestCase;
 
@@ -33,13 +33,13 @@
  * @author Wes Maciorowski
  * @version 1.0
  * 
- * JUnit tests for org.jetel.util.Compile class.
+ * JUnit tests for org.jetel.util.Compiler class.
  */
 public class CompileTest   extends TestCase  {
-	String testJavaFile1 = &quot;src\\org\\jetel\\userclasses\\test1.java&quot;;	
-	String testJavaClassFile1 = &quot;org\\jetel\\userclasses\\test1.class&quot;;	
-	String testJavaFile2 = &quot;src\\org\\jetel\\userclasses\\test2.java&quot;;	
-	String testJavaClassFile2 = &quot;org\\jetel\\userclasses\\test2.class&quot;;	
+	String testJavaFile1 = &quot;src/org/jetel/userclasses/test1.java&quot;;	
+	String testJavaClassFile1 = &quot;org/jetel/userclasses/test1.class&quot;;	
+	String testJavaFile2 = &quot;src/org/jetel/userclasses/test2.java&quot;;	
+	String testJavaClassFile2 = &quot;org/jetel/userclasses/test2.class&quot;;	
 	String classDirectory = &quot;bin&quot;;
 
 	protected void setUp() {
@@ -105,26 +105,21 @@
 }
 
 /**
- *  Test for @link org.jetel.util.Compile.compileClass(String className)
+ *  Test for @link org.jetel.util.Compiler.CompilerClass(String className)
  *
  */
 
-//public void testCompileClass() {
-//	try {
-//		Compile.compileClass(testJavaFile1,classDirectory);
-//	} catch (ClassCompilationException e) {
-//		fail(&quot;Compile.compileClass should not throw exceptions&quot;);
-//		e.printStackTrace();
-//	}
-//	assertTrue(new File(classDirectory+File.separator+testJavaClassFile1).exists());
-//
-//	try {
-//		Compile.compileClass(testJavaFile2,classDirectory);
-//		fail(&quot;Compile.compileClass should throw exception&quot;);
-//	} catch (ClassCompilationException e) {
-//		e.printStackTrace();
-//	}
-//	assertFalse(new File(classDirectory+File.separator+testJavaClassFile2).exists());
-//}
+public void testCompilerClass() {
+	Compiler compiler;
 
+	compiler = new Compiler(testJavaFile1,true,classDirectory);
+	compiler.compile();
+	assertTrue(new File(classDirectory+File.separator+testJavaClassFile1).exists());
+
+	compiler = new Compiler(testJavaFile2,true,classDirectory);
+	compiler.compile();
+	System.out.print(compiler.getCapturedOutput());
+	assertFalse(new File(classDirectory+File.separator+testJavaClassFile2).exists());
+}
+
 }
\ No newline at end of file

Deleted: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CreateJavaObjectTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CreateJavaObjectTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/CreateJavaObjectTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -1,161 +0,0 @@
-/*
- *  jETeL/Clover - Java based ETL application framework.
- *  Copyright (C) 2002  David Pavlis
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- *  Created on May 31, 2003
- */
-package org.jetel.util;
-
-import java.io.DataOutputStream;
-import java.io.File;
-import java.io.FileOutputStream;
-import java.io.IOException;
-
-import org.jetel.exception.ClassCompilationException;
-import org.jetel.util.Compile;
-import org.jetel.util.CreateJavaObject;
-
-import junit.framework.TestCase;
-
-/**
- * @author Wes Maciorowski
- * @version 1.0
- * 
- * JUnit tests for org.jetel.util.Compile class.
- */
-public class CreateJavaObjectTest    extends TestCase  {
-	String testJavaFile1 = &quot;src\\org\\jetel\\userclasses\\test1.java&quot;;	
-	String testJavaClassFile1 = &quot;org\\jetel\\userclasses\\test1.class&quot;;	
-	String testJavaFile2 = &quot;src\\org\\jetel\\userclasses\\test2.java&quot;;	
-	String testJavaClassFile2 = &quot;org\\jetel\\userclasses\\test2.class&quot;;	
-	String classDirectory = &quot;bin&quot;;
-//	private org.jetel.userclasses.test1 t1 = null;
-//
-//	private org.jetel.userclasses.test2 t2 = null;
-
-protected void setUp() {
-	StringBuffer tmp = new StringBuffer();
-	tmp.append(&quot;package org.jetel.userclasses;\n&quot;);	
-	tmp.append(&quot;public class test1 {\n&quot;);
-	tmp.append(&quot;\tpublic static Integer addTwo(Integer i, Integer ii) {\n&quot;);
-	tmp.append(&quot;\t\treturn new Integer(i.intValue()+ii.intValue());\n&quot;);
-	tmp.append(&quot;\t}\n&quot;);
-	tmp.append(&quot;}\n&quot;);
-
-	File aFile=new File(testJavaFile1);
-	 if(!aFile.exists()) {
-		new File(aFile.getParent()).mkdirs();
-		try {
-			DataOutputStream fos = new DataOutputStream(new FileOutputStream(testJavaFile1));
-			fos.writeBytes(tmp.toString());
-		} catch (IOException e3) {
-			e3.printStackTrace();
-		}
-	 }
-
-//	try {
-//		Compile.compileClass(testJavaFile1,classDirectory);
-//	} catch (ClassCompilationException e) {
-//		e.printStackTrace();
-//	}
-
-
-	tmp = new StringBuffer();
-	tmp.append(&quot;package org.jetel.userclasses;\n&quot;);	
-	tmp.append(&quot;public class test2 {\n&quot;);
-	tmp.append(&quot;\tInteger i;\n&quot;);
-	tmp.append(&quot;\tInteger ii;\n&quot;);
-	tmp.append(&quot;\tpublic test2(Integer i, Integer ii) {\n&quot;);
-	tmp.append(&quot;\tthis.i = i;\n&quot;);
-	tmp.append(&quot;\tthis.ii = ii;\n&quot;);
-	tmp.append(&quot;\t}\n&quot;);
-	tmp.append(&quot;\tpublic Integer addTwo() {\n&quot;);
-	tmp.append(&quot;\t\treturn new Integer(i.intValue()+ii.intValue());\n&quot;);
-	tmp.append(&quot;\t}\n&quot;);
-	tmp.append(&quot;}\n&quot;);
-
-	aFile=new File(testJavaFile2);
-	 if(!aFile.exists()) {
-		new File(aFile.getParent()).mkdirs();
-		try {
-			DataOutputStream fos = new DataOutputStream(new FileOutputStream(testJavaFile2));
-			fos.writeBytes(tmp.toString());
-		} catch (IOException e3) {
-			e3.printStackTrace();
-		}
-	 }
-
-//	try {
-//		//Compile.compileClass(testJavaFile2,classDirectory);
-//	} catch (ClassCompilationException e) {
-//		e.printStackTrace();
-//	}
-
-}
-
-protected void tearDown() {
-	//remove test Files if any
-	File aFile=new File(testJavaFile1);
-	 if(aFile.exists()) {
-		 aFile.delete();
-	 }
-	aFile=new File(testJavaClassFile1);
-	 if(aFile.exists()) {
-		 aFile.delete();
-	 }
-
-	aFile=new File(testJavaFile2);
-	 if(aFile.exists()) {
-		 aFile.delete();
-	 }
-	aFile=new File(testJavaClassFile2);
-	 if(aFile.exists()) {
-		 aFile.delete();
-	 }
-}
-
-/**
- *  Test for @link org.jetel.util.Compile.compileClass(String className)
- *
- */
-public void test_createObject() throws Exception     {
-//	t1 = (org.jetel.userclasses.test1) CreateJavaObject.createObject(&quot;org.jetel.userclasses.test1&quot;);
-//	assertEquals(t1 != null, true);
-//	assertEquals(t1.addTwo(new Integer(7),new Integer(17)).intValue(),24);
-//	Object[] anObj = null;
-//	anObj = new Object[2];
-//	anObj[0] = new Integer(7);
-//	anObj[1] = new Integer(7);
-//
-//	t2 = (org.jetel.userclasses.test2) CreateJavaObject.createObject(&quot;org.jetel.userclasses.test2&quot;,anObj);
-//	assertEquals(t2.addTwo().intValue(),14);
-}
-
-public void test_invokeMethod() throws Exception     {
-
-	Object[] anObj = null;
-	anObj = new Object[2];
-	anObj[0] = new Integer(7);
-	anObj[1] = new Integer(7);
-
-	Integer tmpInteger = (Integer) CreateJavaObject.invokeMethod(&quot;org.jetel.userclasses.test2&quot;,&quot;addTwo&quot;,anObj, null);
-	assertEquals(tmpInteger.intValue(),14);
-
-	anObj[0] = new Integer(17);
-	tmpInteger = (Integer) CreateJavaObject.invokeMethod(&quot;org.jetel.userclasses.test1&quot;,&quot;addTwo&quot;, null,anObj);
-	assertEquals(tmpInteger.intValue(),24);
-}
-}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/FifoTest.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/FifoTest.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/FifoTest.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -84,16 +84,8 @@
 
 		fifo.add(new Integer(1));
 		fifo.add(new Integer(2));
+		assertFalse(fifo.add(new Integer(3)));
 
-		try  {
-			fifo.add(new Integer(3));
-			fail(&quot;An exception should be thrown as the Fifo is full&quot;);
-		}
-		catch ( Exception e )
-		{
-			// expected behaviour
-		}
-
 		result = (Integer)fifo.get();
 		assertEquals(new Integer(1), result);
 
@@ -133,15 +125,8 @@
 		fifo.add(new Integer(6));
 
 		// queue is now full
+		assertFalse(fifo.add(new Integer(7)));
 
-		try  {
-			fifo.add(new Integer(7));
-			fail(&quot;An exception should be thrown as the Fifo is full&quot;);
-		}
-		catch ( Exception e )
-		{
-			// expected behaviour
-		}
 
 		result = (Integer)fifo.get();
 		assertEquals(new Integer(3), result);
@@ -231,14 +216,7 @@
 		Queue fifo = new Queue(0);
 		Integer result = null;
 
-		try  {
-			fifo.add(new Integer(1));
-			fail(&quot;An exception should be thrown as the Fifo is full&quot;);
-		}
-		catch ( Exception e )
-		{
-			// expected behaviour
-		}
+		assertFalse(fifo.add(new Integer(1)));
 	}
 
 	/**
@@ -249,14 +227,7 @@
 		Integer result = null;
 
 		fifo.add(new Integer(1));
-		try  {
-			fifo.add(new Integer(2));
-			fail(&quot;An exception should be thrown as the Fifo is full&quot;);
-		}
-		catch ( Exception e )
-		{
-			// expected behaviour
-		}
+		assertFalse(fifo.add(new Integer(2)));
 	}
 
 }
\ No newline at end of file

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/UtilTestSuite.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/UtilTestSuite.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.engine/test/org/jetel/util/UtilTestSuite.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -34,10 +34,7 @@
 		TestSuite suite = new TestSuite(&quot;All org.jetel.util Tests&quot;);
 
 		suite.addTest(new TestSuite(org.jetel.util.StringUtilsTest.class));
-		suite.addTest(new TestSuite(org.jetel.util.ClassBuilderTest.class));
-		suite.addTest(new TestSuite(org.jetel.util.CodeParserTest.class));
 		suite.addTest(new TestSuite(org.jetel.util.CompileTest.class));
-		suite.addTest(new TestSuite(org.jetel.util.CreateJavaObjectTest.class));
 		return suite;
 
 	}

Modified: branches/cloveretl.engine.rel-2-1-0/cloveretl.sequence/src/org/jetel/sequence/SimpleSequence.java
===================================================================
--- branches/cloveretl.engine.rel-2-1-0/cloveretl.sequence/src/org/jetel/sequence/SimpleSequence.java	2007-01-31 14:08:49 UTC (rev 2419)
+++ branches/cloveretl.engine.rel-2-1-0/cloveretl.sequence/src/org/jetel/sequence/SimpleSequence.java	2007-01-31 14:29:53 UTC (rev 2420)
@@ -77,7 +77,6 @@
     int step;
     int start;
     int numCachedValues;
-    boolean isInitialized;
   
     int counter;
     FileChannel io;
@@ -109,7 +108,6 @@
         this.step=step;
         this.counter=0;
         this.numCachedValues=numCachedValues;
-        this.isInitialized = false;
     }
     
     public long currentValueLong(){
@@ -194,10 +192,9 @@
                 sequenceValue = buffer.getLong();
             }
         } catch(IOException ex) {
-            isInitialized = false;
+            free();
             throw new ComponentNotReadyException(ex);
         }
-        isInitialized = true;
     }
     
     private final void flushValue(long value) {
@@ -261,10 +258,10 @@
 		return filename;
 	}
 
-    public boolean isInitialized() {
-        return isInitialized;
+    public void setFilename(String filename) {
+        this.filename = filename;
     }
-	
+
 	static public SimpleSequence fromXML(TransformationGraph graph, Element nodeXML) throws XMLConfigurationException {
 		ComponentXMLAttributes xattribs = new ComponentXMLAttributes(nodeXML, graph);
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000057.html">[Cloveretl-svn-commits] CloverETL repos r2419 -	trunk/cloveretl.engine/src/org/jetel/data/parser
</A></li>
	<LI>Next message: <A HREF="000058.html">[Cloveretl-svn-commits] CloverETL repos r2421 -	trunk/cloveretl.engine/src/org/jetel/data/parser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#132">[ date ]</a>
              <a href="thread.html#132">[ thread ]</a>
              <a href="subject.html#132">[ subject ]</a>
              <a href="author.html#132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/cloveretl-svn-commits">More information about the Cloveretl-svn-commits
mailing list</a><br>
</body></html>
